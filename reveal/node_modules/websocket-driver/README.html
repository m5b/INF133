
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>websocket-driver &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/reveal/node_modules/websocket-driver/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#server-side-with-http">
     Server-side with HTTP
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#server-side-with-tcp">
     Server-side with TCP
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#client-side">
     Client-side
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#http-proxies">
     HTTP Proxies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#driver-api">
     Driver API
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-open-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('open',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-message-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('message',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-error-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('error',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-close-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('close',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-ping-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('ping',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-pong-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('pong',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-addextension-extension">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.addExtension(extension)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-setheader-name-value">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.setHeader(name,
        </span>
        <span class="pre">
         value)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-start">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.start()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-parse-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.parse(string)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-text-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.text(string)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-binary-buffer">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.binary(buffer)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-ping-string-function">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.ping(string
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         '',
        </span>
        <span class="pre">
         function()
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-pong-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.pong(string
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         '')
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-close">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.close()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-version">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.version
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-protocol">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.protocol
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>websocket-driver </h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#server-side-with-http">
     Server-side with HTTP
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#server-side-with-tcp">
     Server-side with TCP
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#client-side">
     Client-side
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#http-proxies">
     HTTP Proxies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#driver-api">
     Driver API
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-open-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('open',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-message-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('message',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-error-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('error',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-close-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('close',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-ping-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('ping',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-on-pong-function-event">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.on('pong',
        </span>
        <span class="pre">
         function(event)
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-addextension-extension">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.addExtension(extension)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-setheader-name-value">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.setHeader(name,
        </span>
        <span class="pre">
         value)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-start">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.start()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-parse-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.parse(string)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-text-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.text(string)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-binary-buffer">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.binary(buffer)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-ping-string-function">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.ping(string
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         '',
        </span>
        <span class="pre">
         function()
        </span>
        <span class="pre">
         {})
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-pong-string">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.pong(string
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         '')
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-close">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.close()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-version">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.version
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#driver-protocol">
       <code class="docutils literal notranslate">
        <span class="pre">
         driver.protocol
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="websocket-driver-build-status">
<h1>websocket-driver <a class="reference external" href="https://travis-ci.org/faye/websocket-driver-node"><img alt="Build Status" src="https://travis-ci.org/faye/websocket-driver-node.svg" /></a><a class="headerlink" href="#websocket-driver-build-status" title="Permalink to this headline">#</a></h1>
<p>This module provides a complete implementation of the WebSocket protocols that
can be hooked up to any I/O stream. It aims to simplify things by decoupling the
protocol details from the I/O layer, such that users only need to implement code
to stream data in and out of it without needing to know anything about how the
protocol actually works. Think of it as a complete WebSocket system with
pluggable I/O.</p>
<p>Due to this design, you get a lot of things for free. In particular, if you hook
this module up to some I/O object, it will do all of this for you:</p>
<ul class="simple">
<li><p>Select the correct server-side driver to talk to the client</p></li>
<li><p>Generate and send both server- and client-side handshakes</p></li>
<li><p>Recognize when the handshake phase completes and the WS protocol begins</p></li>
<li><p>Negotiate subprotocol selection based on <code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Protocol</span></code></p></li>
<li><p>Negotiate and use extensions via the
<a class="reference external" href="https://github.com/faye/websocket-extensions-node">websocket-extensions</a>
module</p></li>
<li><p>Buffer sent messages until the handshake process is finished</p></li>
<li><p>Deal with proxies that defer delivery of the draft-76 handshake body</p></li>
<li><p>Notify you when the socket is open and closed and when messages arrive</p></li>
<li><p>Recombine fragmented messages</p></li>
<li><p>Dispatch text, binary, ping, pong and close frames</p></li>
<li><p>Manage the socket-closing handshake process</p></li>
<li><p>Automatically reply to ping frames with a matching pong</p></li>
<li><p>Apply masking to messages sent by the client</p></li>
</ul>
<p>This library was originally extracted from the <a class="reference external" href="http://faye.jcoglan.com">Faye</a>
project but now aims to provide simple WebSocket support for any Node-based
project.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm install websocket-driver
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h2>
<p>This module provides protocol drivers that have the same interface on the server
and on the client. A WebSocket driver is an object with two duplex streams
attached; one for incoming/outgoing messages and one for managing the wire
protocol over an I/O stream. The full API is described below.</p>
<section id="server-side-with-http">
<h3>Server-side with HTTP<a class="headerlink" href="#server-side-with-http" title="Permalink to this headline">#</a></h3>
<p>A Node webserver emits a special event for ‘upgrade’ requests, and this is where
you should handle WebSockets. You first check whether the request is a
WebSocket, and if so you can create a driver and attach the request’s I/O stream
to it.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">websocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;websocket-driver&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;upgrade&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">isWebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="w">  </span><span class="nx">socket</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got a message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Note the line <code class="docutils literal notranslate"><span class="pre">driver.io.write(body)</span></code> - you must pass the <code class="docutils literal notranslate"><span class="pre">body</span></code> buffer to the
socket driver in order to make certain versions of the protocol work.</p>
</section>
<section id="server-side-with-tcp">
<h3>Server-side with TCP<a class="headerlink" href="#server-side-with-tcp" title="Permalink to this headline">#</a></h3>
<p>You can also handle WebSocket connections in a bare TCP server, if you’re not
using an HTTP server and don’t want to implement HTTP parsing yourself.</p>
<p>The driver will emit a <code class="docutils literal notranslate"><span class="pre">connect</span></code> event when a request is received, and at this
point you can detect whether it’s a WebSocket and handle it as such. Here’s an
example using the Node <code class="docutils literal notranslate"><span class="pre">net</span></code> module:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">net</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">websocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;websocket-driver&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">server</span><span class="p">();</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">isWebSocket</span><span class="p">(</span><span class="nx">driver</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">driver</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// handle other HTTP requests</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">connection</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{});</span>

<span class="w">  </span><span class="nx">connection</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">messages</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">4180</span><span class="p">);</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">connect</span></code> event, the driver gains several properties to describe the
request, similar to a Node request object, such as <code class="docutils literal notranslate"><span class="pre">method</span></code>, <code class="docutils literal notranslate"><span class="pre">url</span></code> and
<code class="docutils literal notranslate"><span class="pre">headers</span></code>. However you should remember it’s not a real request object; you
cannot write data to it, it only tells you what request data we parsed from the
input.</p>
<p>If the request has a body, it will be in the <code class="docutils literal notranslate"><span class="pre">driver.body</span></code> buffer, but only as
much of the body as has been piped into the driver when the <code class="docutils literal notranslate"><span class="pre">connect</span></code> event
fires.</p>
</section>
<section id="client-side">
<h3>Client-side<a class="headerlink" href="#client-side" title="Permalink to this headline">#</a></h3>
<p>Similarly, to implement a WebSocket client you just need to make a driver by
passing in a URL. After this you use the driver API as described below to
process incoming data and send outgoing data.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">net</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">websocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;websocket-driver&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">client</span><span class="p">(</span><span class="s1">&#39;ws://www.example.com/socket&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">tcp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;www.example.com&#39;</span><span class="p">);</span>

<span class="nx">tcp</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tcp</span><span class="p">);</span>

<span class="nx">tcp</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">driver</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got a message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Client drivers have two additional properties for reading the HTTP data that was
sent back by the server:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">driver.statusCode</span></code> - the integer value of the HTTP status code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">driver.headers</span></code> - an object containing the response headers</p></li>
</ul>
</section>
<section id="http-proxies">
<h3>HTTP Proxies<a class="headerlink" href="#http-proxies" title="Permalink to this headline">#</a></h3>
<p>The client driver supports connections via HTTP proxies using the <code class="docutils literal notranslate"><span class="pre">CONNECT</span></code>
method. Instead of sending the WebSocket handshake immediately, it will send a
<code class="docutils literal notranslate"><span class="pre">CONNECT</span></code> request, wait for a <code class="docutils literal notranslate"><span class="pre">200</span></code> response, and then proceed as normal.</p>
<p>To use this feature, call <code class="docutils literal notranslate"><span class="pre">driver.proxy(url)</span></code> where <code class="docutils literal notranslate"><span class="pre">url</span></code> is the origin of the
proxy, including a username and password if required. This produces a duplex
stream that you should pipe in and out of your TCP connection to the proxy
server. When the proxy emits <code class="docutils literal notranslate"><span class="pre">connect</span></code>, you can then pipe <code class="docutils literal notranslate"><span class="pre">driver.io</span></code> to your
TCP stream and call <code class="docutils literal notranslate"><span class="pre">driver.start()</span></code>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">net</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">websocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;websocket-driver&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">client</span><span class="p">(</span><span class="s1">&#39;ws://www.example.com/socket&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">proxy</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">driver</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;http://username:password@proxy.example.com&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">tcp</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;proxy.example.com&#39;</span><span class="p">);</span>

<span class="nx">tcp</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">proxy</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tcp</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">end</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>

<span class="nx">tcp</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">proxy</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tcp</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">io</span><span class="p">);</span>
<span class="w">  </span><span class="nx">driver</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">driver</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got a message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The proxy’s <code class="docutils literal notranslate"><span class="pre">connect</span></code> event is also where you should perform a TLS handshake on
your TCP stream, if you are connecting to a <code class="docutils literal notranslate"><span class="pre">wss:</span></code> endpoint.</p>
<p>In the event that proxy connection fails, <code class="docutils literal notranslate"><span class="pre">proxy</span></code> will emit an <code class="docutils literal notranslate"><span class="pre">error</span></code>. You can
inspect the proxy’s response via <code class="docutils literal notranslate"><span class="pre">proxy.statusCode</span></code> and <code class="docutils literal notranslate"><span class="pre">proxy.headers</span></code>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">proxy</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Before calling <code class="docutils literal notranslate"><span class="pre">proxy.start()</span></code> you can set custom headers using
<code class="docutils literal notranslate"><span class="pre">proxy.setHeader()</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">proxy</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;node&#39;</span><span class="p">);</span>
<span class="nx">proxy</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="driver-api">
<h3>Driver API<a class="headerlink" href="#driver-api" title="Permalink to this headline">#</a></h3>
<p>Drivers are created using one of the following methods:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
<span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
<span class="nx">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">client</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">http</span></code> method returns a driver chosen using the headers from a Node HTTP
request object. The <code class="docutils literal notranslate"><span class="pre">server</span></code> method returns a driver that will parse an HTTP
request and then decide which driver to use for it using the <code class="docutils literal notranslate"><span class="pre">http</span></code> method. The
<code class="docutils literal notranslate"><span class="pre">client</span></code> method always returns a driver for the RFC version of the protocol with
masking enabled on outgoing frames.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> argument is optional, and is an object. It may contain the
following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxLength</span></code> - the maximum allowed size of incoming message frames, in bytes.
The default value is <code class="docutils literal notranslate"><span class="pre">2^26</span> <span class="pre">-</span> <span class="pre">1</span></code>, or 1 byte short of 64 MiB.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocols</span></code> - an array of strings representing acceptable subprotocols for use
over the socket. The driver will negotiate one of these to use via the
<code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Protocol</span></code> header if supported by the other peer.</p></li>
</ul>
<p>A driver has two duplex streams attached to it:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">driver.io</span></code></strong> - this stream should be attached to an I/O socket like a TCP
stream. Pipe incoming TCP chunks to this stream for them to be parsed, and
pipe this stream back into TCP to send outgoing frames.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">driver.messages</span></code></strong> - this stream emits messages received over the
WebSocket.  Writing to it sends messages to the other peer by emitting frames
via the <code class="docutils literal notranslate"><span class="pre">driver.io</span></code> stream.</p></li>
</ul>
<p>All drivers respond to the following API methods, but some of them are no-ops
depending on whether the client supports the behaviour.</p>
<p>Note that most of these methods are commands: if they produce data that should
be sent over the socket, they will give this to you by emitting <code class="docutils literal notranslate"><span class="pre">data</span></code> events on
the <code class="docutils literal notranslate"><span class="pre">driver.io</span></code> stream.</p>
<section id="driver-on-open-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('open',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-open-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback to execute when the socket becomes open.</p>
</section>
<section id="driver-on-message-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('message',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-message-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback to execute when a message is received. <code class="docutils literal notranslate"><span class="pre">event</span></code> will have a
<code class="docutils literal notranslate"><span class="pre">data</span></code> attribute containing either a string in the case of a text message or a
<code class="docutils literal notranslate"><span class="pre">Buffer</span></code> in the case of a binary message.</p>
<p>You can also listen for messages using the <code class="docutils literal notranslate"><span class="pre">driver.messages.on('data')</span></code> event,
which emits strings for text messages and buffers for binary messages.</p>
</section>
<section id="driver-on-error-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('error',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-error-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback to execute when a protocol error occurs due to the other peer
sending an invalid byte sequence. <code class="docutils literal notranslate"><span class="pre">event</span></code> will have a <code class="docutils literal notranslate"><span class="pre">message</span></code> attribute
describing the error.</p>
</section>
<section id="driver-on-close-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('close',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-close-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback to execute when the socket becomes closed. The <code class="docutils literal notranslate"><span class="pre">event</span></code> object
has <code class="docutils literal notranslate"><span class="pre">code</span></code> and <code class="docutils literal notranslate"><span class="pre">reason</span></code> attributes.</p>
</section>
<section id="driver-on-ping-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('ping',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-ping-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback block to execute when a ping is received. You do not need to
handle this by sending a pong frame yourself; the driver handles this for you.</p>
</section>
<section id="driver-on-pong-function-event">
<h4><code class="docutils literal notranslate"><span class="pre">driver.on('pong',</span> <span class="pre">function(event)</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-on-pong-function-event" title="Permalink to this headline">#</a></h4>
<p>Adds a callback block to execute when a pong is received. If this was in
response to a ping you sent, you can also handle this event via the
<code class="docutils literal notranslate"><span class="pre">driver.ping(message,</span> <span class="pre">function()</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">})</span></code> callback.</p>
</section>
<section id="driver-addextension-extension">
<h4><code class="docutils literal notranslate"><span class="pre">driver.addExtension(extension)</span></code><a class="headerlink" href="#driver-addextension-extension" title="Permalink to this headline">#</a></h4>
<p>Registers a protocol extension whose operation will be negotiated via the
<code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> header. <code class="docutils literal notranslate"><span class="pre">extension</span></code> is any extension compatible with
the <a class="reference external" href="https://github.com/faye/websocket-extensions-node">websocket-extensions</a>
framework.</p>
</section>
<section id="driver-setheader-name-value">
<h4><code class="docutils literal notranslate"><span class="pre">driver.setHeader(name,</span> <span class="pre">value)</span></code><a class="headerlink" href="#driver-setheader-name-value" title="Permalink to this headline">#</a></h4>
<p>Sets a custom header to be sent as part of the handshake response, either from
the server or from the client. Must be called before <code class="docutils literal notranslate"><span class="pre">start()</span></code>, since this is
when the headers are serialized and sent.</p>
</section>
<section id="driver-start">
<h4><code class="docutils literal notranslate"><span class="pre">driver.start()</span></code><a class="headerlink" href="#driver-start" title="Permalink to this headline">#</a></h4>
<p>Initiates the protocol by sending the handshake - either the response for a
server-side driver or the request for a client-side one. This should be the
first method you invoke.  Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if and only if a handshake was sent.</p>
</section>
<section id="driver-parse-string">
<h4><code class="docutils literal notranslate"><span class="pre">driver.parse(string)</span></code><a class="headerlink" href="#driver-parse-string" title="Permalink to this headline">#</a></h4>
<p>Takes a string and parses it, potentially resulting in message events being
emitted (see <code class="docutils literal notranslate"><span class="pre">on('message')</span></code> above) or in data being sent to <code class="docutils literal notranslate"><span class="pre">driver.io</span></code>.  You
should send all data you receive via I/O to this method by piping a stream into
<code class="docutils literal notranslate"><span class="pre">driver.io</span></code>.</p>
</section>
<section id="driver-text-string">
<h4><code class="docutils literal notranslate"><span class="pre">driver.text(string)</span></code><a class="headerlink" href="#driver-text-string" title="Permalink to this headline">#</a></h4>
<p>Sends a text message over the socket. If the socket handshake is not yet
complete, the message will be queued until it is. Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the message
was sent or queued, and <code class="docutils literal notranslate"><span class="pre">false</span></code> if the socket can no longer send messages.</p>
<p>This method is equivalent to <code class="docutils literal notranslate"><span class="pre">driver.messages.write(string)</span></code>.</p>
</section>
<section id="driver-binary-buffer">
<h4><code class="docutils literal notranslate"><span class="pre">driver.binary(buffer)</span></code><a class="headerlink" href="#driver-binary-buffer" title="Permalink to this headline">#</a></h4>
<p>Takes a <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> and sends it as a binary message. Will queue and return <code class="docutils literal notranslate"><span class="pre">true</span></code>
or <code class="docutils literal notranslate"><span class="pre">false</span></code> the same way as the <code class="docutils literal notranslate"><span class="pre">text</span></code> method. It will also return <code class="docutils literal notranslate"><span class="pre">false</span></code> if the
driver does not support binary messages.</p>
<p>This method is equivalent to <code class="docutils literal notranslate"><span class="pre">driver.messages.write(buffer)</span></code>.</p>
</section>
<section id="driver-ping-string-function">
<h4><code class="docutils literal notranslate"><span class="pre">driver.ping(string</span> <span class="pre">=</span> <span class="pre">'',</span> <span class="pre">function()</span> <span class="pre">{})</span></code><a class="headerlink" href="#driver-ping-string-function" title="Permalink to this headline">#</a></h4>
<p>Sends a ping frame over the socket, queueing it if necessary. <code class="docutils literal notranslate"><span class="pre">string</span></code> and the
callback are both optional. If a callback is given, it will be invoked when the
socket receives a pong frame whose content matches <code class="docutils literal notranslate"><span class="pre">string</span></code>. Returns <code class="docutils literal notranslate"><span class="pre">false</span></code> if
frames can no longer be sent, or if the driver does not support ping/pong.</p>
</section>
<section id="driver-pong-string">
<h4><code class="docutils literal notranslate"><span class="pre">driver.pong(string</span> <span class="pre">=</span> <span class="pre">'')</span></code><a class="headerlink" href="#driver-pong-string" title="Permalink to this headline">#</a></h4>
<p>Sends a pong frame over the socket, queueing it if necessary. <code class="docutils literal notranslate"><span class="pre">string</span></code> is
optional. Returns <code class="docutils literal notranslate"><span class="pre">false</span></code> if frames can no longer be sent, or if the driver does
not support ping/pong.</p>
<p>You don’t need to call this when a ping frame is received; pings are replied to
automatically by the driver. This method is for sending unsolicited pongs.</p>
</section>
<section id="driver-close">
<h4><code class="docutils literal notranslate"><span class="pre">driver.close()</span></code><a class="headerlink" href="#driver-close" title="Permalink to this headline">#</a></h4>
<p>Initiates the closing handshake if the socket is still open. For drivers with no
closing handshake, this will result in the immediate execution of the
<code class="docutils literal notranslate"><span class="pre">on('close')</span></code> driver. For drivers with a closing handshake, this sends a closing
frame and <code class="docutils literal notranslate"><span class="pre">emit('close')</span></code> will execute when a response is received or a protocol
error occurs.</p>
</section>
<section id="driver-version">
<h4><code class="docutils literal notranslate"><span class="pre">driver.version</span></code><a class="headerlink" href="#driver-version" title="Permalink to this headline">#</a></h4>
<p>Returns the WebSocket version in use as a string. Will either be <code class="docutils literal notranslate"><span class="pre">hixie-75</span></code>,
<code class="docutils literal notranslate"><span class="pre">hixie-76</span></code> or <code class="docutils literal notranslate"><span class="pre">hybi-$version</span></code>.</p>
</section>
<section id="driver-protocol">
<h4><code class="docutils literal notranslate"><span class="pre">driver.protocol</span></code><a class="headerlink" href="#driver-protocol" title="Permalink to this headline">#</a></h4>
<p>Returns a string containing the selected subprotocol, if any was agreed upon
using the <code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Protocol</span></code> mechanism. This value becomes available after
<code class="docutils literal notranslate"><span class="pre">emit('open')</span></code> has fired.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/websocket-driver"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>