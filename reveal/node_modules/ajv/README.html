
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Ajv: Another JSON Schema Validator &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/reveal/node_modules/ajv/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ajv-v7-beta-is-released">
   Ajv v7 beta is released
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mozilla-moss-grant-and-openjs-foundation">
   Mozilla MOSS grant and OpenJS Foundation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#please-sponsor-ajv-development">
   Please sponsor Ajv development
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-collective-sponsors">
     Open Collective sponsors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-version-6">
   Using version 6
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contents">
   Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performance">
   Performance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install">
   Install
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-name-usage-a-getting-started">
   <a name="usage">
   </a>
   Getting started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-in-browser">
   Using in browser
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ajv-and-content-security-policies-csp">
     Ajv and Content Security Policies (CSP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#command-line-interface">
   Command line interface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-keywords">
   Validation keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotation-keywords">
   Annotation keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#formats">
   Formats
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-name-ref-a-combining-schemas-with-ref">
   <a name="ref">
   </a>
   Combining schemas with $ref
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-reference">
   $data reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merge-and-patch-keywords">
   $merge and $patch keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-custom-keywords">
   Defining custom keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#asynchronous-schema-compilation">
   Asynchronous schema compilation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#asynchronous-validation">
   Asynchronous validation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-transpilers-with-asynchronous-validation-functions">
     Using transpilers with asynchronous validation functions.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-nodent">
       Using nodent
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-other-transpilers">
       Using other transpilers
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#security-considerations">
   Security considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#security-contact">
     Security contact
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#untrusted-schemas">
     Untrusted schemas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#circular-references-in-javascript-objects">
     Circular references in JavaScript objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#security-risks-of-trusted-schemas">
     Security risks of trusted schemas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#content-security-policies-csp">
     Content Security Policies (CSP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#redos-attack">
   ReDoS attack
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering-data">
   Filtering data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assigning-defaults">
   Assigning defaults
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coercing-data-types">
   Coercing data types
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-ajv-object-options-object">
     new Ajv(Object options) -&gt; Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compile-object-schema-function-object-data">
     .compile(Object schema) -&gt; Function&lt;Object data&gt;
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-compileasync-a-compileasync-object-schema-boolean-meta-function-callback-promise">
     <a name="api-compileAsync">
     </a>
     .compileAsync(Object schema [, Boolean meta] [, Function callback]) -&gt; Promise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validate-object-schema-string-key-string-ref-data-boolean">
     .validate(Object schema|String key|String ref, data) -&gt; Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addschema-array-object-object-schema-string-key-ajv">
     .addSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addmetaschema-array-object-object-schema-string-key-ajv">
     .addMetaSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-validateschema-a-validateschema-object-schema-boolean">
     <a name="api-validateschema">
     </a>
     .validateSchema(Object schema) -&gt; Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getschema-string-key-function-object-data">
     .getSchema(String key) -&gt; Function&lt;Object data&gt;
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removeschema-object-schema-string-key-string-ref-regexp-pattern-ajv">
     .removeSchema([Object schema|String key|String ref|RegExp pattern]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-addformat-a-addformat-string-name-string-regexp-function-object-format-ajv">
     <a name="api-addformat">
     </a>
     .addFormat(String name, String|RegExp|Function|Object format) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-addkeyword-a-addkeyword-string-keyword-object-definition-ajv">
     <a name="api-addkeyword">
     </a>
     .addKeyword(String keyword, Object definition) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getkeyword-string-keyword-object-boolean">
     .getKeyword(String keyword) -&gt; Object|Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removekeyword-string-keyword-ajv">
     .removeKeyword(String keyword) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#errorstext-array-object-errors-object-options-string">
     .errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#options">
   Options
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-and-reporting-options">
     Validation and reporting options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#referenced-schema-options">
     Referenced schema options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options-to-modify-validated-data">
     Options to modify validated data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#strict-mode-options">
     Strict mode options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#asynchronous-validation-options">
     Asynchronous validation options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-options">
     Advanced options
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-errors">
   Validation errors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-objects">
     Error objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-parameters">
     Error parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-logging">
     Error logging
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plugins">
   Plugins
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#related-packages">
   Related packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-packages-using-ajv">
   Some packages using Ajv
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tests">
   Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributing">
   Contributing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changes-history">
   Changes history
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-of-conduct">
   Code of conduct
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-source-software-support">
   Open-source software support
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license">
   License
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ajv: Another JSON Schema Validator</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ajv-v7-beta-is-released">
   Ajv v7 beta is released
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mozilla-moss-grant-and-openjs-foundation">
   Mozilla MOSS grant and OpenJS Foundation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#please-sponsor-ajv-development">
   Please sponsor Ajv development
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-collective-sponsors">
     Open Collective sponsors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-version-6">
   Using version 6
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contents">
   Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performance">
   Performance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install">
   Install
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-name-usage-a-getting-started">
   <a name="usage">
   </a>
   Getting started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-in-browser">
   Using in browser
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ajv-and-content-security-policies-csp">
     Ajv and Content Security Policies (CSP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#command-line-interface">
   Command line interface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-keywords">
   Validation keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotation-keywords">
   Annotation keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#formats">
   Formats
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-name-ref-a-combining-schemas-with-ref">
   <a name="ref">
   </a>
   Combining schemas with $ref
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-reference">
   $data reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merge-and-patch-keywords">
   $merge and $patch keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-custom-keywords">
   Defining custom keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#asynchronous-schema-compilation">
   Asynchronous schema compilation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#asynchronous-validation">
   Asynchronous validation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-transpilers-with-asynchronous-validation-functions">
     Using transpilers with asynchronous validation functions.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-nodent">
       Using nodent
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-other-transpilers">
       Using other transpilers
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#security-considerations">
   Security considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#security-contact">
     Security contact
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#untrusted-schemas">
     Untrusted schemas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#circular-references-in-javascript-objects">
     Circular references in JavaScript objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#security-risks-of-trusted-schemas">
     Security risks of trusted schemas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#content-security-policies-csp">
     Content Security Policies (CSP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#redos-attack">
   ReDoS attack
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering-data">
   Filtering data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assigning-defaults">
   Assigning defaults
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coercing-data-types">
   Coercing data types
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-ajv-object-options-object">
     new Ajv(Object options) -&gt; Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compile-object-schema-function-object-data">
     .compile(Object schema) -&gt; Function&lt;Object data&gt;
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-compileasync-a-compileasync-object-schema-boolean-meta-function-callback-promise">
     <a name="api-compileAsync">
     </a>
     .compileAsync(Object schema [, Boolean meta] [, Function callback]) -&gt; Promise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validate-object-schema-string-key-string-ref-data-boolean">
     .validate(Object schema|String key|String ref, data) -&gt; Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addschema-array-object-object-schema-string-key-ajv">
     .addSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addmetaschema-array-object-object-schema-string-key-ajv">
     .addMetaSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-validateschema-a-validateschema-object-schema-boolean">
     <a name="api-validateschema">
     </a>
     .validateSchema(Object schema) -&gt; Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getschema-string-key-function-object-data">
     .getSchema(String key) -&gt; Function&lt;Object data&gt;
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removeschema-object-schema-string-key-string-ref-regexp-pattern-ajv">
     .removeSchema([Object schema|String key|String ref|RegExp pattern]) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-addformat-a-addformat-string-name-string-regexp-function-object-format-ajv">
     <a name="api-addformat">
     </a>
     .addFormat(String name, String|RegExp|Function|Object format) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-name-api-addkeyword-a-addkeyword-string-keyword-object-definition-ajv">
     <a name="api-addkeyword">
     </a>
     .addKeyword(String keyword, Object definition) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getkeyword-string-keyword-object-boolean">
     .getKeyword(String keyword) -&gt; Object|Boolean
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removekeyword-string-keyword-ajv">
     .removeKeyword(String keyword) -&gt; Ajv
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#errorstext-array-object-errors-object-options-string">
     .errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#options">
   Options
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-and-reporting-options">
     Validation and reporting options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#referenced-schema-options">
     Referenced schema options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options-to-modify-validated-data">
     Options to modify validated data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#strict-mode-options">
     Strict mode options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#asynchronous-validation-options">
     Asynchronous validation options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-options">
     Advanced options
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-errors">
   Validation errors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-objects">
     Error objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-parameters">
     Error parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-logging">
     Error logging
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plugins">
   Plugins
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#related-packages">
   Related packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-packages-using-ajv">
   Some packages using Ajv
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tests">
   Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributing">
   Contributing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changes-history">
   Changes history
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-of-conduct">
   Code of conduct
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-source-software-support">
   Open-source software support
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license">
   License
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <img align="right" alt="Ajv logo" width="160" src="https://ajv.js.org/images/ajv_logo.png">
<section class="tex2jax_ignore mathjax_ignore" id="ajv-another-json-schema-validator">
<h1>Ajv: Another JSON Schema Validator<a class="headerlink" href="#ajv-another-json-schema-validator" title="Permalink to this headline">#</a></h1>
<p>The fastest JSON Schema validator for Node.js and browser. Supports draft-04/06/07.</p>
<p><a class="reference external" href="https://travis-ci.org/ajv-validator/ajv"><img alt="Build Status" src="https://travis-ci.org/ajv-validator/ajv.svg?branch=master" /></a>
<a class="reference external" href="https://www.npmjs.com/package/ajv"><img alt="npm" src="https://img.shields.io/npm/v/ajv.svg" /></a>
<a class="reference external" href="https://www.npmjs.com/package/ajv/v/7.0.0-beta.0"><img alt="npm (beta)" src="https://img.shields.io/npm/v/ajv/beta" /></a>
<a class="reference external" href="https://www.npmjs.com/package/ajv"><img alt="npm downloads" src="https://img.shields.io/npm/dm/ajv.svg" /></a>
<a class="reference external" href="https://coveralls.io/github/ajv-validator/ajv?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/ajv-validator/ajv/badge.svg?branch=master" /></a>
<a class="reference external" href="https://gitter.im/ajv-validator/ajv"><img alt="Gitter" src="https://img.shields.io/gitter/room/ajv-validator/ajv.svg" /></a>
<a class="reference external" href="https://github.com/sponsors/epoberezkin"><img alt="GitHub Sponsors" src="https://img.shields.io/badge/%24-sponsors-brightgreen" /></a></p>
<section id="ajv-v7-beta-is-released">
<h2>Ajv v7 beta is released<a class="headerlink" href="#ajv-v7-beta-is-released" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://github.com/ajv-validator/ajv/tree/v7-beta">Ajv version 7.0.0-beta.0</a> is released with these changes:</p>
<ul class="simple">
<li><p>to reduce the mistakes in JSON schemas and unexpected validation results, <span class="xref myst">strict mode</span> is added - it prohibits ignored or ambiguous JSON Schema elements.</p></li>
<li><p>to make code injection from untrusted schemas impossible, <span class="xref myst">code generation</span> is fully re-written to be safe.</p></li>
<li><p>to simplify Ajv extensions, the new keyword API that is used by pre-defined keywords is available to user-defined keywords - it is much easier to define any keywords now, especially with subschemas.</p></li>
<li><p>schemas are compiled to ES6 code (ES5 code generation is supported with an option).</p></li>
<li><p>to improve reliability and maintainability the code is migrated to TypeScript.</p></li>
</ul>
<p><strong>Please note</strong>:</p>
<ul class="simple">
<li><p>the support for JSON-Schema draft-04 is removed - if you have schemas using “id” attributes you have to replace them with “$id” (or continue using version 6 that will be supported until 02/28/2021).</p></li>
<li><p>all formats are separated to ajv-formats package - they have to be explicitely added if you use them.</p></li>
</ul>
<p>See <a class="reference external" href="https://github.com/ajv-validator/ajv/releases/tag/v7.0.0-beta.0">release notes</a> for the details.</p>
<p>To install the new version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>ajv@beta
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/ajv-validator/ajv/tree/v7-beta#usage">Getting started with v7</a> for code example.</p>
</section>
<section id="mozilla-moss-grant-and-openjs-foundation">
<h2>Mozilla MOSS grant and OpenJS Foundation<a class="headerlink" href="#mozilla-moss-grant-and-openjs-foundation" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://www.mozilla.org/en-US/moss/"><img src="https://www.poberezkin.com/images/mozilla.png" width="240" height="68"></a>     <a class="reference external" href="https://openjsf.org/blog/2020/08/14/ajv-joins-openjs-foundation-as-an-incubation-project/"><img src="https://www.poberezkin.com/images/openjs.png" width="220" height="68"></a></p>
<p>Ajv has been awarded a grant from Mozilla’s <a class="reference external" href="https://www.mozilla.org/en-US/moss/">Open Source Support (MOSS) program</a> in the “Foundational Technology” track! It will sponsor the development of Ajv support of <a class="reference external" href="https://tools.ietf.org/html/draft-handrews-json-schema-02">JSON Schema version 2019-09</a> and of <a class="reference external" href="https://tools.ietf.org/html/draft-ucarion-json-type-definition-04">JSON Type Definition</a>.</p>
<p>Ajv also joined <a class="reference external" href="https://openjsf.org/">OpenJS Foundation</a> – having this support will help ensure the longevity and stability of Ajv for all its users.</p>
<p>This <a class="reference external" href="https://www.poberezkin.com/posts/2020-08-14-ajv-json-validator-mozilla-open-source-grant-openjs-foundation.html">blog post</a> has more details.</p>
<p>I am looking for the long term maintainers of Ajv – working with <a class="reference external" href="https://www.thereadyset.co/">ReadySet</a>, also sponsored by Mozilla, to establish clear guidelines for the role of a “maintainer” and the contribution standards, and to encourage a wider, more inclusive, contribution from the community.</p>
</section>
<section id="please-sponsor-ajv-development">
<h2>Please <a class="reference external" href="https://github.com/sponsors/epoberezkin">sponsor Ajv development</a><a class="headerlink" href="#please-sponsor-ajv-development" title="Permalink to this headline">#</a></h2>
<p>Since I asked to support Ajv development 40 people and 6 organizations contributed via GitHub and OpenCollective - this support helped receiving the MOSS grant!</p>
<p>Your continuing support is very important - the funds will be used to develop and maintain Ajv once the next major version is released.</p>
<p>Please sponsor Ajv via:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sponsors/epoberezkin">GitHub sponsors page</a> (GitHub will match it)</p></li>
<li><p><a class="reference external" href="https://opencollective.com/ajv">Ajv Open Collective️</a></p></li>
</ul>
<p>Thank you.</p>
<section id="open-collective-sponsors">
<h3>Open Collective sponsors<a class="headerlink" href="#open-collective-sponsors" title="Permalink to this headline">#</a></h3>
<p><a href="https://opencollective.com/ajv"><img src="https://opencollective.com/ajv/individuals.svg?width=890"></a></p>
<p><a href="https://opencollective.com/ajv/organization/0/website"><img src="https://opencollective.com/ajv/organization/0/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/1/website"><img src="https://opencollective.com/ajv/organization/1/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/2/website"><img src="https://opencollective.com/ajv/organization/2/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/3/website"><img src="https://opencollective.com/ajv/organization/3/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/4/website"><img src="https://opencollective.com/ajv/organization/4/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/5/website"><img src="https://opencollective.com/ajv/organization/5/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/6/website"><img src="https://opencollective.com/ajv/organization/6/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/7/website"><img src="https://opencollective.com/ajv/organization/7/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/8/website"><img src="https://opencollective.com/ajv/organization/8/avatar.svg"></a>
<a href="https://opencollective.com/ajv/organization/9/website"><img src="https://opencollective.com/ajv/organization/9/avatar.svg"></a></p>
</section>
</section>
<section id="using-version-6">
<h2>Using version 6<a class="headerlink" href="#using-version-6" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="http://json-schema.org/latest/json-schema-validation.html">JSON Schema draft-07</a> is published.</p>
<p><a class="reference external" href="https://github.com/ajv-validator/ajv/releases/tag/v6.0.0">Ajv version 6.0.0</a> that supports draft-07 is released. It may require either migrating your schemas or updating your code (to continue using draft-04 and v5 schemas, draft-06 schemas will be supported without changes).</p>
<p><strong>Please note</strong>: To use Ajv with draft-06 schemas you need to explicitly add the meta-schema to the validator instance:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ajv</span><span class="p">.</span><span class="nx">addMetaSchema</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv/lib/refs/json-schema-draft-06.json&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>To use Ajv with draft-04 schemas in addition to explicitly adding meta-schema you also need to use option schemaId:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="nx">schemaId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">});</span>
<span class="c1">// If you want to use both draft-04 and draft-06/07 schemas:</span>
<span class="c1">// var ajv = new Ajv({schemaId: &#39;auto&#39;});</span>
<span class="nx">ajv</span><span class="p">.</span><span class="nx">addMetaSchema</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv/lib/refs/json-schema-draft-04.json&#39;</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#performance">Performance</a></p></li>
<li><p><a class="reference external" href="#features">Features</a></p></li>
<li><p><a class="reference external" href="#getting-started">Getting started</a></p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/FAQ.md">Frequently Asked Questions</a></p></li>
<li><p><a class="reference external" href="#using-in-browser">Using in browser</a></p>
<ul>
<li><p><a class="reference external" href="#ajv-and-content-security-policies-csp">Ajv and Content Security Policies (CSP)</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#command-line-interface">Command line interface</a></p></li>
<li><p>Validation</p>
<ul>
<li><p><a class="reference external" href="#validation-keywords">Keywords</a></p></li>
<li><p><a class="reference external" href="#annotation-keywords">Annotation keywords</a></p></li>
<li><p><a class="reference external" href="#formats">Formats</a></p></li>
<li><p><a class="reference external" href="#ref">Combining schemas with $ref</a></p></li>
<li><p><a class="reference external" href="#data-reference">$data reference</a></p></li>
<li><p>NEW: <a class="reference external" href="#merge-and-patch-keywords">$merge and $patch keywords</a></p></li>
<li><p><a class="reference external" href="#defining-custom-keywords">Defining custom keywords</a></p></li>
<li><p><a class="reference external" href="#asynchronous-schema-compilation">Asynchronous schema compilation</a></p></li>
<li><p><a class="reference external" href="#asynchronous-validation">Asynchronous validation</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#security-considerations">Security considerations</a></p>
<ul>
<li><p><a class="reference external" href="#security-contact">Security contact</a></p></li>
<li><p><a class="reference external" href="#untrusted-schemas">Untrusted schemas</a></p></li>
<li><p><a class="reference external" href="#circular-references-in-javascript-objects">Circular references in objects</a></p></li>
<li><p><a class="reference external" href="#security-risks-of-trusted-schemas">Trusted schemas</a></p></li>
<li><p><a class="reference external" href="#redos-attack">ReDoS attack</a></p></li>
</ul>
</li>
<li><p>Modifying data during validation</p>
<ul>
<li><p><a class="reference external" href="#filtering-data">Filtering data</a></p></li>
<li><p><a class="reference external" href="#assigning-defaults">Assigning defaults</a></p></li>
<li><p><a class="reference external" href="#coercing-data-types">Coercing data types</a></p></li>
</ul>
</li>
<li><p>API</p>
<ul>
<li><p><a class="reference external" href="#api">Methods</a></p></li>
<li><p><a class="reference external" href="#options">Options</a></p></li>
<li><p><a class="reference external" href="#validation-errors">Validation errors</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#plugins">Plugins</a></p></li>
<li><p><a class="reference external" href="#related-packages">Related packages</a></p></li>
<li><p><a class="reference external" href="#some-packages-using-ajv">Some packages using Ajv</a></p></li>
<li><p><a class="reference external" href="#tests">Tests, Contributing, Changes history</a></p></li>
<li><p><a class="reference external" href="#open-source-software-support">Support, Code of conduct, License</a></p></li>
</ul>
</section>
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">#</a></h2>
<p>Ajv generates code using <a class="reference external" href="https://github.com/olado/doT">doT templates</a> to turn JSON Schemas into super-fast validation functions that are efficient for v8 optimization.</p>
<p>Currently Ajv is the fastest and the most standard compliant validator according to these benchmarks:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ebdrup/json-schema-benchmark">json-schema-benchmark</a> - 50% faster than the second place</p></li>
<li><p><a class="reference external" href="https://github.com/pandastrike/jsck#benchmarks">jsck benchmark</a> - 20-190% faster</p></li>
<li><p><a class="reference external" href="https://rawgit.com/zaggino/z-schema/master/benchmark/results.html">z-schema benchmark</a></p></li>
<li><p><a class="reference external" href="https://cdn.rawgit.com/playlyfe/themis/master/benchmark/results.html">themis benchmark</a></p></li>
</ul>
<p>Performance of different validators by <a class="reference external" href="https://github.com/ebdrup/json-schema-benchmark">json-schema-benchmark</a>:</p>
<p><a class="reference external" href="https://github.com/ebdrup/json-schema-benchmark/blob/master/README.md#performance"><img alt="performance" src="https://chart.googleapis.com/chart?chxt=x,y&amp;cht=bhs&amp;chco=76A4FB&amp;chls=2.0&amp;chbh=32,4,1&amp;chs=600x416&amp;chxl=-1:%7Cdjv%7Cajv%7Cjson-schema-validator-generator%7Cjsen%7Cis-my-json-valid%7Cthemis%7Cz-schema%7Cjsck%7Cskeemas%7Cjson-schema-library%7Ctv4&amp;chd=t:100,98,72.1,66.8,50.1,15.1,6.1,3.8,1.2,0.7,0.2" /></a></p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Ajv implements full JSON Schema <a class="reference external" href="http://json-schema.org/">draft-06/07</a> and draft-04 standards:</p>
<ul>
<li><p>all validation keywords (see <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md">JSON Schema validation keywords</a>)</p></li>
<li><p>full support of remote refs (remote schemas have to be added with <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> or compiled to be available)</p></li>
<li><p>support of circular references between schemas</p></li>
<li><p>correct string lengths for strings with unicode pairs (can be turned off)</p></li>
<li><p><a class="reference external" href="#formats">formats</a> defined by JSON Schema draft-07 standard and custom formats (can be turned off)</p></li>
<li><p><a class="reference external" href="#api-validateschema">validates schemas against meta-schema</a></p></li>
</ul>
</li>
<li><p>supports <a class="reference external" href="#using-in-browser">browsers</a> and Node.js 0.10-14.x</p></li>
<li><p><a class="reference external" href="#asynchronous-schema-compilation">asynchronous loading</a> of referenced schemas during compilation</p></li>
<li><p>“All errors” validation mode with <a class="reference external" href="#options">option allErrors</a></p></li>
<li><p><a class="reference external" href="#validation-errors">error messages with parameters</a> describing error reasons to allow creating custom error messages</p></li>
<li><p>i18n error messages support with <a class="reference external" href="https://github.com/ajv-validator/ajv-i18n">ajv-i18n</a> package</p></li>
<li><p><a class="reference external" href="#filtering-data">filtering data</a> from additional properties</p></li>
<li><p><a class="reference external" href="#assigning-defaults">assigning defaults</a> to missing properties and items</p></li>
<li><p><a class="reference external" href="#coercing-data-types">coercing data</a> to the types specified in <code class="docutils literal notranslate"><span class="pre">type</span></code> keywords</p></li>
<li><p><a class="reference external" href="#defining-custom-keywords">custom keywords</a></p></li>
<li><p>draft-06/07 keywords <code class="docutils literal notranslate"><span class="pre">const</span></code>, <code class="docutils literal notranslate"><span class="pre">contains</span></code>, <code class="docutils literal notranslate"><span class="pre">propertyNames</span></code> and <code class="docutils literal notranslate"><span class="pre">if/then/else</span></code></p></li>
<li><p>draft-06 boolean schemas (<code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code> as a schema to always pass/fail).</p></li>
<li><p>keywords <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">patternRequired</span></code>, <code class="docutils literal notranslate"><span class="pre">formatMaximum</span></code> / <code class="docutils literal notranslate"><span class="pre">formatMinimum</span></code> and <code class="docutils literal notranslate"><span class="pre">formatExclusiveMaximum</span></code> / <code class="docutils literal notranslate"><span class="pre">formatExclusiveMinimum</span></code> from <a class="reference external" href="https://github.com/json-schema/json-schema/wiki/v5-Proposals">JSON Schema extension proposals</a> with <a class="reference external" href="https://github.com/ajv-validator/ajv-keywords">ajv-keywords</a> package</p></li>
<li><p><a class="reference external" href="#data-reference">$data reference</a> to use values from the validated data as values for the schema keywords</p></li>
<li><p><a class="reference external" href="#asynchronous-validation">asynchronous validation</a> of custom formats and keywords</p></li>
</ul>
</section>
<section id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="n">ajv</span>
</pre></div>
</div>
</section>
<section id="a-name-usage-a-getting-started">
<h2><a name="usage"></a>Getting started<a class="headerlink" href="#a-name-usage-a-getting-started" title="Permalink to this headline">#</a></h2>
<p>Try it in the Node.js REPL: https://tonicdev.com/npm/ajv</p>
<p>The fastest validation call:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Node.js require:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">Ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv&#39;</span><span class="p">);</span>
<span class="c1">// or ESM/TypeScript import</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Ajv</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ajv&#39;</span><span class="p">;</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">();</span><span class="w"> </span><span class="c1">// options can be passed, e.g. {allErrors: true}</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">valid</span><span class="p">)</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">.</span><span class="nx">errors</span><span class="p">);</span>
</pre></div>
</div>
<p>or with less code</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">valid</span><span class="p">)</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ajv</span><span class="p">.</span><span class="nx">errors</span><span class="p">);</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">addSchema</span><span class="p">(</span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mySchema&#39;</span><span class="p">)</span>
<span class="w">               </span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="s1">&#39;mySchema&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">valid</span><span class="p">)</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ajv</span><span class="p">.</span><span class="nx">errorsText</span><span class="p">());</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#api">API</a> and <a class="reference external" href="#options">Options</a> for more details.</p>
<p>Ajv compiles schemas to functions and caches them in all cases (using schema serialized with <a class="reference external" href="https://github.com/epoberezkin/fast-json-stable-stringify">fast-json-stable-stringify</a> or a custom function as a key), so that the next time the same schema is used (not necessarily the same object instance) it won’t be compiled again.</p>
<p>The best performance is achieved when using compiled functions returned by <code class="docutils literal notranslate"><span class="pre">compile</span></code> or <code class="docutils literal notranslate"><span class="pre">getSchema</span></code> methods (there is no additional function call).</p>
<p><strong>Please note</strong>: every time a validation function or <code class="docutils literal notranslate"><span class="pre">ajv.validate</span></code> are called <code class="docutils literal notranslate"><span class="pre">errors</span></code> property is overwritten. You need to copy <code class="docutils literal notranslate"><span class="pre">errors</span></code> array reference to another variable if you want to use it later (e.g., in the callback). See <a class="reference external" href="#validation-errors">Validation errors</a></p>
<p><strong>Note for TypeScript users</strong>: <code class="docutils literal notranslate"><span class="pre">ajv</span></code> provides its own TypeScript declarations
out of the box, so you don’t need to install the deprecated <code class="docutils literal notranslate"><span class="pre">&#64;types/ajv</span></code>
module.</p>
</section>
<section id="using-in-browser">
<h2>Using in browser<a class="headerlink" href="#using-in-browser" title="Permalink to this headline">#</a></h2>
<p>You can require Ajv directly from the code you browserify - in this case Ajv will be a part of your bundle.</p>
<p>If you need to use Ajv in several bundles you can create a separate UMD bundle using <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">bundle</span></code> script (thanks to <a class="reference external" href="https://github.com/siddo420">siddo420</a>).</p>
<p>Then you need to load Ajv in the browser:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;ajv.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This bundle can be used with different module systems; it creates global <code class="docutils literal notranslate"><span class="pre">Ajv</span></code> if no module system is found.</p>
<p>The browser bundle is available on <a class="reference external" href="https://cdnjs.com/libraries/ajv">cdnjs</a>.</p>
<p>Ajv is tested with these browsers:</p>
<p><a class="reference external" href="https://saucelabs.com/u/epoberezkin"><img alt="Sauce Test Status" src="https://saucelabs.com/browser-matrix/epoberezkin.svg" /></a></p>
<p><strong>Please note</strong>: some frameworks, e.g. Dojo, may redefine global require in such way that is not compatible with CommonJS module format. In such case Ajv bundle has to be loaded before the framework and then you can use global Ajv (see issue <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/234">#234</a>).</p>
<section id="ajv-and-content-security-policies-csp">
<h3>Ajv and Content Security Policies (CSP)<a class="headerlink" href="#ajv-and-content-security-policies-csp" title="Permalink to this headline">#</a></h3>
<p>If you’re using Ajv to compile a schema (the typical use) in a browser document that is loaded with a Content Security Policy (CSP), that policy will require a <code class="docutils literal notranslate"><span class="pre">script-src</span></code> directive that includes the value <code class="docutils literal notranslate"><span class="pre">'unsafe-eval'</span></code>.
:warning: NOTE, however, that <code class="docutils literal notranslate"><span class="pre">unsafe-eval</span></code> is NOT recommended in a secure CSP<a class="reference external" href="https://developer.chrome.com/extensions/contentSecurityPolicy#relaxing-eval">[1]</a>, as it has the potential to open the document to cross-site scripting (XSS) attacks.</p>
<p>In order to make use of Ajv without easing your CSP, you can <a class="reference external" href="https://github.com/ajv-validator/ajv-cli#compile-schemas">pre-compile a schema using the CLI</a>. This will transpile the schema JSON into a JavaScript file that exports a <code class="docutils literal notranslate"><span class="pre">validate</span></code> function that works simlarly to a schema compiled at runtime.</p>
<p>Note that pre-compilation of schemas is performed using <a class="reference external" href="https://github.com/ajv-validator/ajv-pack">ajv-pack</a> and there are <a class="reference external" href="https://github.com/ajv-validator/ajv-pack#limitations">some limitations to the schema features it can compile</a>. A successfully pre-compiled schema is equivalent to the same schema compiled at runtime.</p>
</section>
</section>
<section id="command-line-interface">
<h2>Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">#</a></h2>
<p>CLI is available as a separate npm package <a class="reference external" href="https://github.com/ajv-validator/ajv-cli">ajv-cli</a>. It supports:</p>
<ul class="simple">
<li><p>compiling JSON Schemas to test their validity</p></li>
<li><p>BETA: generating standalone module exporting a validation function to be used without Ajv (using <a class="reference external" href="https://github.com/ajv-validator/ajv-pack">ajv-pack</a>)</p></li>
<li><p>migrate schemas to draft-07 (using <a class="reference external" href="https://github.com/epoberezkin/json-schema-migrate">json-schema-migrate</a>)</p></li>
<li><p>validating data file(s) against JSON Schema</p></li>
<li><p>testing expected validity of data against JSON Schema</p></li>
<li><p>referenced schemas</p></li>
<li><p>custom meta-schemas</p></li>
<li><p>files in JSON, JSON5, YAML, and JavaScript format</p></li>
<li><p>all Ajv options</p></li>
<li><p>reporting changes in data after validation in <a class="reference external" href="https://tools.ietf.org/html/rfc6902">JSON-patch</a> format</p></li>
</ul>
</section>
<section id="validation-keywords">
<h2>Validation keywords<a class="headerlink" href="#validation-keywords" title="Permalink to this headline">#</a></h2>
<p>Ajv supports all validation keywords from draft-07 of JSON Schema standard:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#type">type</a></p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-numbers">for numbers</a> - maximum, minimum, exclusiveMaximum, exclusiveMinimum, multipleOf</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-strings">for strings</a> - maxLength, minLength, pattern, format</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-arrays">for arrays</a> - maxItems, minItems, uniqueItems, items, additionalItems, <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#contains">contains</a></p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-objects">for objects</a> - maxProperties, minProperties, required, properties, patternProperties, additionalProperties, dependencies, <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#propertynames">propertyNames</a></p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-all-types">for all types</a> - enum, <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#const">const</a></p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#compound-keywords">compound keywords</a> - not, oneOf, anyOf, allOf, <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#ifthenelse">if/then/else</a></p></li>
</ul>
<p>With <a class="reference external" href="https://github.com/ajv-validator/ajv-keywords">ajv-keywords</a> package Ajv also supports validation keywords from <a class="reference external" href="https://github.com/json-schema/json-schema/wiki/v5-Proposals">JSON Schema extension proposals</a> for JSON Schema standard:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#patternrequired-proposed">patternRequired</a> - like <code class="docutils literal notranslate"><span class="pre">required</span></code> but with patterns that some property should match.</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#formatmaximum--formatminimum-and-exclusiveformatmaximum--exclusiveformatminimum-proposed">formatMaximum, formatMinimum, formatExclusiveMaximum, formatExclusiveMinimum</a> - setting limits for date, time, etc.</p></li>
</ul>
<p>See <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md">JSON Schema validation keywords</a> for more details.</p>
</section>
<section id="annotation-keywords">
<h2>Annotation keywords<a class="headerlink" href="#annotation-keywords" title="Permalink to this headline">#</a></h2>
<p>JSON Schema specification defines several annotation keywords that describe schema itself but do not perform any validation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">description</span></code>: information about the data represented by that schema</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$comment</span></code> (NEW in draft-07): information for developers. With option <code class="docutils literal notranslate"><span class="pre">$comment</span></code> Ajv logs or passes the comment string to the user-supplied function. See <a class="reference external" href="#options">Options</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code>: a default value of the data instance, see <a class="reference external" href="#assigning-defaults">Assigning defaults</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples</span></code> (NEW in draft-06): an array of data instances. Ajv does not check the validity of these instances against the schema.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">readOnly</span></code> and <code class="docutils literal notranslate"><span class="pre">writeOnly</span></code> (NEW in draft-07): marks data-instance as read-only or write-only in relation to the source of the data (database, api, etc.).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contentEncoding</span></code>: <a class="reference external" href="https://tools.ietf.org/html/rfc2045#section-6.1">RFC 2045</a>, e.g., “base64”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contentMediaType</span></code>: <a class="reference external" href="https://tools.ietf.org/html/rfc2046">RFC 2046</a>, e.g., “image/png”.</p></li>
</ul>
<p><strong>Please note</strong>:  Ajv does not implement validation of the keywords <code class="docutils literal notranslate"><span class="pre">examples</span></code>, <code class="docutils literal notranslate"><span class="pre">contentEncoding</span></code> and <code class="docutils literal notranslate"><span class="pre">contentMediaType</span></code> but it reserves them. If you want to create a plugin that implements some of them, it should remove these keywords from the instance.</p>
</section>
<section id="formats">
<h2>Formats<a class="headerlink" href="#formats" title="Permalink to this headline">#</a></h2>
<p>Ajv implements formats defined by JSON Schema specification and several other formats. It is recommended NOT to use “format” keyword implementations with untrusted data, as they use potentially unsafe regular expressions - see <a class="reference external" href="#redos-attack">ReDoS attack</a>.</p>
<p><strong>Please note</strong>: if you need to use “format” keyword to validate untrusted data, you MUST assess their suitability and safety for your validation scenarios.</p>
<p>The following formats are implemented for string validation with “format” keyword:</p>
<ul class="simple">
<li><p><em>date</em>: full-date according to <a class="reference external" href="http://tools.ietf.org/html/rfc3339#section-5.6">RFC3339</a>.</p></li>
<li><p><em>time</em>: time with optional time-zone.</p></li>
<li><p><em>date-time</em>: date-time from the same source (time-zone is mandatory). <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">time</span></code> and <code class="docutils literal notranslate"><span class="pre">date-time</span></code> validate ranges in <code class="docutils literal notranslate"><span class="pre">full</span></code> mode and only regexp in <code class="docutils literal notranslate"><span class="pre">fast</span></code> mode (see <a class="reference external" href="#options">options</a>).</p></li>
<li><p><em>uri</em>: full URI.</p></li>
<li><p><em>uri-reference</em>: URI reference, including full and relative URIs.</p></li>
<li><p><em>uri-template</em>: URI template according to <a class="reference external" href="https://tools.ietf.org/html/rfc6570">RFC6570</a></p></li>
<li><p><em>url</em> (deprecated): <a class="reference external" href="https://url.spec.whatwg.org/#concept-url">URL record</a>.</p></li>
<li><p><em>email</em>: email address.</p></li>
<li><p><em>hostname</em>: host name according to <a class="reference external" href="http://tools.ietf.org/html/rfc1034#section-3.5">RFC1034</a>.</p></li>
<li><p><em>ipv4</em>: IP address v4.</p></li>
<li><p><em>ipv6</em>: IP address v6.</p></li>
<li><p><em>regex</em>: tests whether a string is a valid regular expression by passing it to RegExp constructor.</p></li>
<li><p><em>uuid</em>: Universally Unique IDentifier according to <a class="reference external" href="http://tools.ietf.org/html/rfc4122">RFC4122</a>.</p></li>
<li><p><em>json-pointer</em>: JSON-pointer according to <a class="reference external" href="https://tools.ietf.org/html/rfc6901">RFC6901</a>.</p></li>
<li><p><em>relative-json-pointer</em>: relative JSON-pointer according to <a class="reference external" href="http://tools.ietf.org/html/draft-luff-relative-json-pointer-00">this draft</a>.</p></li>
</ul>
<p><strong>Please note</strong>: JSON Schema draft-07 also defines formats <code class="docutils literal notranslate"><span class="pre">iri</span></code>, <code class="docutils literal notranslate"><span class="pre">iri-reference</span></code>, <code class="docutils literal notranslate"><span class="pre">idn-hostname</span></code> and <code class="docutils literal notranslate"><span class="pre">idn-email</span></code> for URLs, hostnames and emails with international characters. Ajv does not implement these formats. If you create Ajv plugin that implements them please make a PR to mention this plugin here.</p>
<p>There are two modes of format validation: <code class="docutils literal notranslate"><span class="pre">fast</span></code> and <code class="docutils literal notranslate"><span class="pre">full</span></code>. This mode affects formats <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">date-time</span></code>, <code class="docutils literal notranslate"><span class="pre">uri</span></code>, <code class="docutils literal notranslate"><span class="pre">uri-reference</span></code>, and <code class="docutils literal notranslate"><span class="pre">email</span></code>. See <a class="reference external" href="#options">Options</a> for details.</p>
<p>You can add additional formats and replace any of the formats above using <a class="reference external" href="#api-addformat">addFormat</a> method.</p>
<p>The option <code class="docutils literal notranslate"><span class="pre">unknownFormats</span></code> allows changing the default behaviour when an unknown format is encountered. In this case Ajv can either fail schema compilation (default) or ignore it (default in versions before 5.0.0). You also can allow specific format(s) that will be ignored. See <a class="reference external" href="#options">Options</a> for details.</p>
<p>You can find regular expressions used for format validation and the sources that were used in <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/formats.js">formats.js</a>.</p>
</section>
<section id="a-name-ref-a-combining-schemas-with-ref">
<h2><a name="ref"></a>Combining schemas with $ref<a class="headerlink" href="#a-name-ref-a-combining-schemas-with-ref" title="Permalink to this headline">#</a></h2>
<p>You can structure your validation logic across multiple schema files and have schemas reference each other using <code class="docutils literal notranslate"><span class="pre">$ref</span></code> keyword.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;$id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;http://example.com/schemas/schema.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$ref&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;defs.json#/definitions/int&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$ref&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;defs.json#/definitions/str&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">defsSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;$id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;http://example.com/schemas/defs.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;definitions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;int&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;str&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Now to compile your schema you can either pass all schemas to Ajv instance:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="nx">schemas</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">defsSchema</span><span class="p">]});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">getSchema</span><span class="p">(</span><span class="s1">&#39;http://example.com/schemas/schema.json&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>or use <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> method:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">addSchema</span><span class="p">(</span><span class="nx">defsSchema</span><span class="p">)</span>
<span class="w">                  </span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#options">Options</a> and <a class="reference external" href="#api">addSchema</a> method.</p>
<p><strong>Please note</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$ref</span></code> is resolved as the uri-reference using schema $id as the base URI (see the example).</p></li>
<li><p>References can be recursive (and mutually recursive) to implement the schemas for different data structures (such as linked lists, trees, graphs, etc.).</p></li>
<li><p>You don’t have to host your schema files at the URIs that you use as schema $id. These URIs are only used to identify the schemas, and according to JSON Schema specification validators should not expect to be able to download the schemas from these URIs.</p></li>
<li><p>The actual location of the schema file in the file system is not used.</p></li>
<li><p>You can pass the identifier of the schema as the second parameter of <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> method or as a property name in <code class="docutils literal notranslate"><span class="pre">schemas</span></code> option. This identifier can be used instead of (or in addition to) schema $id.</p></li>
<li><p>You cannot have the same $id (or the schema identifier) used for more than one schema - the exception will be thrown.</p></li>
<li><p>You can implement dynamic resolution of the referenced schemas using <code class="docutils literal notranslate"><span class="pre">compileAsync</span></code> method. In this way you can store schemas in any system (files, web, database, etc.) and reference them without explicitly adding to Ajv instance. See <a class="reference external" href="#asynchronous-schema-compilation">Asynchronous schema compilation</a>.</p></li>
</ul>
</section>
<section id="data-reference">
<h2>$data reference<a class="headerlink" href="#data-reference" title="Permalink to this headline">#</a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">$data</span></code> option you can use values from the validated data as the values for the schema keywords. See <a class="reference external" href="https://github.com/json-schema-org/json-schema-spec/issues/51">proposal</a> for more information about how it works.</p>
<p><code class="docutils literal notranslate"><span class="pre">$data</span></code> reference is supported in the keywords: const, enum, format, maximum/minimum, exclusiveMaximum / exclusiveMinimum, maxLength / minLength, maxItems / minItems, maxProperties / minProperties, formatMaximum / formatMinimum, formatExclusiveMaximum / formatExclusiveMinimum, multipleOf, pattern, required, uniqueItems.</p>
<p>The value of “$data” should be a <a class="reference external" href="https://tools.ietf.org/html/rfc6901">JSON-pointer</a> to the data (the root is always the top level data object, even if the $data reference is inside a referenced subschema) or a <a class="reference external" href="http://tools.ietf.org/html/draft-luff-relative-json-pointer-00">relative JSON-pointer</a> (it is relative to the current point in data; if the $data reference is inside a referenced subschema it cannot point to the data outside of the root level for this subschema).</p>
<p>Examples.</p>
<p>This schema requires that the value in property <code class="docutils literal notranslate"><span class="pre">smaller</span></code> is less or equal than the value in the property larger:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="nx">$data</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;smaller&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;maximum&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$data&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1/larger&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;larger&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">smaller</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<span class="w">  </span><span class="nx">larger</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span>
<span class="p">};</span>

<span class="nx">ajv</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">validData</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</pre></div>
</div>
<p>This schema requires that the properties have the same format as their field names:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;additionalProperties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;format&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$data&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0#&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s1">&#39;date-time&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1963-06-19T08:30:06.283185Z&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;joe.bloggs@example.com&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$data</span></code> reference is resolved safely - it won’t throw even if some property is undefined. If <code class="docutils literal notranslate"><span class="pre">$data</span></code> resolves to <code class="docutils literal notranslate"><span class="pre">undefined</span></code> the validation succeeds (with the exclusion of <code class="docutils literal notranslate"><span class="pre">const</span></code> keyword). If <code class="docutils literal notranslate"><span class="pre">$data</span></code> resolves to incorrect type (e.g. not “number” for maximum keyword) the validation fails.</p>
</section>
<section id="merge-and-patch-keywords">
<h2>$merge and $patch keywords<a class="headerlink" href="#merge-and-patch-keywords" title="Permalink to this headline">#</a></h2>
<p>With the package <a class="reference external" href="https://github.com/ajv-validator/ajv-merge-patch">ajv-merge-patch</a> you can use the keywords <code class="docutils literal notranslate"><span class="pre">$merge</span></code> and <code class="docutils literal notranslate"><span class="pre">$patch</span></code> that allow extending JSON Schemas with patches using formats <a class="reference external" href="https://tools.ietf.org/html/rfc7396">JSON Merge Patch (RFC 7396)</a> and <a class="reference external" href="https://tools.ietf.org/html/rfc6902">JSON Patch (RFC 6902)</a>.</p>
<p>To add keywords <code class="docutils literal notranslate"><span class="pre">$merge</span></code> and <code class="docutils literal notranslate"><span class="pre">$patch</span></code> to Ajv instance use this code:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv-merge-patch&#39;</span><span class="p">)(</span><span class="nx">ajv</span><span class="p">);</span>
</pre></div>
</div>
<p>Examples.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">$merge</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$merge&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;p&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;with&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">$patch</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$patch&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;p&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;with&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/properties/q&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The schemas above are equivalent to this schema:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;p&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The properties <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">with</span></code> in the keywords <code class="docutils literal notranslate"><span class="pre">$merge</span></code> and <code class="docutils literal notranslate"><span class="pre">$patch</span></code> can use absolute or relative <code class="docutils literal notranslate"><span class="pre">$ref</span></code> to point to other schemas previously added to the Ajv instance or to the fragments of the current schema.</p>
<p>See the package <a class="reference external" href="https://github.com/ajv-validator/ajv-merge-patch">ajv-merge-patch</a> for more information.</p>
</section>
<section id="defining-custom-keywords">
<h2>Defining custom keywords<a class="headerlink" href="#defining-custom-keywords" title="Permalink to this headline">#</a></h2>
<p>The advantages of using custom keywords are:</p>
<ul class="simple">
<li><p>allow creating validation scenarios that cannot be expressed using JSON Schema</p></li>
<li><p>simplify your schemas</p></li>
<li><p>help bringing a bigger part of the validation logic to your schemas</p></li>
<li><p>make your schemas more expressive, less verbose and closer to your application domain</p></li>
<li><p>implement custom data processors that modify your data (<code class="docutils literal notranslate"><span class="pre">modifying</span></code> option MUST be used in keyword definition) and/or create side effects while the data is being validated</p></li>
</ul>
<p>If a keyword is used only for side-effects and its validation result is pre-defined, use option <code class="docutils literal notranslate"><span class="pre">valid:</span> <span class="pre">true/false</span></code> in keyword definition to simplify both generated code (no error handling in case of <code class="docutils literal notranslate"><span class="pre">valid:</span> <span class="pre">true</span></code>) and your keyword functions (no need to return any validation result).</p>
<p>The concerns you have to be aware of when extending JSON Schema standard with custom keywords are the portability and understanding of your schemas. You will have to support these custom keywords on other platforms and to properly document these keywords so that everybody can understand them in your schemas.</p>
<p>You can define custom keywords with <a class="reference external" href="#api-addkeyword">addKeyword</a> method. Keywords are defined on the <code class="docutils literal notranslate"><span class="pre">ajv</span></code> instance level - new instances will not have previously defined keywords.</p>
<p>Ajv allows defining keywords with:</p>
<ul class="simple">
<li><p>validation function</p></li>
<li><p>compilation function</p></li>
<li><p>macro function</p></li>
<li><p>inline compilation function that should return code (as string) that will be inlined in the currently compiled schema.</p></li>
</ul>
<p>Example. <code class="docutils literal notranslate"><span class="pre">range</span></code> and <code class="docutils literal notranslate"><span class="pre">exclusiveRange</span></code> keywords using compiled schema:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ajv</span><span class="p">.</span><span class="nx">addKeyword</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">compile</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sch</span><span class="p">,</span><span class="w"> </span><span class="nx">parentSchema</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sch</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sch</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">parentSchema</span><span class="p">.</span><span class="nx">exclusiveRange</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">max</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">max</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;range&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;exclusiveRange&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">};</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="mf">2.01</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="mf">3.99</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="mf">2</span><span class="p">));</span><span class="w"> </span><span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="mf">4</span><span class="p">));</span><span class="w"> </span><span class="c1">// false</span>
</pre></div>
</div>
<p>Several custom keywords (typeof, instanceof, range and propertyNames) are defined in <a class="reference external" href="https://github.com/ajv-validator/ajv-keywords">ajv-keywords</a> package - they can be used for your schemas and as a starting point for your own custom keywords.</p>
<p>See <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/CUSTOM.md">Defining custom keywords</a> for more details.</p>
</section>
<section id="asynchronous-schema-compilation">
<h2>Asynchronous schema compilation<a class="headerlink" href="#asynchronous-schema-compilation" title="Permalink to this headline">#</a></h2>
<p>During asynchronous compilation remote references are loaded using supplied function. See <code class="docutils literal notranslate"><span class="pre">compileAsync</span></code> <a class="reference external" href="#api-compileAsync">method</a> and <code class="docutils literal notranslate"><span class="pre">loadSchema</span></code> <a class="reference external" href="#options">option</a>.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">loadSchema</span><span class="o">:</span><span class="w"> </span><span class="nx">loadSchema</span><span class="w"> </span><span class="p">});</span>

<span class="nx">ajv</span><span class="p">.</span><span class="nx">compileAsync</span><span class="p">(</span><span class="nx">schema</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">validate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">loadSchema</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">uri</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">400</span><span class="p">)</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Loading error: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Please note</strong>: <a class="reference external" href="#options">Option</a> <code class="docutils literal notranslate"><span class="pre">missingRefs</span></code> should NOT be set to <code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;fail&quot;</span></code> for asynchronous compilation to work.</p>
</section>
<section id="asynchronous-validation">
<h2>Asynchronous validation<a class="headerlink" href="#asynchronous-validation" title="Permalink to this headline">#</a></h2>
<p>Example in Node.js REPL: https://tonicdev.com/esp/ajv-asynchronous-validation</p>
<p>You can define custom formats and keywords that perform validation asynchronously by accessing database or some other service. You should add <code class="docutils literal notranslate"><span class="pre">async:</span> <span class="pre">true</span></code> in the keyword or format definition (see <a class="reference external" href="#api-addformat">addFormat</a>, <a class="reference external" href="#api-addkeyword">addKeyword</a> and <a class="reference external" href="#defining-custom-keywords">Defining custom keywords</a>).</p>
<p>If your schema uses asynchronous formats/keywords or refers to some schema that contains them it should have <code class="docutils literal notranslate"><span class="pre">&quot;$async&quot;:</span> <span class="pre">true</span></code> keyword so that Ajv can compile it correctly. If asynchronous format/keyword or reference to asynchronous schema is used in the schema without <code class="docutils literal notranslate"><span class="pre">$async</span></code> keyword Ajv will throw an exception during schema compilation.</p>
<p><strong>Please note</strong>: all asynchronous subschemas that are referenced from the current or other schemas should have <code class="docutils literal notranslate"><span class="pre">&quot;$async&quot;:</span> <span class="pre">true</span></code> keyword as well, otherwise the schema compilation will fail.</p>
<p>Validation function for an asynchronous custom format/keyword should return a promise that resolves with <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code> (or rejects with <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Ajv.ValidationError(errors)</span></code> if you want to return custom errors from the keyword function).</p>
<p>Ajv compiles asynchronous schemas to <a class="reference external" href="http://tc39.github.io/ecmascript-asyncawait/">es7 async functions</a> that can optionally be transpiled with <a class="reference external" href="https://github.com/MatAtBread/nodent">nodent</a>. Async functions are supported in Node.js 7+ and all modern browsers. You can also supply any other transpiler as a function via <code class="docutils literal notranslate"><span class="pre">processCode</span></code> option. See <a class="reference external" href="#options">Options</a>.</p>
<p>The compiled validation function has <code class="docutils literal notranslate"><span class="pre">$async:</span> <span class="pre">true</span></code> property (if the schema is asynchronous), so you can differentiate these functions if you are using both synchronous and asynchronous schemas.</p>
<p>Validation result will be a promise that resolves with validated data or rejects with an exception <code class="docutils literal notranslate"><span class="pre">Ajv.ValidationError</span></code> that contains the array of validation errors in <code class="docutils literal notranslate"><span class="pre">errors</span></code> property.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">;</span>
<span class="c1">// require(&#39;ajv-async&#39;)(ajv);</span>

<span class="nx">ajv</span><span class="p">.</span><span class="nx">addKeyword</span><span class="p">(</span><span class="s1">&#39;idExists&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">async</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">validate</span><span class="o">:</span><span class="w"> </span><span class="nx">checkIdExists</span>
<span class="p">});</span>


<span class="kd">function</span><span class="w"> </span><span class="nx">checkIdExists</span><span class="p">(</span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">knex</span><span class="p">(</span><span class="nx">schema</span><span class="p">.</span><span class="nx">table</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!!</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="c1">// true if record is found</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;$async&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;userId&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;idExists&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;table&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;users&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;postId&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;idExists&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;table&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;posts&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">validate</span><span class="p">({</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">postId</span><span class="o">:</span><span class="w"> </span><span class="mf">19</span><span class="w"> </span><span class="p">})</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Data is valid&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// { userId: 1, postId: 19 }</span>
<span class="p">})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">.</span><span class="nx">ValidationError</span><span class="p">))</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="nx">err</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// data is invalid</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Validation errors:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">errors</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<section id="using-transpilers-with-asynchronous-validation-functions">
<h3>Using transpilers with asynchronous validation functions.<a class="headerlink" href="#using-transpilers-with-asynchronous-validation-functions" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://github.com/ajv-validator/ajv-async">ajv-async</a> uses <a class="reference external" href="https://github.com/MatAtBread/nodent">nodent</a> to transpile async functions. To use another transpiler you should separately install it (or load its bundle in the browser).</p>
<section id="using-nodent">
<h4>Using nodent<a class="headerlink" href="#using-nodent" title="Permalink to this headline">#</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">;</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv-async&#39;</span><span class="p">)(</span><span class="nx">ajv</span><span class="p">);</span>
<span class="c1">// in the browser if you want to load ajv-async bundle separately you can:</span>
<span class="c1">// window.ajvAsync(ajv);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span><span class="w"> </span><span class="c1">// transpiled es7 async function</span>
<span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">successFunc</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">errorFunc</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="using-other-transpilers">
<h4>Using other transpilers<a class="headerlink" href="#using-other-transpilers" title="Permalink to this headline">#</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">processCode</span><span class="o">:</span><span class="w"> </span><span class="nx">transpileFunc</span><span class="w"> </span><span class="p">});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span><span class="w"> </span><span class="c1">// transpiled es7 async function</span>
<span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">successFunc</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">errorFunc</span><span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#options">Options</a>.</p>
</section>
</section>
</section>
<section id="security-considerations">
<h2>Security considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">#</a></h2>
<p>JSON Schema, if properly used, can replace data sanitisation. It doesn’t replace other API security considerations. It also introduces additional security aspects to consider.</p>
<section id="security-contact">
<h3>Security contact<a class="headerlink" href="#security-contact" title="Permalink to this headline">#</a></h3>
<p>To report a security vulnerability, please use the
<a class="reference external" href="https://tidelift.com/security">Tidelift security contact</a>.
Tidelift will coordinate the fix and disclosure. Please do NOT report security vulnerabilities via GitHub issues.</p>
</section>
<section id="untrusted-schemas">
<h3>Untrusted schemas<a class="headerlink" href="#untrusted-schemas" title="Permalink to this headline">#</a></h3>
<p>Ajv treats JSON schemas as trusted as your application code. This security model is based on the most common use case, when the schemas are static and bundled together with the application.</p>
<p>If your schemas are received from untrusted sources (or generated from untrusted data) there are several scenarios you need to prevent:</p>
<ul class="simple">
<li><p>compiling schemas can cause stack overflow (if they are too deep)</p></li>
<li><p>compiling schemas can be slow (e.g. <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/557">#557</a>)</p></li>
<li><p>validating certain data can be slow</p></li>
</ul>
<p>It is difficult to predict all the scenarios, but at the very least it may help to limit the size of untrusted schemas (e.g. limit JSON string length) and also the maximum schema object depth (that can be high for relatively small JSON strings). You also may want to mitigate slow regular expressions in <code class="docutils literal notranslate"><span class="pre">pattern</span></code> and <code class="docutils literal notranslate"><span class="pre">patternProperties</span></code> keywords.</p>
<p>Regardless the measures you take, using untrusted schemas increases security risks.</p>
</section>
<section id="circular-references-in-javascript-objects">
<h3>Circular references in JavaScript objects<a class="headerlink" href="#circular-references-in-javascript-objects" title="Permalink to this headline">#</a></h3>
<p>Ajv does not support schemas and validated data that have circular references in objects. See <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/802">issue #802</a>.</p>
<p>An attempt to compile such schemas or validate such data would cause stack overflow (or will not complete in case of asynchronous validation). Depending on the parser you use, untrusted data can lead to circular references.</p>
</section>
<section id="security-risks-of-trusted-schemas">
<h3>Security risks of trusted schemas<a class="headerlink" href="#security-risks-of-trusted-schemas" title="Permalink to this headline">#</a></h3>
<p>Some keywords in JSON Schemas can lead to very slow validation for certain data. These keywords include (but may be not limited to):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> and <code class="docutils literal notranslate"><span class="pre">format</span></code> for large strings - in some cases using <code class="docutils literal notranslate"><span class="pre">maxLength</span></code> can help mitigate it, but certain regular expressions can lead to exponential validation time even with relatively short strings (see <a class="reference external" href="#redos-attack">ReDoS attack</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patternProperties</span></code> for large property names - use <code class="docutils literal notranslate"><span class="pre">propertyNames</span></code> to mitigate, but some regular expressions can have exponential evaluation time as well.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniqueItems</span></code> for large non-scalar arrays - use <code class="docutils literal notranslate"><span class="pre">maxItems</span></code> to mitigate</p></li>
</ul>
<p><strong>Please note</strong>: The suggestions above to prevent slow validation would only work if you do NOT use <code class="docutils literal notranslate"><span class="pre">allErrors:</span> <span class="pre">true</span></code> in production code (using it would continue validation after validation errors).</p>
<p>You can validate your JSON schemas against <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/lib/refs/json-schema-secure.json">this meta-schema</a> to check that these recommendations are followed:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">isSchemaSecure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ajv/lib/refs/json-schema-secure.json&#39;</span><span class="p">));</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">schema1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;email&#39;</span><span class="p">};</span>
<span class="nx">isSchemaSecure</span><span class="p">(</span><span class="nx">schema1</span><span class="p">);</span><span class="w"> </span><span class="c1">// false</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">schema2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">maxLength</span><span class="o">:</span><span class="w"> </span><span class="nx">MAX_LENGTH</span><span class="p">};</span>
<span class="nx">isSchemaSecure</span><span class="p">(</span><span class="nx">schema2</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</pre></div>
</div>
<p><strong>Please note</strong>: following all these recommendation is not a guarantee that validation of untrusted data is safe - it can still lead to some undesirable results.</p>
</section>
<section id="content-security-policies-csp">
<h3>Content Security Policies (CSP)<a class="headerlink" href="#content-security-policies-csp" title="Permalink to this headline">#</a></h3>
<p>See <a class="reference external" href="#ajv-and-content-security-policies-csp">Ajv and Content Security Policies (CSP)</a></p>
</section>
</section>
<section id="redos-attack">
<h2>ReDoS attack<a class="headerlink" href="#redos-attack" title="Permalink to this headline">#</a></h2>
<p>Certain regular expressions can lead to the exponential evaluation time even with relatively short strings.</p>
<p>Please assess the regular expressions you use in the schemas on their vulnerability to this attack - see <a class="reference external" href="https://github.com/substack/safe-regex">safe-regex</a>, for example.</p>
<p><strong>Please note</strong>: some formats that Ajv implements use <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/formats.js">regular expressions</a> that can be vulnerable to ReDoS attack, so if you use Ajv to validate data from untrusted sources <strong>it is strongly recommended</strong> to consider the following:</p>
<ul class="simple">
<li><p>making assessment of “format” implementations in Ajv.</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">format:</span> <span class="pre">'fast'</span></code> option that simplifies some of the regular expressions (although it does not guarantee that they are safe).</p></li>
<li><p>replacing format implementations provided by Ajv with your own implementations of “format” keyword that either uses different regular expressions or another approach to format validation. Please see <a class="reference external" href="#api-addformat">addFormat</a> method.</p></li>
<li><p>disabling format validation by ignoring “format” keyword with option <code class="docutils literal notranslate"><span class="pre">format:</span> <span class="pre">false</span></code></p></li>
</ul>
<p>Whatever mitigation you choose, please assume all formats provided by Ajv as potentially unsafe and make your own assessment of their suitability for your validation scenarios.</p>
</section>
<section id="filtering-data">
<h2>Filtering data<a class="headerlink" href="#filtering-data" title="Permalink to this headline">#</a></h2>
<p>With <a class="reference external" href="#options">option <code class="docutils literal notranslate"><span class="pre">removeAdditional</span></code></a> (added by <a class="reference external" href="https://github.com/andyscott">andyscott</a>) you can filter data during the validation.</p>
<p>This option modifies original data.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">removeAdditional</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;additionalProperties&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;additionalProperties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;baz&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;additional1&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// will be removed; `additionalProperties` == false</span>
<span class="w">  </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;baz&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;abc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;additional2&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="c1">// will NOT be removed; `additionalProperties` != false</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// { &quot;foo&quot;: 0, &quot;bar&quot;: { &quot;baz&quot;: &quot;abc&quot;, &quot;additional2&quot;: 2 }</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">removeAdditional</span></code> option in the example above were <code class="docutils literal notranslate"><span class="pre">&quot;all&quot;</span></code> then both <code class="docutils literal notranslate"><span class="pre">additional1</span></code> and <code class="docutils literal notranslate"><span class="pre">additional2</span></code> properties would have been removed.</p>
<p>If the option were <code class="docutils literal notranslate"><span class="pre">&quot;failing&quot;</span></code> then property <code class="docutils literal notranslate"><span class="pre">additional1</span></code> would have been removed regardless of its value and property <code class="docutils literal notranslate"><span class="pre">additional2</span></code> would have been removed only if its value were failing the schema in the inner <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> (so in the example above it would have stayed because it passes the schema, but any non-number would have been removed).</p>
<p><strong>Please note</strong>: If you use <code class="docutils literal notranslate"><span class="pre">removeAdditional</span></code> option with <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> keyword inside <code class="docutils literal notranslate"><span class="pre">anyOf</span></code>/<code class="docutils literal notranslate"><span class="pre">oneOf</span></code> keywords your validation can fail with this schema, for example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;oneOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;foo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The intention of the schema above is to allow objects with either the string property “foo” or the integer property “bar”, but not with both and not with any other properties.</p>
<p>With the option <code class="docutils literal notranslate"><span class="pre">removeAdditional:</span> <span class="pre">true</span></code> the validation will pass for the object <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;foo&quot;:</span> <span class="pre">&quot;abc&quot;}</span></code> but will fail for the object <code class="docutils literal notranslate"><span class="pre">{&quot;bar&quot;:</span> <span class="pre">1}</span></code>. It happens because while the first subschema in <code class="docutils literal notranslate"><span class="pre">oneOf</span></code> is validated, the property <code class="docutils literal notranslate"><span class="pre">bar</span></code> is removed because it is an additional property according to the standard (because it is not included in <code class="docutils literal notranslate"><span class="pre">properties</span></code> keyword in the same schema).</p>
<p>While this behaviour is unexpected (issues <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/129">#129</a>, <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/134">#134</a>), it is correct. To have the expected behaviour (both objects are allowed and additional properties are removed) the schema has to be refactored in this way:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;foo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;oneOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The schema above is also more efficient - it will compile into a faster function.</p>
</section>
<section id="assigning-defaults">
<h2>Assigning defaults<a class="headerlink" href="#assigning-defaults" title="Permalink to this headline">#</a></h2>
<p>With <a class="reference external" href="#options">option <code class="docutils literal notranslate"><span class="pre">useDefaults</span></code></a> Ajv will assign values from <code class="docutils literal notranslate"><span class="pre">default</span></code> keyword in the schemas of <code class="docutils literal notranslate"><span class="pre">properties</span></code> and <code class="docutils literal notranslate"><span class="pre">items</span></code> (when it is the array of schemas) to the missing properties and items.</p>
<p>With the option value <code class="docutils literal notranslate"><span class="pre">&quot;empty&quot;</span></code> properties and items equal to <code class="docutils literal notranslate"><span class="pre">null</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (empty string) will be considered missing and assigned defaults.</p>
<p>This option modifies original data.</p>
<p><strong>Please note</strong>: the default value is inserted in the generated validation code as a literal, so the value inserted in the data will be the deep clone of the default in the schema.</p>
<p>Example 1 (<code class="docutils literal notranslate"><span class="pre">default</span></code> in <code class="docutils literal notranslate"><span class="pre">properties</span></code>):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">useDefaults</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;baz&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;required&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// { &quot;foo&quot;: 1, &quot;bar&quot;: &quot;baz&quot; }</span>
</pre></div>
</div>
<p>Example 2 (<code class="docutils literal notranslate"><span class="pre">default</span></code> in <code class="docutils literal notranslate"><span class="pre">items</span></code>):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;items&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">];</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// [ 1, &quot;foo&quot; ]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">default</span></code> keywords in other cases are ignored:</p>
<ul class="simple">
<li><p>not in <code class="docutils literal notranslate"><span class="pre">properties</span></code> or <code class="docutils literal notranslate"><span class="pre">items</span></code> subschemas</p></li>
<li><p>in schemas inside <code class="docutils literal notranslate"><span class="pre">anyOf</span></code>, <code class="docutils literal notranslate"><span class="pre">oneOf</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span></code> (see <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/42">#42</a>)</p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">if</span></code> subschema of <code class="docutils literal notranslate"><span class="pre">switch</span></code> keyword</p></li>
<li><p>in schemas generated by custom macro keywords</p></li>
</ul>
<p>The <a class="reference external" href="#options"><code class="docutils literal notranslate"><span class="pre">strictDefaults</span></code> option</a> customizes Ajv’s behavior for the defaults that Ajv ignores (<code class="docutils literal notranslate"><span class="pre">true</span></code> raises an error, and <code class="docutils literal notranslate"><span class="pre">&quot;log&quot;</span></code> outputs a warning).</p>
</section>
<section id="coercing-data-types">
<h2>Coercing data types<a class="headerlink" href="#coercing-data-types" title="Permalink to this headline">#</a></h2>
<p>When you are validating user inputs all your data properties are usually strings. The option <code class="docutils literal notranslate"><span class="pre">coerceTypes</span></code> allows you to have your data types coerced to the types specified in your schema <code class="docutils literal notranslate"><span class="pre">type</span></code> keywords, both to pass the validation and to use the correctly typed data afterwards.</p>
<p>This option modifies original data.</p>
<p><strong>Please note</strong>: if you pass a scalar value to the validating function its type will be coerced and it will pass the validation, but the value of the variable you pass won’t be updated because scalars are passed by value.</p>
<p>Example 1:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">coerceTypes</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;required&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// { &quot;foo&quot;: 1, &quot;bar&quot;: false }</span>
</pre></div>
</div>
<p>Example 2 (array coercions):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span><span class="w"> </span><span class="nx">coerceTypes</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;array&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;items&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;false&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// { &quot;foo&quot;: [1], &quot;bar&quot;: false }</span>
</pre></div>
</div>
<p>The coercion rules, as you can see from the example, are different from JavaScript both to validate user input as expected and to have the coercion reversible (to correctly validate cases where different types are defined in subschemas of “anyOf” and other compound keywords).</p>
<p>See <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/COERCION.md">Coercion rules</a> for details.</p>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">#</a></h2>
<section id="new-ajv-object-options-object">
<h3>new Ajv(Object options) -&gt; Object<a class="headerlink" href="#new-ajv-object-options-object" title="Permalink to this headline">#</a></h3>
<p>Create Ajv instance.</p>
</section>
<section id="compile-object-schema-function-object-data">
<h3>.compile(Object schema) -&gt; Function&lt;Object data&gt;<a class="headerlink" href="#compile-object-schema-function-object-data" title="Permalink to this headline">#</a></h3>
<p>Generate validating function and cache the compiled schema for future use.</p>
<p>Validating function returns a boolean value. This function has properties <code class="docutils literal notranslate"><span class="pre">errors</span></code> and <code class="docutils literal notranslate"><span class="pre">schema</span></code>. Errors encountered during the last validation are assigned to <code class="docutils literal notranslate"><span class="pre">errors</span></code> property (it is assigned <code class="docutils literal notranslate"><span class="pre">null</span></code> if there was no errors). <code class="docutils literal notranslate"><span class="pre">schema</span></code> property contains the reference to the original schema.</p>
<p>The schema passed to this method will be validated against meta-schema unless <code class="docutils literal notranslate"><span class="pre">validateSchema</span></code> option is false. If schema is invalid, an error will be thrown. See <a class="reference external" href="#options">options</a>.</p>
</section>
<section id="a-name-api-compileasync-a-compileasync-object-schema-boolean-meta-function-callback-promise">
<h3><a name="api-compileAsync"></a>.compileAsync(Object schema [, Boolean meta] [, Function callback]) -&gt; Promise<a class="headerlink" href="#a-name-api-compileasync-a-compileasync-object-schema-boolean-meta-function-callback-promise" title="Permalink to this headline">#</a></h3>
<p>Asynchronous version of <code class="docutils literal notranslate"><span class="pre">compile</span></code> method that loads missing remote schemas using asynchronous function in <code class="docutils literal notranslate"><span class="pre">options.loadSchema</span></code>. This function returns a Promise that resolves to a validation function. An optional callback passed to <code class="docutils literal notranslate"><span class="pre">compileAsync</span></code> will be called with 2 parameters: error (or null) and validating function. The returned promise will reject (and the callback will be called with an error) when:</p>
<ul class="simple">
<li><p>missing schema can’t be loaded (<code class="docutils literal notranslate"><span class="pre">loadSchema</span></code> returns a Promise that rejects).</p></li>
<li><p>a schema containing a missing reference is loaded, but the reference cannot be resolved.</p></li>
<li><p>schema (or some loaded/referenced schema) is invalid.</p></li>
</ul>
<p>The function compiles schema and loads the first missing schema (or meta-schema) until all missing schemas are loaded.</p>
<p>You can asynchronously compile meta-schema by passing <code class="docutils literal notranslate"><span class="pre">true</span></code> as the second parameter.</p>
<p>See example in <a class="reference external" href="#asynchronous-schema-compilation">Asynchronous compilation</a>.</p>
</section>
<section id="validate-object-schema-string-key-string-ref-data-boolean">
<h3>.validate(Object schema|String key|String ref, data) -&gt; Boolean<a class="headerlink" href="#validate-object-schema-string-key-string-ref-data-boolean" title="Permalink to this headline">#</a></h3>
<p>Validate data using passed schema (it will be compiled and cached).</p>
<p>Instead of the schema you can use the key that was previously passed to <code class="docutils literal notranslate"><span class="pre">addSchema</span></code>, the schema id if it was present in the schema or any previously resolved reference.</p>
<p>Validation errors will be available in the <code class="docutils literal notranslate"><span class="pre">errors</span></code> property of Ajv instance (<code class="docutils literal notranslate"><span class="pre">null</span></code> if there were no errors).</p>
<p><strong>Please note</strong>: every time this method is called the errors are overwritten so you need to copy them to another variable if you want to use them later.</p>
<p>If the schema is asynchronous (has <code class="docutils literal notranslate"><span class="pre">$async</span></code> keyword on the top level) this method returns a Promise. See <a class="reference external" href="#asynchronous-validation">Asynchronous validation</a>.</p>
</section>
<section id="addschema-array-object-object-schema-string-key-ajv">
<h3>.addSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv<a class="headerlink" href="#addschema-array-object-object-schema-string-key-ajv" title="Permalink to this headline">#</a></h3>
<p>Add schema(s) to validator instance. This method does not compile schemas (but it still validates them). Because of that dependencies can be added in any order and circular dependencies are supported. It also prevents unnecessary compilation of schemas that are containers for other schemas but not used as a whole.</p>
<p>Array of schemas can be passed (schemas should have ids), the second parameter will be ignored.</p>
<p>Key can be passed that can be used to reference the schema and will be used as the schema id if there is no id inside the schema. If the key is not passed, the schema id will be used as the key.</p>
<p>Once the schema is added, it (and all the references inside it) can be referenced in other schemas and used to validate data.</p>
<p>Although <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> does not compile schemas, explicit compilation is not required - the schema will be compiled when it is used first time.</p>
<p>By default the schema is validated against meta-schema before it is added, and if the schema does not pass validation the exception is thrown. This behaviour is controlled by <code class="docutils literal notranslate"><span class="pre">validateSchema</span></code> option.</p>
<p><strong>Please note</strong>: Ajv uses the <a class="reference external" href="https://en.wikipedia.org/wiki/Method_chaining">method chaining syntax</a> for all methods with the prefix <code class="docutils literal notranslate"><span class="pre">add*</span></code> and <code class="docutils literal notranslate"><span class="pre">remove*</span></code>.
This allows you to do nice things like the following.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">().</span><span class="nx">addSchema</span><span class="p">(</span><span class="nx">schema</span><span class="p">).</span><span class="nx">addFormat</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">regex</span><span class="p">).</span><span class="nx">getSchema</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="addmetaschema-array-object-object-schema-string-key-ajv">
<h3>.addMetaSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv<a class="headerlink" href="#addmetaschema-array-object-object-schema-string-key-ajv" title="Permalink to this headline">#</a></h3>
<p>Adds meta schema(s) that can be used to validate other schemas. That function should be used instead of <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> because there may be instance options that would compile a meta schema incorrectly (at the moment it is <code class="docutils literal notranslate"><span class="pre">removeAdditional</span></code> option).</p>
<p>There is no need to explicitly add draft-07 meta schema (http://json-schema.org/draft-07/schema) - it is added by default, unless option <code class="docutils literal notranslate"><span class="pre">meta</span></code> is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>. You only need to use it if you have a changed meta-schema that you want to use to validate your schemas. See <code class="docutils literal notranslate"><span class="pre">validateSchema</span></code>.</p>
</section>
<section id="a-name-api-validateschema-a-validateschema-object-schema-boolean">
<h3><a name="api-validateschema"></a>.validateSchema(Object schema) -&gt; Boolean<a class="headerlink" href="#a-name-api-validateschema-a-validateschema-object-schema-boolean" title="Permalink to this headline">#</a></h3>
<p>Validates schema. This method should be used to validate schemas rather than <code class="docutils literal notranslate"><span class="pre">validate</span></code> due to the inconsistency of <code class="docutils literal notranslate"><span class="pre">uri</span></code> format in JSON Schema standard.</p>
<p>By default this method is called automatically when the schema is added, so you rarely need to use it directly.</p>
<p>If schema doesn’t have <code class="docutils literal notranslate"><span class="pre">$schema</span></code> property, it is validated against draft 6 meta-schema (option <code class="docutils literal notranslate"><span class="pre">meta</span></code> should not be false).</p>
<p>If schema has <code class="docutils literal notranslate"><span class="pre">$schema</span></code> property, then the schema with this id (that should be previously added) is used to validate passed schema.</p>
<p>Errors will be available at <code class="docutils literal notranslate"><span class="pre">ajv.errors</span></code>.</p>
</section>
<section id="getschema-string-key-function-object-data">
<h3>.getSchema(String key) -&gt; Function&lt;Object data&gt;<a class="headerlink" href="#getschema-string-key-function-object-data" title="Permalink to this headline">#</a></h3>
<p>Retrieve compiled schema previously added with <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> by the key passed to <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> or by its full reference (id). The returned validating function has <code class="docutils literal notranslate"><span class="pre">schema</span></code> property with the reference to the original schema.</p>
</section>
<section id="removeschema-object-schema-string-key-string-ref-regexp-pattern-ajv">
<h3>.removeSchema([Object schema|String key|String ref|RegExp pattern]) -&gt; Ajv<a class="headerlink" href="#removeschema-object-schema-string-key-string-ref-regexp-pattern-ajv" title="Permalink to this headline">#</a></h3>
<p>Remove added/cached schema. Even if schema is referenced by other schemas it can be safely removed as dependent schemas have local references.</p>
<p>Schema can be removed using:</p>
<ul class="simple">
<li><p>key passed to <code class="docutils literal notranslate"><span class="pre">addSchema</span></code></p></li>
<li><p>it’s full reference (id)</p></li>
<li><p>RegExp that should match schema id or key (meta-schemas won’t be removed)</p></li>
<li><p>actual schema object that will be stable-stringified to remove schema from cache</p></li>
</ul>
<p>If no parameter is passed all schemas but meta-schemas will be removed and the cache will be cleared.</p>
</section>
<section id="a-name-api-addformat-a-addformat-string-name-string-regexp-function-object-format-ajv">
<h3><a name="api-addformat"></a>.addFormat(String name, String|RegExp|Function|Object format) -&gt; Ajv<a class="headerlink" href="#a-name-api-addformat-a-addformat-string-name-string-regexp-function-object-format-ajv" title="Permalink to this headline">#</a></h3>
<p>Add custom format to validate strings or numbers. It can also be used to replace pre-defined formats for Ajv instance.</p>
<p>Strings are converted to RegExp.</p>
<p>Function should return validation result as <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>If object is passed it should have properties <code class="docutils literal notranslate"><span class="pre">validate</span></code>, <code class="docutils literal notranslate"><span class="pre">compare</span></code> and <code class="docutils literal notranslate"><span class="pre">async</span></code>:</p>
<ul class="simple">
<li><p><em>validate</em>: a string, RegExp or a function as described above.</p></li>
<li><p><em>compare</em>: an optional comparison function that accepts two strings and compares them according to the format meaning. This function is used with keywords <code class="docutils literal notranslate"><span class="pre">formatMaximum</span></code>/<code class="docutils literal notranslate"><span class="pre">formatMinimum</span></code> (defined in <a class="reference external" href="https://github.com/ajv-validator/ajv-keywords">ajv-keywords</a> package). It should return <code class="docutils literal notranslate"><span class="pre">1</span></code> if the first value is bigger than the second value, <code class="docutils literal notranslate"><span class="pre">-1</span></code> if it is smaller and <code class="docutils literal notranslate"><span class="pre">0</span></code> if it is equal.</p></li>
<li><p><em>async</em>: an optional <code class="docutils literal notranslate"><span class="pre">true</span></code> value if <code class="docutils literal notranslate"><span class="pre">validate</span></code> is an asynchronous function; in this case it should return a promise that resolves with a value <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><em>type</em>: an optional type of data that the format applies to. It can be <code class="docutils literal notranslate"><span class="pre">&quot;string&quot;</span></code> (default) or <code class="docutils literal notranslate"><span class="pre">&quot;number&quot;</span></code> (see https://github.com/ajv-validator/ajv/issues/291#issuecomment-259923858). If the type of data is different, the validation will pass.</p></li>
</ul>
<p>Custom formats can be also added via <code class="docutils literal notranslate"><span class="pre">formats</span></code> option.</p>
</section>
<section id="a-name-api-addkeyword-a-addkeyword-string-keyword-object-definition-ajv">
<h3><a name="api-addkeyword"></a>.addKeyword(String keyword, Object definition) -&gt; Ajv<a class="headerlink" href="#a-name-api-addkeyword-a-addkeyword-string-keyword-object-definition-ajv" title="Permalink to this headline">#</a></h3>
<p>Add custom validation keyword to Ajv instance.</p>
<p>Keyword should be different from all standard JSON Schema keywords and different from previously defined keywords. There is no way to redefine keywords or to remove keyword definition from the instance.</p>
<p>Keyword must start with a letter, <code class="docutils literal notranslate"><span class="pre">_</span></code> or <code class="docutils literal notranslate"><span class="pre">$</span></code>, and may continue with letters, numbers, <code class="docutils literal notranslate"><span class="pre">_</span></code>, <code class="docutils literal notranslate"><span class="pre">$</span></code>, or <code class="docutils literal notranslate"><span class="pre">-</span></code>.
It is recommended to use an application-specific prefix for keywords to avoid current and future name collisions.</p>
<p>Example Keywords:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;xyz-example&quot;</span></code>: valid, and uses prefix for the xyz project to avoid name collisions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;example&quot;</span></code>: valid, but not recommended as it could collide with future versions of JSON Schema etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;3-example&quot;</span></code>: invalid as numbers are not allowed to be the first character in a keyword</p></li>
</ul>
<p>Keyword definition is an object with the following properties:</p>
<ul class="simple">
<li><p><em>type</em>: optional string or array of strings with data type(s) that the keyword applies to. If not present, the keyword will apply to all types.</p></li>
<li><p><em>validate</em>: validating function</p></li>
<li><p><em>compile</em>: compiling function</p></li>
<li><p><em>macro</em>: macro function</p></li>
<li><p><em>inline</em>: compiling function that returns code (as string)</p></li>
<li><p><em>schema</em>: an optional <code class="docutils literal notranslate"><span class="pre">false</span></code> value used with “validate” keyword to not pass schema</p></li>
<li><p><em>metaSchema</em>: an optional meta-schema for keyword schema</p></li>
<li><p><em>dependencies</em>: an optional list of properties that must be present in the parent schema - it will be checked during schema compilation</p></li>
<li><p><em>modifying</em>: <code class="docutils literal notranslate"><span class="pre">true</span></code> MUST be passed if keyword modifies data</p></li>
<li><p><em>statements</em>: <code class="docutils literal notranslate"><span class="pre">true</span></code> can be passed in case inline keyword generates statements (as opposed to expression)</p></li>
<li><p><em>valid</em>: pass <code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code> to pre-define validation result, the result returned from validation function will be ignored. This option cannot be used with macro keywords.</p></li>
<li><p><em>$data</em>: an optional <code class="docutils literal notranslate"><span class="pre">true</span></code> value to support <a class="reference external" href="#data-reference">$data reference</a> as the value of custom keyword. The reference will be resolved at validation time. If the keyword has meta-schema it would be extended to allow $data and it will be used to validate the resolved value. Supporting $data reference requires that keyword has validating function (as the only option or in addition to compile, macro or inline function).</p></li>
<li><p><em>async</em>: an optional <code class="docutils literal notranslate"><span class="pre">true</span></code> value if the validation function is asynchronous (whether it is compiled or passed in <em>validate</em> property); in this case it should return a promise that resolves with a value <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. This option is ignored in case of “macro” and “inline” keywords.</p></li>
<li><p><em>errors</em>: an optional boolean or string <code class="docutils literal notranslate"><span class="pre">&quot;full&quot;</span></code> indicating whether keyword returns errors. If this property is not set Ajv will determine if the errors were set in case of failed validation.</p></li>
</ul>
<p><em>compile</em>, <em>macro</em> and <em>inline</em> are mutually exclusive, only one should be used at a time. <em>validate</em> can be used separately or in addition to them to support $data reference.</p>
<p><strong>Please note</strong>: If the keyword is validating data type that is different from the type(s) in its definition, the validation function will not be called (and expanded macro will not be used), so there is no need to check for data type inside validation function or inside schema returned by macro function (unless you want to enforce a specific type and for some reason do not want to use a separate <code class="docutils literal notranslate"><span class="pre">type</span></code> keyword for that). In the same way as standard keywords work, if the keyword does not apply to the data type being validated, the validation of this keyword will succeed.</p>
<p>See <a class="reference external" href="#defining-custom-keywords">Defining custom keywords</a> for more details.</p>
</section>
<section id="getkeyword-string-keyword-object-boolean">
<h3>.getKeyword(String keyword) -&gt; Object|Boolean<a class="headerlink" href="#getkeyword-string-keyword-object-boolean" title="Permalink to this headline">#</a></h3>
<p>Returns custom keyword definition, <code class="docutils literal notranslate"><span class="pre">true</span></code> for pre-defined keywords and <code class="docutils literal notranslate"><span class="pre">false</span></code> if the keyword is unknown.</p>
</section>
<section id="removekeyword-string-keyword-ajv">
<h3>.removeKeyword(String keyword) -&gt; Ajv<a class="headerlink" href="#removekeyword-string-keyword-ajv" title="Permalink to this headline">#</a></h3>
<p>Removes custom or pre-defined keyword so you can redefine them.</p>
<p>While this method can be used to extend pre-defined keywords, it can also be used to completely change their meaning - it may lead to unexpected results.</p>
<p><strong>Please note</strong>: schemas compiled before the keyword is removed will continue to work without changes. To recompile schemas use <code class="docutils literal notranslate"><span class="pre">removeSchema</span></code> method and compile them again.</p>
</section>
<section id="errorstext-array-object-errors-object-options-string">
<h3>.errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String<a class="headerlink" href="#errorstext-array-object-errors-object-options-string" title="Permalink to this headline">#</a></h3>
<p>Returns the text with all errors in a String.</p>
<p>Options can have properties <code class="docutils literal notranslate"><span class="pre">separator</span></code> (string used to separate errors, “, ” by default) and <code class="docutils literal notranslate"><span class="pre">dataVar</span></code> (the variable name that dataPaths are prefixed with, “data” by default).</p>
</section>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">#</a></h2>
<p>Defaults:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">// validation and reporting options:</span>
<span class="w">  </span><span class="nx">$data</span><span class="o">:</span><span class="w">            </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">allErrors</span><span class="o">:</span><span class="w">        </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">verbose</span><span class="o">:</span><span class="w">          </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">$comment</span><span class="o">:</span><span class="w">         </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="c1">// NEW in Ajv version 6.0</span>
<span class="w">  </span><span class="nx">jsonPointers</span><span class="o">:</span><span class="w">     </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">uniqueItems</span><span class="o">:</span><span class="w">      </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">unicode</span><span class="o">:</span><span class="w">          </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">nullable</span><span class="o">:</span><span class="w">         </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">format</span><span class="o">:</span><span class="w">           </span><span class="s1">&#39;fast&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">formats</span><span class="o">:</span><span class="w">          </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">unknownFormats</span><span class="o">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">schemas</span><span class="o">:</span><span class="w">          </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">logger</span><span class="o">:</span><span class="w">           </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">  </span><span class="c1">// referenced schema options:</span>
<span class="w">  </span><span class="nx">schemaId</span><span class="o">:</span><span class="w">         </span><span class="s1">&#39;$id&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">missingRefs</span><span class="o">:</span><span class="w">      </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">extendRefs</span><span class="o">:</span><span class="w">       </span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// recommended &#39;fail&#39;</span>
<span class="w">  </span><span class="nx">loadSchema</span><span class="o">:</span><span class="w">       </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="c1">// function(uri: string): Promise {}</span>
<span class="w">  </span><span class="c1">// options to modify validated data:</span>
<span class="w">  </span><span class="nx">removeAdditional</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">useDefaults</span><span class="o">:</span><span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">coerceTypes</span><span class="o">:</span><span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="c1">// strict mode options</span>
<span class="w">  </span><span class="nx">strictDefaults</span><span class="o">:</span><span class="w">   </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">strictKeywords</span><span class="o">:</span><span class="w">   </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">strictNumbers</span><span class="o">:</span><span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="c1">// asynchronous validation options:</span>
<span class="w">  </span><span class="nx">transpile</span><span class="o">:</span><span class="w">        </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="c1">// requires ajv-async package</span>
<span class="w">  </span><span class="c1">// advanced options:</span>
<span class="w">  </span><span class="nx">meta</span><span class="o">:</span><span class="w">             </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">validateSchema</span><span class="o">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">addUsedSchema</span><span class="o">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">inlineRefs</span><span class="o">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">passContext</span><span class="o">:</span><span class="w">      </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">loopRequired</span><span class="o">:</span><span class="w">     </span><span class="kc">Infinity</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ownProperties</span><span class="o">:</span><span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">multipleOfPrecision</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">errorDataPath</span><span class="o">:</span><span class="w">    </span><span class="s1">&#39;object&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// deprecated</span>
<span class="w">  </span><span class="nx">messages</span><span class="o">:</span><span class="w">         </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sourceCode</span><span class="o">:</span><span class="w">       </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">processCode</span><span class="o">:</span><span class="w">      </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="c1">// function (str: string, schema: object): string {}</span>
<span class="w">  </span><span class="nx">cache</span><span class="o">:</span><span class="w">            </span><span class="ow">new</span><span class="w"> </span><span class="nx">Cache</span><span class="p">,</span>
<span class="w">  </span><span class="nx">serialize</span><span class="o">:</span><span class="w">        </span><span class="kc">undefined</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="validation-and-reporting-options">
<h3>Validation and reporting options<a class="headerlink" href="#validation-and-reporting-options" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>$data</em>: support <a class="reference external" href="#data-reference">$data references</a>. Draft 6 meta-schema that is added by default will be extended to allow them. If you want to use another meta-schema you need to use $dataMetaSchema method to add support for $data reference. See <a class="reference external" href="#api">API</a>.</p></li>
<li><p><em>allErrors</em>: check all rules collecting all errors. Default is to return after the first error.</p></li>
<li><p><em>verbose</em>: include the reference to the part of the schema (<code class="docutils literal notranslate"><span class="pre">schema</span></code> and <code class="docutils literal notranslate"><span class="pre">parentSchema</span></code>) and validated data in errors (false by default).</p></li>
<li><p><em>$comment</em> (NEW in Ajv version 6.0): log or pass the value of <code class="docutils literal notranslate"><span class="pre">$comment</span></code> keyword to a function. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default): ignore $comment keyword.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code>: log the keyword value to console.</p></li>
<li><p>function: pass the keyword value, its schema path and root schema to the specified function</p></li>
</ul>
</li>
<li><p><em>jsonPointers</em>: set <code class="docutils literal notranslate"><span class="pre">dataPath</span></code> property of errors using <a class="reference external" href="https://tools.ietf.org/html/rfc6901">JSON Pointers</a> instead of JavaScript property access notation.</p></li>
<li><p><em>uniqueItems</em>: validate <code class="docutils literal notranslate"><span class="pre">uniqueItems</span></code> keyword (true by default).</p></li>
<li><p><em>unicode</em>: calculate correct length of strings with unicode pairs (true by default). Pass <code class="docutils literal notranslate"><span class="pre">false</span></code> to use <code class="docutils literal notranslate"><span class="pre">.length</span></code> of strings that is faster, but gives “incorrect” lengths of strings with unicode pairs - each unicode pair is counted as two characters.</p></li>
<li><p><em>nullable</em>: support keyword “nullable” from <a class="reference external" href="https://swagger.io/docs/specification/data-models/data-types/">Open API 3 specification</a>.</p></li>
<li><p><em>format</em>: formats validation mode. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fast&quot;</span></code> (default) - simplified and fast validation (see <a class="reference external" href="#formats">Formats</a> for details of which formats are available and affected by this option).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;full&quot;</span></code> - more restrictive and slow validation. E.g., 25:00:00 and 2015/14/33 will be invalid time and date in ‘full’ mode but it will be valid in ‘fast’ mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> - ignore all format keywords.</p></li>
</ul>
</li>
<li><p><em>formats</em>: an object with custom formats. Keys and values will be passed to <code class="docutils literal notranslate"><span class="pre">addFormat</span></code> method.</p></li>
<li><p><em>keywords</em>: an object with custom keywords. Keys and values will be passed to <code class="docutils literal notranslate"><span class="pre">addKeyword</span></code> method.</p></li>
<li><p><em>unknownFormats</em>: handling of unknown formats. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> (default) - if an unknown format is encountered the exception is thrown during schema compilation. If <code class="docutils literal notranslate"><span class="pre">format</span></code> keyword value is <a class="reference external" href="#data-reference">$data reference</a> and it is unknown the validation will fail.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[String]</span></code> - an array of unknown format names that will be ignored. This option can be used to allow usage of third party schemas with format(s) for which you don’t have definitions, but still fail if another unknown format is used. If <code class="docutils literal notranslate"><span class="pre">format</span></code> keyword value is <a class="reference external" href="#data-reference">$data reference</a> and it is not in this array the validation will fail.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code> - to log warning during schema compilation and always pass validation (the default behaviour in versions before 5.0.0). This option is not recommended, as it allows to mistype format name and it won’t be validated without any error message. This behaviour is required by JSON Schema specification.</p></li>
</ul>
</li>
<li><p><em>schemas</em>: an array or object of schemas that will be added to the instance. In case you pass the array the schemas must have IDs in them. When the object is passed the method <code class="docutils literal notranslate"><span class="pre">addSchema(value,</span> <span class="pre">key)</span></code> will be called for each schema in this object.</p></li>
<li><p><em>logger</em>: sets the logging method. Default is the global <code class="docutils literal notranslate"><span class="pre">console</span></code> object that should have methods <code class="docutils literal notranslate"><span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code> and <code class="docutils literal notranslate"><span class="pre">error</span></code>. See <a class="reference external" href="#error-logging">Error logging</a>. Option values:</p>
<ul>
<li><p>custom logger - it should have methods <code class="docutils literal notranslate"><span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code> and <code class="docutils literal notranslate"><span class="pre">error</span></code>. If any of these methods is missing an exception will be thrown.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> - logging is disabled.</p></li>
</ul>
</li>
</ul>
</section>
<section id="referenced-schema-options">
<h3>Referenced schema options<a class="headerlink" href="#referenced-schema-options" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>schemaId</em>: this option defines which keywords are used as schema URI. Option value:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;$id&quot;</span></code> (default) - only use <code class="docutils literal notranslate"><span class="pre">$id</span></code> keyword as schema URI (as specified in JSON Schema draft-06/07), ignore <code class="docutils literal notranslate"><span class="pre">id</span></code> keyword (if it is present a warning will be logged).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;id&quot;</span></code> - only use <code class="docutils literal notranslate"><span class="pre">id</span></code> keyword as schema URI (as specified in JSON Schema draft-04), ignore <code class="docutils literal notranslate"><span class="pre">$id</span></code> keyword (if it is present a warning will be logged).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> - use both <code class="docutils literal notranslate"><span class="pre">$id</span></code> and <code class="docutils literal notranslate"><span class="pre">id</span></code> keywords as schema URI. If both are present (in the same schema object) and different the exception will be thrown during schema compilation.</p></li>
</ul>
</li>
<li><p><em>missingRefs</em>: handling of missing referenced schemas. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> (default) - if the reference cannot be resolved during compilation the exception is thrown. The thrown error has properties <code class="docutils literal notranslate"><span class="pre">missingRef</span></code> (with hash fragment) and <code class="docutils literal notranslate"><span class="pre">missingSchema</span></code> (without it). Both properties are resolved relative to the current base id (usually schema id, unless it was substituted).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code> - to log error during compilation and always pass validation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fail&quot;</span></code> - to log error and successfully compile schema but fail validation if this rule is checked.</p></li>
</ul>
</li>
<li><p><em>extendRefs</em>: validation of other keywords when <code class="docutils literal notranslate"><span class="pre">$ref</span></code> is present in the schema. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code> (default) - when <code class="docutils literal notranslate"><span class="pre">$ref</span></code> is used other keywords are ignored (as per <a class="reference external" href="https://tools.ietf.org/html/draft-pbryan-zyp-json-ref-03#section-3">JSON Reference</a> standard). A warning will be logged during the schema compilation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fail&quot;</span></code> (recommended) - if other validation keywords are used together with <code class="docutils literal notranslate"><span class="pre">$ref</span></code> the exception will be thrown when the schema is compiled. This option is recommended to make sure schema has no keywords that are ignored, which can be confusing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - validate all keywords in the schemas with <code class="docutils literal notranslate"><span class="pre">$ref</span></code> (the default behaviour in versions before 5.0.0).</p></li>
</ul>
</li>
<li><p><em>loadSchema</em>: asynchronous function that will be used to load remote schemas when <code class="docutils literal notranslate"><span class="pre">compileAsync</span></code> <a class="reference external" href="#api-compileAsync">method</a> is used and some reference is missing (option <code class="docutils literal notranslate"><span class="pre">missingRefs</span></code> should NOT be ‘fail’ or ‘ignore’). This function should accept remote schema uri as a parameter and return a Promise that resolves to a schema. See example in <a class="reference external" href="#asynchronous-schema-compilation">Asynchronous compilation</a>.</p></li>
</ul>
</section>
<section id="options-to-modify-validated-data">
<h3>Options to modify validated data<a class="headerlink" href="#options-to-modify-validated-data" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>removeAdditional</em>: remove additional properties - see example in <a class="reference external" href="#filtering-data">Filtering data</a>. This option is not used if schema is added with <code class="docutils literal notranslate"><span class="pre">addMetaSchema</span></code> method. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - not to remove additional properties</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;all&quot;</span></code> - all additional properties are removed, regardless of <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> keyword in schema (and no validation is made for them).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - only additional properties with <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> keyword equal to <code class="docutils literal notranslate"><span class="pre">false</span></code> are removed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;failing&quot;</span></code> - additional properties that fail schema validation will be removed (where <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> keyword is <code class="docutils literal notranslate"><span class="pre">false</span></code> or schema).</p></li>
</ul>
</li>
<li><p><em>useDefaults</em>: replace missing or undefined properties and items with the values from corresponding <code class="docutils literal notranslate"><span class="pre">default</span></code> keywords. Default behaviour is to ignore <code class="docutils literal notranslate"><span class="pre">default</span></code> keywords. This option is not used if schema is added with <code class="docutils literal notranslate"><span class="pre">addMetaSchema</span></code> method. See examples in <a class="reference external" href="#assigning-defaults">Assigning defaults</a>. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - do not use defaults</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - insert defaults by value (object literal is used).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;empty&quot;</span></code> - in addition to missing or undefined, use defaults for properties and items that are equal to <code class="docutils literal notranslate"><span class="pre">null</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (an empty string).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;shared&quot;</span></code> (deprecated) - insert defaults by reference. If the default is an object, it will be shared by all instances of validated data. If you modify the inserted default in the validated data, it will be modified in the schema as well.</p></li>
</ul>
</li>
<li><p><em>coerceTypes</em>: change data type of data to match <code class="docutils literal notranslate"><span class="pre">type</span></code> keyword. See the example in <a class="reference external" href="#coercing-data-types">Coercing data types</a> and <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/COERCION.md">coercion rules</a>. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - no type coercion.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - coerce scalar data types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code> - in addition to coercions between scalar types, coerce scalar data to an array with one element and vice versa (as required by the schema).</p></li>
</ul>
</li>
</ul>
</section>
<section id="strict-mode-options">
<h3>Strict mode options<a class="headerlink" href="#strict-mode-options" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>strictDefaults</em>: report ignored <code class="docutils literal notranslate"><span class="pre">default</span></code> keywords in schemas. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - ignored defaults are not reported</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - if an ignored default is present, throw an error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;log&quot;</span></code> - if an ignored default is present, log warning</p></li>
</ul>
</li>
<li><p><em>strictKeywords</em>: report unknown keywords in schemas. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - unknown keywords are not reported</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - if an unknown keyword is present, throw an error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;log&quot;</span></code> - if an unknown keyword is present, log warning</p></li>
</ul>
</li>
<li><p><em>strictNumbers</em>: validate numbers strictly, failing validation for NaN and Infinity. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> (default) - NaN or Infinity will pass validation for numeric types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - NaN or Infinity will not pass validation for numeric types</p></li>
</ul>
</li>
</ul>
</section>
<section id="asynchronous-validation-options">
<h3>Asynchronous validation options<a class="headerlink" href="#asynchronous-validation-options" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>transpile</em>: Requires <a class="reference external" href="https://github.com/ajv-validator/ajv-async">ajv-async</a> package. It determines whether Ajv transpiles compiled asynchronous validation function. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code> (default) - transpile with <a class="reference external" href="https://github.com/MatAtBread/nodent">nodent</a> if async functions are not supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> - always transpile with nodent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> - do not transpile; if async functions are not supported an exception will be thrown.</p></li>
</ul>
</li>
</ul>
</section>
<section id="advanced-options">
<h3>Advanced options<a class="headerlink" href="#advanced-options" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>meta</em>: add <a class="reference external" href="http://json-schema.org/documentation.html">meta-schema</a> so it can be used by other schemas (true by default). If an object is passed, it will be used as the default meta-schema for schemas that have no <code class="docutils literal notranslate"><span class="pre">$schema</span></code> keyword. This default meta-schema MUST have <code class="docutils literal notranslate"><span class="pre">$schema</span></code> keyword.</p></li>
<li><p><em>validateSchema</em>: validate added/compiled schemas against meta-schema (true by default). <code class="docutils literal notranslate"><span class="pre">$schema</span></code> property in the schema can be http://json-schema.org/draft-07/schema or absent (draft-07 meta-schema will be used) or can be a reference to the schema previously added with <code class="docutils literal notranslate"><span class="pre">addMetaSchema</span></code> method. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> (default) -  if the validation fails, throw the exception.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;log&quot;</span></code> - if the validation fails, log error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> - skip schema validation.</p></li>
</ul>
</li>
<li><p><em>addUsedSchema</em>: by default methods <code class="docutils literal notranslate"><span class="pre">compile</span></code> and <code class="docutils literal notranslate"><span class="pre">validate</span></code> add schemas to the instance if they have <code class="docutils literal notranslate"><span class="pre">$id</span></code> (or <code class="docutils literal notranslate"><span class="pre">id</span></code>) property that doesn’t start with “#”. If <code class="docutils literal notranslate"><span class="pre">$id</span></code> is present and it is not unique the exception will be thrown. Set this option to <code class="docutils literal notranslate"><span class="pre">false</span></code> to skip adding schemas to the instance and the <code class="docutils literal notranslate"><span class="pre">$id</span></code> uniqueness check when these methods are used. This option does not affect <code class="docutils literal notranslate"><span class="pre">addSchema</span></code> method.</p></li>
<li><p><em>inlineRefs</em>: Affects compilation of referenced schemas. Option values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> (default) - the referenced schemas that don’t have refs in them are inlined, regardless of their size - that substantially improves performance at the cost of the bigger size of compiled schema functions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> - to not inline referenced schemas (they will be compiled as separate functions).</p></li>
<li><p>integer number - to limit the maximum number of keywords of the schema that will be inlined.</p></li>
</ul>
</li>
<li><p><em>passContext</em>: pass validation context to custom keyword functions. If this option is <code class="docutils literal notranslate"><span class="pre">true</span></code> and you pass some context to the compiled validation function with <code class="docutils literal notranslate"><span class="pre">validate.call(context,</span> <span class="pre">data)</span></code>, the <code class="docutils literal notranslate"><span class="pre">context</span></code> will be available as <code class="docutils literal notranslate"><span class="pre">this</span></code> in your custom keywords. By default <code class="docutils literal notranslate"><span class="pre">this</span></code> is Ajv instance.</p></li>
<li><p><em>loopRequired</em>: by default <code class="docutils literal notranslate"><span class="pre">required</span></code> keyword is compiled into a single expression (or a sequence of statements in <code class="docutils literal notranslate"><span class="pre">allErrors</span></code> mode). In case of a very large number of properties in this keyword it may result in a very big validation function. Pass integer to set the number of properties above which <code class="docutils literal notranslate"><span class="pre">required</span></code> keyword will be validated in a loop - smaller validation function size but also worse performance.</p></li>
<li><p><em>ownProperties</em>: by default Ajv iterates over all enumerable object properties; when this option is <code class="docutils literal notranslate"><span class="pre">true</span></code> only own enumerable object properties (i.e. found directly on the object rather than on its prototype) are iterated. Contributed by &#64;mbroadst.</p></li>
<li><p><em>multipleOfPrecision</em>: by default <code class="docutils literal notranslate"><span class="pre">multipleOf</span></code> keyword is validated by comparing the result of division with parseInt() of that result. It works for dividers that are bigger than 1. For small dividers such as 0.01 the result of the division is usually not integer (even when it should be integer, see issue <a class="reference external" href="https://github.com/ajv-validator/ajv/issues/84">#84</a>). If you need to use fractional dividers set this option to some positive integer N to have <code class="docutils literal notranslate"><span class="pre">multipleOf</span></code> validated using this formula: <code class="docutils literal notranslate"><span class="pre">Math.abs(Math.round(division)</span> <span class="pre">-</span> <span class="pre">division)</span> <span class="pre">&lt;</span> <span class="pre">1e-N</span></code> (it is slower but allows for float arithmetics deviations).</p></li>
<li><p><em>errorDataPath</em> (deprecated): set <code class="docutils literal notranslate"><span class="pre">dataPath</span></code> to point to ‘object’ (default) or to ‘property’ when validating keywords <code class="docutils literal notranslate"><span class="pre">required</span></code>, <code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> and <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>.</p></li>
<li><p><em>messages</em>: Include human-readable messages in errors. <code class="docutils literal notranslate"><span class="pre">true</span></code> by default. <code class="docutils literal notranslate"><span class="pre">false</span></code> can be passed when custom messages are used (e.g. with <a class="reference external" href="https://github.com/ajv-validator/ajv-i18n">ajv-i18n</a>).</p></li>
<li><p><em>sourceCode</em>: add <code class="docutils literal notranslate"><span class="pre">sourceCode</span></code> property to validating function (for debugging; this code can be different from the result of toString call).</p></li>
<li><p><em>processCode</em>: an optional function to process generated code before it is passed to Function constructor. It can be used to either beautify (the validating function is generated without line-breaks) or to transpile code. Starting from version 5.0.0 this option replaced options:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">beautify</span></code> that formatted the generated function using <a class="reference external" href="https://github.com/beautify-web/js-beautify">js-beautify</a>. If you want to beautify the generated code pass a function calling <code class="docutils literal notranslate"><span class="pre">require('js-beautify').js_beautify</span></code> as <code class="docutils literal notranslate"><span class="pre">processCode:</span> <span class="pre">code</span> <span class="pre">=&gt;</span> <span class="pre">js_beautify(code)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transpile</span></code> that transpiled asynchronous validation function. You can still use <code class="docutils literal notranslate"><span class="pre">transpile</span></code> option with <a class="reference external" href="https://github.com/ajv-validator/ajv-async">ajv-async</a> package. See <a class="reference external" href="#asynchronous-validation">Asynchronous validation</a> for more information.</p></li>
</ul>
</li>
<li><p><em>cache</em>: an optional instance of cache to store compiled schemas using stable-stringified schema as a key. For example, set-associative cache <a class="reference external" href="https://github.com/epoberezkin/sacjs">sacjs</a> can be used. If not passed then a simple hash is used which is good enough for the common use case (a limited number of statically defined schemas). Cache should have methods <code class="docutils literal notranslate"><span class="pre">put(key,</span> <span class="pre">value)</span></code>, <code class="docutils literal notranslate"><span class="pre">get(key)</span></code>, <code class="docutils literal notranslate"><span class="pre">del(key)</span></code> and <code class="docutils literal notranslate"><span class="pre">clear()</span></code>.</p></li>
<li><p><em>serialize</em>: an optional function to serialize schema to cache key. Pass <code class="docutils literal notranslate"><span class="pre">false</span></code> to use schema itself as a key (e.g., if WeakMap used as a cache). By default <a class="reference external" href="https://github.com/epoberezkin/fast-json-stable-stringify">fast-json-stable-stringify</a> is used.</p></li>
</ul>
</section>
</section>
<section id="validation-errors">
<h2>Validation errors<a class="headerlink" href="#validation-errors" title="Permalink to this headline">#</a></h2>
<p>In case of validation failure, Ajv assigns the array of errors to <code class="docutils literal notranslate"><span class="pre">errors</span></code> property of validation function (or to <code class="docutils literal notranslate"><span class="pre">errors</span></code> property of Ajv instance when <code class="docutils literal notranslate"><span class="pre">validate</span></code> or <code class="docutils literal notranslate"><span class="pre">validateSchema</span></code> methods were called). In case of <a class="reference external" href="#asynchronous-validation">asynchronous validation</a>, the returned promise is rejected with exception <code class="docutils literal notranslate"><span class="pre">Ajv.ValidationError</span></code> that has <code class="docutils literal notranslate"><span class="pre">errors</span></code> property.</p>
<section id="error-objects">
<h3>Error objects<a class="headerlink" href="#error-objects" title="Permalink to this headline">#</a></h3>
<p>Each error is an object with the following properties:</p>
<ul class="simple">
<li><p><em>keyword</em>: validation keyword.</p></li>
<li><p><em>dataPath</em>: the path to the part of the data that was validated. By default <code class="docutils literal notranslate"><span class="pre">dataPath</span></code> uses JavaScript property access notation (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;.prop[1].subProp&quot;</span></code>). When the option <code class="docutils literal notranslate"><span class="pre">jsonPointers</span></code> is true (see <a class="reference external" href="#options">Options</a>) <code class="docutils literal notranslate"><span class="pre">dataPath</span></code> will be set using JSON pointer standard (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;/prop/1/subProp&quot;</span></code>).</p></li>
<li><p><em>schemaPath</em>: the path (JSON-pointer as a URI fragment) to the schema of the keyword that failed validation.</p></li>
<li><p><em>params</em>: the object with the additional information about error that can be used to create custom error messages (e.g., using <a class="reference external" href="https://github.com/ajv-validator/ajv-i18n">ajv-i18n</a> package). See below for parameters set by all keywords.</p></li>
<li><p><em>message</em>: the standard error message (can be excluded with option <code class="docutils literal notranslate"><span class="pre">messages</span></code> set to false).</p></li>
<li><p><em>schema</em>: the schema of the keyword (added with <code class="docutils literal notranslate"><span class="pre">verbose</span></code> option).</p></li>
<li><p><em>parentSchema</em>: the schema containing the keyword (added with <code class="docutils literal notranslate"><span class="pre">verbose</span></code> option)</p></li>
<li><p><em>data</em>: the data validated by the keyword (added with <code class="docutils literal notranslate"><span class="pre">verbose</span></code> option).</p></li>
</ul>
<p><strong>Please note</strong>: <code class="docutils literal notranslate"><span class="pre">propertyNames</span></code> keyword schema validation errors have an additional property <code class="docutils literal notranslate"><span class="pre">propertyName</span></code>, <code class="docutils literal notranslate"><span class="pre">dataPath</span></code> points to the object. After schema validation for each property name, if it is invalid an additional error is added with the property <code class="docutils literal notranslate"><span class="pre">keyword</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;propertyNames&quot;</span></code>.</p>
</section>
<section id="error-parameters">
<h3>Error parameters<a class="headerlink" href="#error-parameters" title="Permalink to this headline">#</a></h3>
<p>Properties of <code class="docutils literal notranslate"><span class="pre">params</span></code> object in errors depend on the keyword that failed validation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxItems</span></code>, <code class="docutils literal notranslate"><span class="pre">minItems</span></code>, <code class="docutils literal notranslate"><span class="pre">maxLength</span></code>, <code class="docutils literal notranslate"><span class="pre">minLength</span></code>, <code class="docutils literal notranslate"><span class="pre">maxProperties</span></code>, <code class="docutils literal notranslate"><span class="pre">minProperties</span></code> - property <code class="docutils literal notranslate"><span class="pre">limit</span></code> (number, the schema of the keyword).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">additionalItems</span></code> - property <code class="docutils literal notranslate"><span class="pre">limit</span></code> (the maximum number of allowed items in case when <code class="docutils literal notranslate"><span class="pre">items</span></code> keyword is an array of schemas and <code class="docutils literal notranslate"><span class="pre">additionalItems</span></code> is false).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">additionalProperties</span></code> - property <code class="docutils literal notranslate"><span class="pre">additionalProperty</span></code> (the property not used in <code class="docutils literal notranslate"><span class="pre">properties</span></code> and <code class="docutils literal notranslate"><span class="pre">patternProperties</span></code> keywords).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dependencies</span></code> - properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">property</span></code> (dependent property),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">missingProperty</span></code> (required missing dependency - only the first one is reported currently)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deps</span></code> (required dependencies, comma separated list as a string),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depsCount</span></code> (the number of required dependencies).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code> - property <code class="docutils literal notranslate"><span class="pre">format</span></code> (the schema of the keyword).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maximum</span></code>, <code class="docutils literal notranslate"><span class="pre">minimum</span></code> - properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> (number, the schema of the keyword),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exclusive</span></code> (boolean, the schema of <code class="docutils literal notranslate"><span class="pre">exclusiveMaximum</span></code> or <code class="docutils literal notranslate"><span class="pre">exclusiveMinimum</span></code>),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">comparison</span></code> (string, comparison operation to compare the data to the limit, with the data on the left and the limit on the right; can be “&lt;”, “&lt;=”, “&gt;”, “&gt;=”)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">multipleOf</span></code> - property <code class="docutils literal notranslate"><span class="pre">multipleOf</span></code> (the schema of the keyword)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> - property <code class="docutils literal notranslate"><span class="pre">pattern</span></code> (the schema of the keyword)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">required</span></code> - property <code class="docutils literal notranslate"><span class="pre">missingProperty</span></code> (required property that is missing).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">propertyNames</span></code> - property <code class="docutils literal notranslate"><span class="pre">propertyName</span></code> (an invalid property name).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patternRequired</span></code> (in ajv-keywords) - property <code class="docutils literal notranslate"><span class="pre">missingPattern</span></code> (required pattern that did not match any property).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> - property <code class="docutils literal notranslate"><span class="pre">type</span></code> (required type(s), a string, can be a comma-separated list)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniqueItems</span></code> - properties <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code> (indices of duplicate items).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span></code> - property <code class="docutils literal notranslate"><span class="pre">allowedValue</span></code> pointing to the value (the schema of the keyword).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enum</span></code> - property <code class="docutils literal notranslate"><span class="pre">allowedValues</span></code> pointing to the array of values (the schema of the keyword).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ref</span></code> - property <code class="docutils literal notranslate"><span class="pre">ref</span></code> with the referenced schema URI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oneOf</span></code> - property <code class="docutils literal notranslate"><span class="pre">passingSchemas</span></code> (array of indices of passing schemas, null if no schema passes).</p></li>
<li><p>custom keywords (in case keyword definition doesn’t create errors) - property <code class="docutils literal notranslate"><span class="pre">keyword</span></code> (the keyword name).</p></li>
</ul>
</section>
<section id="error-logging">
<h3>Error logging<a class="headerlink" href="#error-logging" title="Permalink to this headline">#</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">logger</span></code> option when initiallizing Ajv will allow you to define custom logging. Here you can build upon the exisiting logging. The use of other logging packages is supported as long as the package or its associated wrapper exposes the required methods. If any of the required methods are missing an exception will be thrown.</p>
<ul class="simple">
<li><p><strong>Required Methods</strong>: <code class="docutils literal notranslate"><span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code></p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">otherLogger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OtherLogger</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">({</span>
<span class="w">  </span><span class="nx">logger</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">log</span><span class="o">:</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">),</span>
<span class="w">    </span><span class="nx">warn</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">warn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">otherLogger</span><span class="p">.</span><span class="nx">logWarn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">otherLogger</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">error</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">otherLogger</span><span class="p">.</span><span class="nx">logError</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">otherLogger</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
</section>
<section id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">#</a></h2>
<p>Ajv can be extended with plugins that add custom keywords, formats or functions to process generated code. When such plugin is published as npm package it is recommended that it follows these conventions:</p>
<ul class="simple">
<li><p>it exports a function</p></li>
<li><p>this function accepts ajv instance as the first parameter and returns the same instance to allow chaining</p></li>
<li><p>this function can accept an optional configuration as the second parameter</p></li>
</ul>
<p>If you have published a useful plugin please submit a PR to add it to the next section.</p>
</section>
<section id="related-packages">
<h2>Related packages<a class="headerlink" href="#related-packages" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-async">ajv-async</a> - plugin to configure async validation mode</p></li>
<li><p><a class="reference external" href="https://github.com/BoLaMN/ajv-bsontype">ajv-bsontype</a> - plugin to validate mongodb’s bsonType formats</p></li>
<li><p><a class="reference external" href="https://github.com/jessedc/ajv-cli">ajv-cli</a> - command line interface</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-errors">ajv-errors</a> - plugin for custom error messages</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-i18n">ajv-i18n</a> - internationalised error messages</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-istanbul">ajv-istanbul</a> - plugin to instrument generated validation code to measure test coverage of your schemas</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-keywords">ajv-keywords</a> - plugin with custom validation keywords (select, typeof, etc.)</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-merge-patch">ajv-merge-patch</a> - plugin with keywords $merge and $patch</p></li>
<li><p><a class="reference external" href="https://github.com/ajv-validator/ajv-pack">ajv-pack</a> - produces a compact module exporting validation functions</p></li>
<li><p><a class="reference external" href="https://github.com/luzlab/ajv-formats-draft2019">ajv-formats-draft2019</a> - format validators for draft2019 that aren’t already included in ajv (ie. <code class="docutils literal notranslate"><span class="pre">idn-hostname</span></code>, <code class="docutils literal notranslate"><span class="pre">idn-email</span></code>, <code class="docutils literal notranslate"><span class="pre">iri</span></code>, <code class="docutils literal notranslate"><span class="pre">iri-reference</span></code> and <code class="docutils literal notranslate"><span class="pre">duration</span></code>).</p></li>
</ul>
</section>
<section id="some-packages-using-ajv">
<h2>Some packages using Ajv<a class="headerlink" href="#some-packages-using-ajv" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/webpack/webpack">webpack</a> - a module bundler. Its main purpose is to bundle JavaScript files for usage in a browser</p></li>
<li><p><a class="reference external" href="https://github.com/JSONScript/jsonscript-js">jsonscript-js</a> - the interpreter for <a class="reference external" href="http://www.jsonscript.org">JSONScript</a> - scripted processing of existing endpoints and services</p></li>
<li><p><a class="reference external" href="https://github.com/mulesoft-labs/osprey-method-handler">osprey-method-handler</a> - Express middleware for validating requests and responses based on a RAML method object, used in <a class="reference external" href="https://github.com/mulesoft/osprey">osprey</a> - validating API proxy generated from a RAML definition</p></li>
<li><p><a class="reference external" href="https://github.com/ahmadnassri/har-validator">har-validator</a> - HTTP Archive (HAR) validator</p></li>
<li><p><a class="reference external" href="https://github.com/josdejong/jsoneditor">jsoneditor</a> - a web-based tool to view, edit, format, and validate JSON http://jsoneditoronline.org</p></li>
<li><p><a class="reference external" href="https://github.com/nickcmaynard/jsonschemalint">JSON Schema Lint</a> - a web tool to validate JSON/YAML document against a single JSON Schema http://jsonschemalint.com</p></li>
<li><p><a class="reference external" href="https://github.com/vincit/objection.js">objection</a> - SQL-friendly ORM for Node.js</p></li>
<li><p><a class="reference external" href="https://github.com/gajus/table">table</a> - formats data into a string table</p></li>
<li><p><a class="reference external" href="https://github.com/ripple/ripple-lib">ripple-lib</a> - a JavaScript API for interacting with <a class="reference external" href="https://ripple.com">Ripple</a> in Node.js and the browser</p></li>
<li><p><a class="reference external" href="https://github.com/wikimedia/restbase">restbase</a> - distributed storage with REST API &amp; dispatcher for backend services built to provide a low-latency &amp; high-throughput API for Wikipedia / Wikimedia content</p></li>
<li><p><a class="reference external" href="https://github.com/CacheControl/hippie-swagger">hippie-swagger</a> - <a class="reference external" href="https://github.com/vesln/hippie">Hippie</a> wrapper that provides end to end API testing with swagger validation</p></li>
<li><p><a class="reference external" href="https://github.com/seeden/react-form-controlled">react-form-controlled</a> - React controlled form components with validation</p></li>
<li><p><a class="reference external" href="https://github.com/tjmehta/rabbitmq-schema">rabbitmq-schema</a> - a schema definition module for RabbitMQ graphs and messages</p></li>
<li><p><a class="reference external" href="https://www.npmjs.com/package/&#64;query/schema">&#64;query/schema</a> - stream filtering with a URI-safe query syntax parsing to JSON Schema</p></li>
<li><p><a class="reference external" href="https://github.com/peon374/chai-ajv-json-schema">chai-ajv-json-schema</a> - chai plugin to us JSON Schema with expect in mocha tests</p></li>
<li><p><a class="reference external" href="https://github.com/SignpostMarv/grunt-jsonschema-ajv">grunt-jsonschema-ajv</a> - Grunt plugin for validating files against JSON Schema</p></li>
<li><p><a class="reference external" href="https://github.com/webpack-contrib/extract-text-webpack-plugin">extract-text-webpack-plugin</a> - extract text from bundle into a file</p></li>
<li><p><a class="reference external" href="https://github.com/electron-userland/electron-builder">electron-builder</a> - a solution to package and build a ready for distribution Electron app</p></li>
<li><p><a class="reference external" href="https://github.com/mozilla/addons-linter">addons-linter</a> - Mozilla Add-ons Linter</p></li>
<li><p><a class="reference external" href="https://github.com/epoberezkin/gh-pages-generator">gh-pages-generator</a> - multi-page site generator converting markdown files to GitHub pages</p></li>
<li><p><a class="reference external" href="https://github.com/eslint/eslint">ESLint</a> - the pluggable linting utility for JavaScript and JSX</p></li>
</ul>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span>
<span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span> <span class="o">--</span><span class="n">init</span>
<span class="n">npm</span> <span class="n">test</span>
</pre></div>
</div>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">#</a></h2>
<p>All validation functions are generated using doT templates in <a class="reference external" href="https://github.com/ajv-validator/ajv/tree/master/lib/dot">dot</a> folder. Templates are precompiled so doT is not a run-time dependency.</p>
<p><code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">build</span></code> - compiles templates to <a class="reference external" href="https://github.com/ajv-validator/ajv/tree/master/lib/dotjs">dotjs</a> folder.</p>
<p><code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">watch</span></code> - automatically compiles templates when files in dot folder change</p>
<p>Please see <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/CONTRIBUTING.md">Contributing guidelines</a></p>
</section>
<section id="changes-history">
<h2>Changes history<a class="headerlink" href="#changes-history" title="Permalink to this headline">#</a></h2>
<p>See https://github.com/ajv-validator/ajv/releases</p>
<p><strong>Please note</strong>: <a class="reference external" href="https://github.com/ajv-validator/ajv/releases/tag/v7.0.0-beta.0">Changes in version 7.0.0-beta</a></p>
<p><a class="reference external" href="https://github.com/ajv-validator/ajv/releases/tag/v6.0.0">Version 6.0.0</a>.</p>
</section>
<section id="code-of-conduct">
<h2>Code of conduct<a class="headerlink" href="#code-of-conduct" title="Permalink to this headline">#</a></h2>
<p>Please review and follow the <a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/CODE_OF_CONDUCT.md">Code of conduct</a>.</p>
<p>Please report any unacceptable behaviour to ajv.validator&#64;gmail.com - it will be reviewed by the project team.</p>
</section>
<section id="open-source-software-support">
<h2>Open-source software support<a class="headerlink" href="#open-source-software-support" title="Permalink to this headline">#</a></h2>
<p>Ajv is a part of <a class="reference external" href="https://tidelift.com/subscription/pkg/npm-ajv?utm_source=npm-ajv&amp;utm_medium=referral&amp;utm_campaign=readme">Tidelift subscription</a> - it provides a centralised support to open-source software users, in addition to the support provided by software maintainers.</p>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://github.com/ajv-validator/ajv/blob/master/LICENSE">MIT</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/ajv"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>