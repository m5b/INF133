
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>WebDriver BiDi for Chromium &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/reveal/node_modules/chromium-bidi/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ci-status">
   CI status
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bidi">
   BiDi+
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#command-cdp-sendcommand">
     Command
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.sendCommand
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#command-cdp-getsession">
     Command
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.getSession
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#event-cdp-eventreceived">
     Event
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.eventReceived
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#field-channel">
     Field
     <code class="docutils literal notranslate">
      <span class="pre">
       channel
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dev-setup">
   Dev Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#npm">
     <code class="docutils literal notranslate">
      <span class="pre">
       npm
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-commit-com-integration">
     pre-commit.com integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#starting-the-server">
     Starting the Server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#starting-on-linux-and-mac">
     Starting on Linux and Mac
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running">
   Running
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-tests">
     Unit tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#e2e-tests">
     E2E tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation">
     Installation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Running
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examples">
     Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wpt-web-platform-tests">
   WPT (Web Platform Tests)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-out-and-setup-wpt">
     Check out and setup WPT
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-out-wpt">
       1. Check out WPT
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#go-to-the-wpt-folder">
       2. Go to the WPT folder
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-up-virtualenv">
       3. Set up virtualenv
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setup-hosts-file">
       4. Setup
       <code class="docutils literal notranslate">
        <span class="pre">
         hosts
        </span>
       </code>
       file
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#a-on-linux-macos-or-other-unix-like-system">
         4.a On Linux, macOS or other UNIX-like system
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#b-on-windows">
         4.b On
         <strong>
          Windows
         </strong>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-wpt-browser-path">
       5. Set
       <code class="docutils literal notranslate">
        <span class="pre">
         WPT_BROWSER_PATH
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-wpt-tests">
     Run WPT tests
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#make-sure-you-have-chrome-dev-installed">
       1. Make sure you have Chrome Dev installed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-chromedriver-bidi">
       2. Build Chromedriver BiDi
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run">
       3. Run
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-wpt-expectations-if-needed">
     Update WPT expectations if needed
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-wpt-tests-with-custom-log-wptreport">
       1. Run WPT tests with custom
       <code class="docutils literal notranslate">
        <span class="pre">
         log-wptreport
        </span>
       </code>
       :
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-expectations-based-on-the-previous-test-run">
       2. Update expectations based on the previous test run:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-does-it-work">
   How does it work?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#contributing">
     Contributing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#publish-new-npm-release">
     Publish new
     <code class="docutils literal notranslate">
      <span class="pre">
       npm
      </span>
     </code>
     release
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>WebDriver BiDi for Chromium </h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ci-status">
   CI status
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bidi">
   BiDi+
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#command-cdp-sendcommand">
     Command
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.sendCommand
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#command-cdp-getsession">
     Command
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.getSession
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#event-cdp-eventreceived">
     Event
     <code class="docutils literal notranslate">
      <span class="pre">
       cdp.eventReceived
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#field-channel">
     Field
     <code class="docutils literal notranslate">
      <span class="pre">
       channel
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dev-setup">
   Dev Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#npm">
     <code class="docutils literal notranslate">
      <span class="pre">
       npm
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-commit-com-integration">
     pre-commit.com integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#starting-the-server">
     Starting the Server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#starting-on-linux-and-mac">
     Starting on Linux and Mac
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running">
   Running
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-tests">
     Unit tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#e2e-tests">
     E2E tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation">
     Installation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Running
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examples">
     Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wpt-web-platform-tests">
   WPT (Web Platform Tests)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-out-and-setup-wpt">
     Check out and setup WPT
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-out-wpt">
       1. Check out WPT
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#go-to-the-wpt-folder">
       2. Go to the WPT folder
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-up-virtualenv">
       3. Set up virtualenv
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setup-hosts-file">
       4. Setup
       <code class="docutils literal notranslate">
        <span class="pre">
         hosts
        </span>
       </code>
       file
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#a-on-linux-macos-or-other-unix-like-system">
         4.a On Linux, macOS or other UNIX-like system
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#b-on-windows">
         4.b On
         <strong>
          Windows
         </strong>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-wpt-browser-path">
       5. Set
       <code class="docutils literal notranslate">
        <span class="pre">
         WPT_BROWSER_PATH
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-wpt-tests">
     Run WPT tests
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#make-sure-you-have-chrome-dev-installed">
       1. Make sure you have Chrome Dev installed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-chromedriver-bidi">
       2. Build Chromedriver BiDi
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run">
       3. Run
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-wpt-expectations-if-needed">
     Update WPT expectations if needed
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-wpt-tests-with-custom-log-wptreport">
       1. Run WPT tests with custom
       <code class="docutils literal notranslate">
        <span class="pre">
         log-wptreport
        </span>
       </code>
       :
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-expectations-based-on-the-previous-test-run">
       2. Update expectations based on the previous test run:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-does-it-work">
   How does it work?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#contributing">
     Contributing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#publish-new-npm-release">
     Publish new
     <code class="docutils literal notranslate">
      <span class="pre">
       npm
      </span>
     </code>
     release
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="webdriver-bidi-for-chromium-chromium-bidi-on-npm">
<h1>WebDriver BiDi for Chromium <a class="reference external" href="https://www.npmjs.com/package/chromium-bidi"><img alt="chromium-bidi on npm" src="https://img.shields.io/npm/v/chromium-bidi" /></a><a class="headerlink" href="#webdriver-bidi-for-chromium-chromium-bidi-on-npm" title="Permalink to this headline">#</a></h1>
<section id="ci-status">
<h2>CI status<a class="headerlink" href="#ci-status" title="Permalink to this headline">#</a></h2>
<p><img alt="E2E Tests" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/e2e.yml/badge.svg" />
<img alt="Unit Tests" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/unit.yml/badge.svg" />
<img alt="WPT Tests (chromedriver)" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/wpt-chromedriver.yml/badge.svg" />
<img alt="WPT Tests (mapper)" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/wpt-mapper.yml/badge.svg" /></p>
<p><img alt="Generate WPT Report" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/generate-wpt-report.yml/badge.svg" />
<img alt="Pre-commit" src="https://github.com/GoogleChromeLabs/chromium-bidi/actions/workflows/pre-commit.yml/badge.svg" /></p>
<p>This is an implementation of the
<a class="reference external" href="https://w3c.github.io/webdriver-bidi/">WebDriver BiDi</a> protocol with some
extensions (<strong>BiDi+</strong>)
for Chromium, implemented as a JavaScript layer translating between BiDi and CDP,
running inside a Chrome tab.</p>
<p>Current status can be checked
at <a class="reference external" href="https://wpt.fyi/results/webdriver/tests/bidi">WPT WebDriver BiDi status</a>.</p>
</section>
<section id="bidi">
<h2>BiDi+<a class="headerlink" href="#bidi" title="Permalink to this headline">#</a></h2>
<p><strong>“BiDi+”</strong> is an extension of the WebDriver BiDi protocol. In addition to <a class="reference external" href="https://w3c.github.io/webdriver-bidi/">WebDriver BiDi</a> it has:</p>
<section id="command-cdp-sendcommand">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cdp.sendCommand</span></code><a class="headerlink" href="#command-cdp-sendcommand" title="Permalink to this headline">#</a></h3>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">CdpSendCommandCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cdp.sendCommand&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">params</span><span class="p">:</span><span class="w"> </span><span class="nc">ScriptEvaluateParameters</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">CdpSendCommandParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">cdpMethod</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">   </span><span class="s">cdpParams</span><span class="p">:</span><span class="w"> </span><span class="nb">any</span><span class="p">,</span>
<span class="w">   </span><span class="nc">cdpSession</span><span class="o">?</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">CdpSendCommandResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">result</span><span class="p">:</span><span class="w"> </span><span class="nb">any</span><span class="p">,</span>
<span class="w">   </span><span class="s">cdpSession</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The command runs the
described <a class="reference external" href="https://chromedevtools.github.io/devtools-protocol">CDP command</a>
and returns result.</p>
</section>
<section id="command-cdp-getsession">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cdp.getSession</span></code><a class="headerlink" href="#command-cdp-getsession" title="Permalink to this headline">#</a></h3>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">CdpGetSessionCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cdp.sendCommand&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="s">params</span><span class="p">:</span><span class="w"> </span><span class="nc">ScriptEvaluateParameters</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">CdpGetSessionParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">context</span><span class="p">:</span><span class="w"> </span><span class="nc">BrowsingContext</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">CdpGetSessionResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">cdpSession</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The command returns the default CDP session for the selected browsing context.</p>
</section>
<section id="event-cdp-eventreceived">
<h3>Event <code class="docutils literal notranslate"><span class="pre">cdp.eventReceived</span></code><a class="headerlink" href="#event-cdp-eventreceived" title="Permalink to this headline">#</a></h3>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">CdpEventReceivedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cdp.eventReceived&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="s">params</span><span class="p">:</span><span class="w"> </span><span class="nc">ScriptEvaluateParameters</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">CdpEventReceivedParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">cdpMethod</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">   </span><span class="s">cdpParams</span><span class="p">:</span><span class="w"> </span><span class="nb">any</span><span class="p">,</span>
<span class="w">   </span><span class="s">cdpSession</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The event contains a CDP event.</p>
</section>
<section id="field-channel">
<h3>Field <code class="docutils literal notranslate"><span class="pre">channel</span></code><a class="headerlink" href="#field-channel" title="Permalink to this headline">#</a></h3>
<p>Each command can be extended with a <code class="docutils literal notranslate"><span class="pre">channel</span></code>:</p>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">id</span><span class="p">:</span><span class="w"> </span><span class="nc">js-uint</span><span class="p">,</span>
<span class="w">   </span><span class="nc">channel</span><span class="o">?</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">   </span><span class="nc">CommandData</span><span class="p">,</span>
<span class="w">   </span><span class="nc">Extensible</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If provided and non-empty string, the very same <code class="docutils literal notranslate"><span class="pre">channel</span></code> is added to the response:</p>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">CommandResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s">id</span><span class="p">:</span><span class="w"> </span><span class="nc">js-uint</span><span class="p">,</span>
<span class="w">   </span><span class="nc">channel</span><span class="o">?</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">   </span><span class="s">result</span><span class="p">:</span><span class="w"> </span><span class="nc">ResultData</span><span class="p">,</span>
<span class="w">   </span><span class="nc">Extensible</span><span class="p">,</span>
<span class="p">}</span>

<span class="nc">ErrorResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s">id</span><span class="p">:</span><span class="w"> </span><span class="nc">js-uint</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">null</span><span class="p">,</span>
<span class="w">  </span><span class="nc">channel</span><span class="o">?</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">  </span><span class="s">error</span><span class="p">:</span><span class="w"> </span><span class="nc">ErrorCode</span><span class="p">,</span>
<span class="w">  </span><span class="s">message</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">  </span><span class="o">?</span><span class="s">stacktrace</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">  </span><span class="nc">Extensible</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When client uses
commands <a class="reference external" href="https://w3c.github.io/webdriver-bidi/#command-session-subscribe"><code class="docutils literal notranslate"><span class="pre">session.subscribe</span></code></a>
and <a class="reference external" href="https://w3c.github.io/webdriver-bidi/#command-session-unsubscribe"><code class="docutils literal notranslate"><span class="pre">session.unsubscribe</span></code></a>
with <code class="docutils literal notranslate"><span class="pre">channel</span></code>, the subscriptions are handled per channel, and the corresponding
<code class="docutils literal notranslate"><span class="pre">channel</span></code> filed is added to the event message:</p>
<div class="highlight-cddl notranslate"><div class="highlight"><pre><span></span><span class="nc">Event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nc">channel</span><span class="o">?</span><span class="p">:</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">  </span><span class="nc">EventData</span><span class="p">,</span>
<span class="w">  </span><span class="nc">Extensible</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="dev-setup">
<h2>Dev Setup<a class="headerlink" href="#dev-setup" title="Permalink to this headline">#</a></h2>
<section id="npm">
<h3><code class="docutils literal notranslate"><span class="pre">npm</span></code><a class="headerlink" href="#npm" title="Permalink to this headline">#</a></h3>
<p>This is a Node.js project, so install dependencies as usual:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="pre-commit-com-integration">
<h3>pre-commit.com integration<a class="headerlink" href="#pre-commit-com-integration" title="Permalink to this headline">#</a></h3>
<p>Refer to the documentation at <span class="xref myst">.pre-commit-config.yaml</span>.</p>
</section>
<section id="starting-the-server">
<h3>Starting the Server<a class="headerlink" href="#starting-the-server" title="Permalink to this headline">#</a></h3>
<p>This will run the server on port <code class="docutils literal notranslate"><span class="pre">8080</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>server
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">PORT=</span></code> environment variable or <code class="docutils literal notranslate"><span class="pre">--port=</span></code> argument to run it on another port:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">PORT</span><span class="o">=</span><span class="m">8081</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>server
npm<span class="w"> </span>run<span class="w"> </span>server<span class="w"> </span>--<span class="w"> </span>--port<span class="o">=</span><span class="m">8081</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> environment variable to see debug info:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DEBUG</span><span class="o">=</span>*<span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>server
</pre></div>
</div>
<p>Use the CLI argument <code class="docutils literal notranslate"><span class="pre">--headless=false</span></code> to run browser in headful mode:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>server<span class="w"> </span>--<span class="w"> </span>--headless<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">CHANNEL=...</span></code> environment variable or <code class="docutils literal notranslate"><span class="pre">--channel=...</span></code> argument with one of
the following values to run the specific Chrome channel: <code class="docutils literal notranslate"><span class="pre">stable</span></code>,
<code class="docutils literal notranslate"><span class="pre">beta</span></code>, <code class="docutils literal notranslate"><span class="pre">canary</span></code>, <code class="docutils literal notranslate"><span class="pre">dev</span></code>.</p>
<p>The requested Chrome version should be installed.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">CHANNEL</span><span class="o">=</span>dev<span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>server
npm<span class="w"> </span>run<span class="w"> </span>server<span class="w"> </span>--<span class="w"> </span>--channel<span class="o">=</span>dev
</pre></div>
</div>
<p>Use the CLI argument <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> to have CDP events printed to the console. Note: you have to enable debugging output <code class="docutils literal notranslate"><span class="pre">bidiMapper:mapperDebug:*</span></code> as well.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DEBUG</span><span class="o">=</span>bidiMapper:mapperDebug:*<span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>server<span class="w"> </span>--<span class="w"> </span>--verbose
</pre></div>
</div>
<p>or</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DEBUG</span><span class="o">=</span>*<span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>server<span class="w"> </span>--<span class="w"> </span>--verbose
</pre></div>
</div>
</section>
<section id="starting-on-linux-and-mac">
<h3>Starting on Linux and Mac<a class="headerlink" href="#starting-on-linux-and-mac" title="Permalink to this headline">#</a></h3>
<p>TODO: verify if it works on Windows.</p>
<p>You can also run the server by using script <code class="docutils literal notranslate"><span class="pre">./runBiDiServer.sh</span></code>. It will write
output to the file <code class="docutils literal notranslate"><span class="pre">log.txt</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./runBiDiServer.sh<span class="w"> </span>--port<span class="o">=</span><span class="m">8081</span><span class="w"> </span>--headless<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
</section>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">#</a></h2>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">#</a></h3>
<p>Running:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</section>
<section id="e2e-tests">
<h3>E2E tests<a class="headerlink" href="#e2e-tests" title="Permalink to this headline">#</a></h3>
<p>The E2E tests are written using Python, in order to learn how to eventually do
this in web-platform-tests.</p>
</section>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h3>
<p>Python 3.6+ and some dependencies are required:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>-r<span class="w"> </span>tests/requirements.txt
</pre></div>
</div>
</section>
<section id="id1">
<h3>Running<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>The E2E tests require BiDi server running on the same host. By default, tests
try to connect to the port <code class="docutils literal notranslate"><span class="pre">8080</span></code>. The server can be run from the project root:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>e2e
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">PORT</span></code> environment variable to connect to another port:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">PORT</span><span class="o">=</span><span class="m">8081</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>e2e
</pre></div>
</div>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h3>
<p>Refer to <span class="xref myst">examples/README.md</span>.</p>
</section>
</section>
<section id="wpt-web-platform-tests">
<h2>WPT (Web Platform Tests)<a class="headerlink" href="#wpt-web-platform-tests" title="Permalink to this headline">#</a></h2>
<p>WPT is added as
a <a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git submodule</a>. To get run
WPT tests:</p>
<section id="check-out-and-setup-wpt">
<h3>Check out and setup WPT<a class="headerlink" href="#check-out-and-setup-wpt" title="Permalink to this headline">#</a></h3>
<section id="check-out-wpt">
<h4>1. Check out WPT<a class="headerlink" href="#check-out-wpt" title="Permalink to this headline">#</a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init
</pre></div>
</div>
</section>
<section id="go-to-the-wpt-folder">
<h4>2. Go to the WPT folder<a class="headerlink" href="#go-to-the-wpt-folder" title="Permalink to this headline">#</a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>wpt
</pre></div>
</div>
</section>
<section id="set-up-virtualenv">
<h4>3. Set up virtualenv<a class="headerlink" href="#set-up-virtualenv" title="Permalink to this headline">#</a></h4>
<p>Follow the <a class="reference external" href="https://web-platform-tests.org/running-tests/from-local-system.html#system-setup"><em>System
Setup</em></a>
instructions.</p>
</section>
<section id="setup-hosts-file">
<h4>4. Setup <code class="docutils literal notranslate"><span class="pre">hosts</span></code> file<a class="headerlink" href="#setup-hosts-file" title="Permalink to this headline">#</a></h4>
<p>Follow
the <a class="reference external" href="https://web-platform-tests.org/running-tests/from-local-system.html#hosts-file-setup"><code class="docutils literal notranslate"><span class="pre">hosts</span></code> File Setup</a>
instructions.</p>
<section id="a-on-linux-macos-or-other-unix-like-system">
<h5>4.a On Linux, macOS or other UNIX-like system<a class="headerlink" href="#a-on-linux-macos-or-other-unix-like-system" title="Permalink to this headline">#</a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./wpt<span class="w"> </span>make-hosts-file<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/hosts
</pre></div>
</div>
</section>
<section id="b-on-windows">
<h5>4.b On <strong>Windows</strong><a class="headerlink" href="#b-on-windows" title="Permalink to this headline">#</a></h5>
<p>This must be run in a PowerShell session with Administrator privileges:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>wpt<span class="w"> </span>make-hosts-file<span class="w"> </span><span class="p">|</span><span class="w"> </span>Out-File<span class="w"> </span><span class="nv">$env</span>:SystemRoot<span class="se">\S</span>ystem32<span class="se">\d</span>rivers<span class="se">\e</span>tc<span class="se">\h</span>osts<span class="w"> </span>-Encoding<span class="w"> </span>ascii<span class="w"> </span>-Append
</pre></div>
</div>
<p>If you are behind a proxy, you also need to make sure the domains above are excluded
from your proxy lookups.</p>
</section>
</section>
<section id="set-wpt-browser-path">
<h4>5. Set <code class="docutils literal notranslate"><span class="pre">WPT_BROWSER_PATH</span></code><a class="headerlink" href="#set-wpt-browser-path" title="Permalink to this headline">#</a></h4>
<p>Set the <code class="docutils literal notranslate"><span class="pre">WPT_BROWSER_PATH</span></code> environment variable to a Chrome, Edge or Chromium binary to launch.
For example, on macOS:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chrome</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Google Chrome Canary.app/Contents/MacOS/Google Chrome Canary&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Google Chrome Dev.app/Contents/MacOS/Google Chrome Dev&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Google Chrome Beta.app/Contents/MacOS/Google Chrome Beta&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Google Chrome.app/Contents/MacOS/Google Chrome&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Chromium.app/Contents/MacOS/Chromium&quot;</span>

<span class="c1"># Edge</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Microsoft Edge Canary.app/Contents/MacOS/Microsoft Edge Canary&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WPT_BROWSER_PATH</span><span class="o">=</span><span class="s2">&quot;/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="run-wpt-tests">
<h3>Run WPT tests<a class="headerlink" href="#run-wpt-tests" title="Permalink to this headline">#</a></h3>
<section id="make-sure-you-have-chrome-dev-installed">
<h4>1. Make sure you have Chrome Dev installed<a class="headerlink" href="#make-sure-you-have-chrome-dev-installed" title="Permalink to this headline">#</a></h4>
<p>https://www.google.com/chrome/dev/</p>
</section>
<section id="build-chromedriver-bidi">
<h4>2. Build Chromedriver BiDi<a class="headerlink" href="#build-chromedriver-bidi" title="Permalink to this headline">#</a></h4>
<p>Oneshot:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>build
</pre></div>
</div>
<p>Continuously:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>watch
</pre></div>
</div>
</section>
<section id="run">
<h4>3. Run<a class="headerlink" href="#run" title="Permalink to this headline">#</a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./wpt/wpt<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--webdriver-binary<span class="w"> </span>runBiDiServer.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--binary<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WPT_BROWSER_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--manifest<span class="w"> </span>wpt/MANIFEST.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>wpt-metadata/mapper/headless<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>chromium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>webdriver/tests/bidi/
</pre></div>
</div>
</section>
</section>
<section id="update-wpt-expectations-if-needed">
<h3>Update WPT expectations if needed<a class="headerlink" href="#update-wpt-expectations-if-needed" title="Permalink to this headline">#</a></h3>
<section id="run-wpt-tests-with-custom-log-wptreport">
<h4>1. Run WPT tests with custom <code class="docutils literal notranslate"><span class="pre">log-wptreport</span></code>:<a class="headerlink" href="#run-wpt-tests-with-custom-log-wptreport" title="Permalink to this headline">#</a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./wpt/wpt<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--webdriver-binary<span class="w"> </span>runBiDiServer.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--binary<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WPT_BROWSER_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--manifest<span class="w"> </span>wpt/MANIFEST.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>wpt-metadata/mapper/headless<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-wptreport<span class="w"> </span>wptreport.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>chromium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>webdriver/tests/bidi/
</pre></div>
</div>
</section>
<section id="update-expectations-based-on-the-previous-test-run">
<h4>2. Update expectations based on the previous test run:<a class="headerlink" href="#update-expectations-based-on-the-previous-test-run" title="Permalink to this headline">#</a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./wpt/wpt<span class="w"> </span>update-expectations<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--product<span class="w"> </span>chromium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--manifest<span class="w"> </span>wpt/MANIFEST.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>wpt-metadata/mapper/headless<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>wptreport.json
</pre></div>
</div>
</section>
</section>
</section>
<section id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">#</a></h2>
<p>The architecture is described in the
<a class="reference external" href="https://docs.google.com/document/d/1VfQ9tv0wPSnb5TI-MOobjoQ5CXLnJJx9F_PxOMQc8kY">WebDriver BiDi in Chrome Context implementation plan</a>
.</p>
<p>There are 2 main modules:</p>
<ol class="simple">
<li><p>backend WS server in <code class="docutils literal notranslate"><span class="pre">src</span></code>. It runs webSocket server, and for each ws connection
runs an instance of browser with BiDi Mapper.</p></li>
<li><p>front-end BiDi Mapper in <code class="docutils literal notranslate"><span class="pre">src/bidiMapper</span></code>. Gets BiDi commands from the backend,
and map them to CDP commands.</p></li>
</ol>
<section id="contributing">
<h3>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">#</a></h3>
<p>The BiDi commands are processed in the <code class="docutils literal notranslate"><span class="pre">src/bidiMapper/commandProcessor.ts</span></code>. To add a
new command, add it to <code class="docutils literal notranslate"><span class="pre">_processCommand</span></code>, write and call processor for it.</p>
</section>
<section id="publish-new-npm-release">
<h3>Publish new <code class="docutils literal notranslate"><span class="pre">npm</span></code> release<a class="headerlink" href="#publish-new-npm-release" title="Permalink to this headline">#</a></h3>
<ol>
<li><p>Open a PR bumping the chromium-bidi version number in <code class="docutils literal notranslate"><span class="pre">package.json</span></code> for review:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>version<span class="w"> </span>patch<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Release v%s&#39;</span><span class="w"> </span>--no-git-tag-version
</pre></div>
</div>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">patch</span></code>, use <code class="docutils literal notranslate"><span class="pre">minor</span></code> or <code class="docutils literal notranslate"><span class="pre">major</span></code> <a class="reference external" href="https://semver.org/">as needed</a>.</p>
</li>
<li><p>After the PR is reviewed, <a class="reference external" href="https://github.com/GoogleChromeLabs/chromium-bidi/releases/new">create a GitHub release</a> specifying the tag name matching the bumped version.
Our CI then automatically publishes the new release to npm based on the tag name.</p></li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/chromium-bidi"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>