
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>websocket-extensions &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/reveal/node_modules/websocket-extensions/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-types">
     Data types
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#frame">
       <em>
        Frame
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#message">
       <em>
        Message
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#for-driver-authors">
     For driver authors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#client-sessions">
       Client sessions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#server-sessions">
       Server sessions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#in-both-directions">
       In both directions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#for-extension-authors">
     For extension authors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clientsession">
       <em>
        ClientSession
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#serversession">
       <em>
        ServerSession
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#session">
       <em>
        Session
       </em>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>websocket-extensions </h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-types">
     Data types
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#frame">
       <em>
        Frame
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#message">
       <em>
        Message
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#for-driver-authors">
     For driver authors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#client-sessions">
       Client sessions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#server-sessions">
       Server sessions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#in-both-directions">
       In both directions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#for-extension-authors">
     For extension authors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clientsession">
       <em>
        ClientSession
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#serversession">
       <em>
        ServerSession
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#session">
       <em>
        Session
       </em>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="websocket-extensions-build-status">
<h1>websocket-extensions <a class="reference external" href="http://travis-ci.org/faye/websocket-extensions-node"><img alt="Build status" src="https://secure.travis-ci.org/faye/websocket-extensions-node.svg" /></a><a class="headerlink" href="#websocket-extensions-build-status" title="Permalink to this headline">#</a></h1>
<p>A minimal framework that supports the implementation of WebSocket extensions in
a way that’s decoupled from the main protocol. This library aims to allow a
WebSocket extension to be written and used with any protocol library, by
defining abstract representations of frames and messages that allow modules to
co-operate.</p>
<p><code class="docutils literal notranslate"><span class="pre">websocket-extensions</span></code> provides a container for registering extension plugins,
and provides all the functions required to negotiate which extensions to use
during a session via the <code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> header. By implementing the
APIs defined in this document, an extension may be used by any WebSocket library
based on this framework.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm install websocket-extensions
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h2>
<p>There are two main audiences for this library: authors implementing the
WebSocket protocol, and authors implementing extensions. End users of a
WebSocket library or an extension should be able to use any extension by passing
it as an argument to their chosen protocol library, without needing to know how
either of them work, or how the <code class="docutils literal notranslate"><span class="pre">websocket-extensions</span></code> framework operates.</p>
<p>The library is designed with the aim that any protocol implementation and any
extension can be used together, so long as they support the same abstract
representation of frames and messages.</p>
<section id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Permalink to this headline">#</a></h3>
<p>The APIs provided by the framework rely on two data types; extensions will
expect to be given data and to be able to return data in these formats:</p>
<section id="frame">
<h4><em>Frame</em><a class="headerlink" href="#frame" title="Permalink to this headline">#</a></h4>
<p><em>Frame</em> is a structure representing a single WebSocket frame of any type. Frames
are simple objects that must have at least the following properties, which
represent the data encoded in the frame:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>property</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">final</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">FIN</span></code> bit is set, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rsv1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">RSV1</span></code> bit is set, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rsv2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">RSV2</span></code> bit is set, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rsv3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">RSV3</span></code> bit is set, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">opcode</span></code></p></td>
<td><p>the numeric opcode (<code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">8</span></code>, <code class="docutils literal notranslate"><span class="pre">9</span></code>, or <code class="docutils literal notranslate"><span class="pre">10</span></code>) of the frame</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">masked</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">MASK</span></code> bit is set, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">maskingKey</span></code></p></td>
<td><p>a 4-byte <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> if <code class="docutils literal notranslate"><span class="pre">masked</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">null</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">payload</span></code></p></td>
<td><p>a <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> containing the (unmasked) application data</p></td>
</tr>
</tbody>
</table>
</section>
<section id="message">
<h4><em>Message</em><a class="headerlink" href="#message" title="Permalink to this headline">#</a></h4>
<p>A <em>Message</em> represents a complete application message, which can be formed from
text, binary and continuation frames. It has the following properties:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>property</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rsv1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the first frame of the message has the <code class="docutils literal notranslate"><span class="pre">RSV1</span></code> bit set</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rsv2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the first frame of the message has the <code class="docutils literal notranslate"><span class="pre">RSV2</span></code> bit set</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rsv3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code> if the first frame of the message has the <code class="docutils literal notranslate"><span class="pre">RSV3</span></code> bit set</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">opcode</span></code></p></td>
<td><p>the numeric opcode (<code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span></code>) of the first frame of the message</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>the concatenation of all the frame payloads in the message</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="for-driver-authors">
<h3>For driver authors<a class="headerlink" href="#for-driver-authors" title="Permalink to this headline">#</a></h3>
<p>A driver author is someone implementing the WebSocket protocol proper, and who
wishes end users to be able to use WebSocket extensions with their library.</p>
<p>At the start of a WebSocket session, on both the client and the server side,
they should begin by creating an extension container and adding whichever
extensions they want to use.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">Extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;websocket-extensions&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">deflate</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;permessage-deflate&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">exts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Extensions</span><span class="p">();</span>
<span class="nx">exts</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">deflate</span><span class="p">);</span>
</pre></div>
</div>
<p>In the following examples, <code class="docutils literal notranslate"><span class="pre">exts</span></code> refers to this <code class="docutils literal notranslate"><span class="pre">Extensions</span></code> instance.</p>
<section id="client-sessions">
<h4>Client sessions<a class="headerlink" href="#client-sessions" title="Permalink to this headline">#</a></h4>
<p>Clients will use the methods <code class="docutils literal notranslate"><span class="pre">generateOffer()</span></code> and <code class="docutils literal notranslate"><span class="pre">activate(header)</span></code>.</p>
<p>As part of the handshake process, the client must send a
<code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> header to advertise that it supports the registered
extensions. This header should be generated using:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;sec-websocket-extensions&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">exts</span><span class="p">.</span><span class="nx">generateOffer</span><span class="p">();</span>
</pre></div>
</div>
<p>This returns a string, for example <code class="docutils literal notranslate"><span class="pre">&quot;permessage-deflate;</span> <span class="pre">client_max_window_bits&quot;</span></code>, that represents all the extensions the client is
offering to use, and their parameters. This string may contain multiple offers
for the same extension.</p>
<p>When the client receives the handshake response from the server, it should pass
the incoming <code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> header in to <code class="docutils literal notranslate"><span class="pre">exts</span></code> to activate the
extensions the server has accepted:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">exts</span><span class="p">.</span><span class="nx">activate</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;sec-websocket-extensions&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>If the server has sent any extension responses that the client does not
recognize, or are in conflict with one another for use of RSV bits, or that use
invalid parameters for the named extensions, then <code class="docutils literal notranslate"><span class="pre">exts.activate()</span></code> will
<code class="docutils literal notranslate"><span class="pre">throw</span></code>. In this event, the client driver should fail the connection with
closing code <code class="docutils literal notranslate"><span class="pre">1010</span></code>.</p>
</section>
<section id="server-sessions">
<h4>Server sessions<a class="headerlink" href="#server-sessions" title="Permalink to this headline">#</a></h4>
<p>Servers will use the method <code class="docutils literal notranslate"><span class="pre">generateResponse(header)</span></code>.</p>
<p>A server session needs to generate a <code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> header to send
in its handshake response:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">clientOffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;sec-websocket-extensions&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">extResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">exts</span><span class="p">.</span><span class="nx">generateResponse</span><span class="p">(</span><span class="nx">clientOffer</span><span class="p">);</span>

<span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;sec-websocket-extensions&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extResponse</span><span class="p">;</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">exts.generateResponse(header)</span></code> activates those extensions the client
has asked to use, if they are registered, asks each extension for a set of
response parameters, and returns a string containing the response parameters for
all accepted extensions.</p>
</section>
<section id="in-both-directions">
<h4>In both directions<a class="headerlink" href="#in-both-directions" title="Permalink to this headline">#</a></h4>
<p>Both clients and servers will use the methods <code class="docutils literal notranslate"><span class="pre">validFrameRsv(frame)</span></code>,
<code class="docutils literal notranslate"><span class="pre">processIncomingMessage(message)</span></code> and <code class="docutils literal notranslate"><span class="pre">processOutgoingMessage(message)</span></code>.</p>
<p>The WebSocket protocol requires that frames do not have any of the <code class="docutils literal notranslate"><span class="pre">RSV</span></code> bits
set unless there is an extension in use that allows otherwise. When processing
an incoming frame, sessions should pass a <em>Frame</em> object to:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">exts</span><span class="p">.</span><span class="nx">validFrameRsv</span><span class="p">(</span><span class="nx">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>If this method returns <code class="docutils literal notranslate"><span class="pre">false</span></code>, the session should fail the WebSocket connection
with closing code <code class="docutils literal notranslate"><span class="pre">1002</span></code>.</p>
<p>To pass incoming messages through the extension stack, a session should
construct a <em>Message</em> object according to the above datatype definitions, and
call:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">exts</span><span class="p">.</span><span class="nx">processIncomingMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// hand the message off to the application</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If any extensions fail to process the message, then the callback will yield an
error and the session should fail the WebSocket connection with closing code
<code class="docutils literal notranslate"><span class="pre">1010</span></code>. If <code class="docutils literal notranslate"><span class="pre">error</span></code> is <code class="docutils literal notranslate"><span class="pre">null</span></code>, then <code class="docutils literal notranslate"><span class="pre">msg</span></code> should be passed on to the application.</p>
<p>To pass outgoing messages through the extension stack, a session should
construct a <em>Message</em> as before, and call:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">exts</span><span class="p">.</span><span class="nx">processOutgoingMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// write message to the transport</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If any extensions fail to process the message, then the callback will yield an
error and the session should fail the WebSocket connection with closing code
<code class="docutils literal notranslate"><span class="pre">1010</span></code>. If <code class="docutils literal notranslate"><span class="pre">error</span></code> is <code class="docutils literal notranslate"><span class="pre">null</span></code>, then <code class="docutils literal notranslate"><span class="pre">message</span></code> should be converted into frames
(with the message’s <code class="docutils literal notranslate"><span class="pre">rsv1</span></code>, <code class="docutils literal notranslate"><span class="pre">rsv2</span></code>, <code class="docutils literal notranslate"><span class="pre">rsv3</span></code> and <code class="docutils literal notranslate"><span class="pre">opcode</span></code> set on the first frame)
and written to the transport.</p>
<p>At the end of the WebSocket session (either when the protocol is explicitly
ended or the transport connection disconnects), the driver should call:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">exts</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{})</span>
</pre></div>
</div>
<p>The callback is invoked when all extensions have finished processing any
messages in the pipeline and it’s safe to close the socket.</p>
</section>
</section>
<section id="for-extension-authors">
<h3>For extension authors<a class="headerlink" href="#for-extension-authors" title="Permalink to this headline">#</a></h3>
<p>An extension author is someone implementing an extension that transforms
WebSocket messages passing between the client and server. They would like to
implement their extension once and have it work with any protocol library.</p>
<p>Extension authors will not install <code class="docutils literal notranslate"><span class="pre">websocket-extensions</span></code> or call it directly.
Instead, they should implement the following API to allow their extension to
plug into the <code class="docutils literal notranslate"><span class="pre">websocket-extensions</span></code> framework.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">Extension</span></code> is any object that has the following properties:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>property</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>a string containing the name of the extension as used in negotiation headers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>a string, must be <code class="docutils literal notranslate"><span class="pre">&quot;permessage&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rsv1</span></code></p></td>
<td><p>either <code class="docutils literal notranslate"><span class="pre">true</span></code> if the extension uses the RSV1 bit, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rsv2</span></code></p></td>
<td><p>either <code class="docutils literal notranslate"><span class="pre">true</span></code> if the extension uses the RSV2 bit, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rsv3</span></code></p></td>
<td><p>either <code class="docutils literal notranslate"><span class="pre">true</span></code> if the extension uses the RSV3 bit, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise</p></td>
</tr>
</tbody>
</table>
<p>It must also implement the following methods:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">ext</span><span class="p">.</span><span class="nx">createClientSession</span><span class="p">()</span>
</pre></div>
</div>
<p>This returns a <em>ClientSession</em>, whose interface is defined below.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">ext</span><span class="p">.</span><span class="nx">createServerSession</span><span class="p">(</span><span class="nx">offers</span><span class="p">)</span>
</pre></div>
</div>
<p>This takes an array of offer params and returns a <em>ServerSession</em>, whose
interface is defined below. For example, if the client handshake contains the
offer header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sec</span><span class="o">-</span><span class="n">WebSocket</span><span class="o">-</span><span class="n">Extensions</span><span class="p">:</span> <span class="n">permessage</span><span class="o">-</span><span class="n">deflate</span><span class="p">;</span> <span class="n">server_no_context_takeover</span><span class="p">;</span> <span class="n">server_max_window_bits</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> \
                          <span class="n">permessage</span><span class="o">-</span><span class="n">deflate</span><span class="p">;</span> <span class="n">server_max_window_bits</span><span class="o">=</span><span class="mi">15</span>
</pre></div>
</div>
<p>then the <code class="docutils literal notranslate"><span class="pre">permessage-deflate</span></code> extension will receive the call:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">ext</span><span class="p">.</span><span class="nx">createServerSession</span><span class="p">([</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">server_no_context_takeover</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">server_max_window_bits</span><span class="o">:</span><span class="w"> </span><span class="mf">8</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">server_max_window_bits</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The extension must decide which set of parameters it wants to accept, if any,
and return a <em>ServerSession</em> if it wants to accept the parameters and <code class="docutils literal notranslate"><span class="pre">null</span></code>
otherwise.</p>
<section id="clientsession">
<h4><em>ClientSession</em><a class="headerlink" href="#clientsession" title="Permalink to this headline">#</a></h4>
<p>A <em>ClientSession</em> is the type returned by <code class="docutils literal notranslate"><span class="pre">ext.createClientSession()</span></code>. It must
implement the following methods, as well as the <em>Session</em> API listed below.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">clientSession</span><span class="p">.</span><span class="nx">generateOffer</span><span class="p">()</span>
<span class="c1">// e.g.  -&gt; [</span>
<span class="c1">//            { server_no_context_takeover: true, server_max_window_bits: 8 },</span>
<span class="c1">//            { server_max_window_bits: 15 }</span>
<span class="c1">//          ]</span>
</pre></div>
</div>
<p>This must return a set of parameters to include in the client’s
<code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> offer header. If the session wants to offer multiple
configurations, it can return an array of sets of parameters as shown above.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">clientSession</span><span class="p">.</span><span class="nx">activate</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="c1">// -&gt; true</span>
</pre></div>
</div>
<p>This must take a single set of parameters from the server’s handshake response
and use them to configure the client session. If the client accepts the given
parameters, then this method must return <code class="docutils literal notranslate"><span class="pre">true</span></code>. If it returns any other value,
the framework will interpret this as the client rejecting the response, and will
<code class="docutils literal notranslate"><span class="pre">throw</span></code>.</p>
</section>
<section id="serversession">
<h4><em>ServerSession</em><a class="headerlink" href="#serversession" title="Permalink to this headline">#</a></h4>
<p>A <em>ServerSession</em> is the type returned by <code class="docutils literal notranslate"><span class="pre">ext.createServerSession(offers)</span></code>. It
must implement the following methods, as well as the <em>Session</em> API listed below.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">serverSession</span><span class="p">.</span><span class="nx">generateResponse</span><span class="p">()</span>
<span class="c1">// e.g.  -&gt; { server_max_window_bits: 8 }</span>
</pre></div>
</div>
<p>This returns the set of parameters the server session wants to send in its
<code class="docutils literal notranslate"><span class="pre">Sec-WebSocket-Extensions</span></code> response header. Only one set of parameters is
returned to the client per extension. Server sessions that would confict on
their use of RSV bits are not activated.</p>
</section>
<section id="session">
<h4><em>Session</em><a class="headerlink" href="#session" title="Permalink to this headline">#</a></h4>
<p>The <em>Session</em> API must be implemented by both client and server sessions. It
contains two methods, <code class="docutils literal notranslate"><span class="pre">processIncomingMessage(message)</span></code> and
<code class="docutils literal notranslate"><span class="pre">processOutgoingMessage(message)</span></code>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">.</span><span class="nx">processIncomingMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span>
</pre></div>
</div>
<p>The session must implement this method to take an incoming <em>Message</em> as defined
above, transform it in any way it needs, then return it via the callback. If
there is an error processing the message, this method should yield an error as
the first argument.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">.</span><span class="nx">processOutgoingMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span>
</pre></div>
</div>
<p>The session must implement this method to take an outgoing <em>Message</em> as defined
above, transform it in any way it needs, then return it via the callback. If
there is an error processing the message, this method should yield an error as
the first argument.</p>
<p>Note that both <code class="docutils literal notranslate"><span class="pre">processIncomingMessage()</span></code> and <code class="docutils literal notranslate"><span class="pre">processOutgoingMessage()</span></code> can
perform their logic asynchronously, are allowed to process multiple messages
concurrently, and are not required to complete working on messages in the same
order the messages arrive. <code class="docutils literal notranslate"><span class="pre">websocket-extensions</span></code> will reorder messages as your
extension emits them and will make sure every extension is given messages in the
order they arrive from the driver. This allows extensions to maintain state that
depends on the messages’ wire order, for example keeping a DEFLATE compression
context between messages.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The framework will call this method when the WebSocket session ends, allowing
the session to release any resources it’s using.</p>
</section>
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Consumer: <a class="reference external" href="https://github.com/faye/websocket-driver-node">websocket-driver</a></p></li>
<li><p>Provider: <a class="reference external" href="https://github.com/faye/permessage-deflate-node">permessage-deflate</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/websocket-extensions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>