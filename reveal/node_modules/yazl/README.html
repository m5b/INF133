
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>yazl &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/reveal/node_modules/yazl/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-zipfile">
     Class: ZipFile
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#new-zipfile">
       new ZipFile()
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addfile-realpath-metadatapath-options">
       addFile(realPath, metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addreadstream-readstream-metadatapath-options">
       addReadStream(readStream, metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addbuffer-buffer-metadatapath-options">
       addBuffer(buffer, metadataPath, [options])
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#size-limitation-on-buffer">
         Size limitation on buffer
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addemptydirectory-metadatapath-options">
       addEmptyDirectory(metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#end-options-finalsizecallback">
       end([options], [finalSizeCallback])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outputstream">
       outputStream
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datetodosdatetime-jsdate">
     dateToDosDateTime(jsDate)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regarding-zip64-support">
   Regarding ZIP64 Support
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-structure">
   Output Structure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disk-numbers">
     Disk Numbers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#version-made-by">
     Version Made By
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#version-needed-to-extract">
     Version Needed to Extract
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-purpose-bit-flag">
     General Purpose Bit Flag
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#internal-file-attributes">
     Internal File Attributes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#external-file-attributes">
     External File Attributes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#directory-entries">
     Directory Entries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#size-of-local-file-and-central-directory-entry-metadata">
     Size of Local File and Central Directory Entry Metadata
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#change-history">
   Change History
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>yazl</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-zipfile">
     Class: ZipFile
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#new-zipfile">
       new ZipFile()
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addfile-realpath-metadatapath-options">
       addFile(realPath, metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addreadstream-readstream-metadatapath-options">
       addReadStream(readStream, metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addbuffer-buffer-metadatapath-options">
       addBuffer(buffer, metadataPath, [options])
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#size-limitation-on-buffer">
         Size limitation on buffer
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addemptydirectory-metadatapath-options">
       addEmptyDirectory(metadataPath, [options])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#end-options-finalsizecallback">
       end([options], [finalSizeCallback])
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outputstream">
       outputStream
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datetodosdatetime-jsdate">
     dateToDosDateTime(jsDate)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regarding-zip64-support">
   Regarding ZIP64 Support
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-structure">
   Output Structure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disk-numbers">
     Disk Numbers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#version-made-by">
     Version Made By
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#version-needed-to-extract">
     Version Needed to Extract
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-purpose-bit-flag">
     General Purpose Bit Flag
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#internal-file-attributes">
     Internal File Attributes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#external-file-attributes">
     External File Attributes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#directory-entries">
     Directory Entries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#size-of-local-file-and-central-directory-entry-metadata">
     Size of Local File and Central Directory Entry Metadata
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#change-history">
   Change History
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="yazl">
<h1>yazl<a class="headerlink" href="#yazl" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://travis-ci.com/thejoshwolfe/yazl"><img alt="Build Status" src="https://travis-ci.com/thejoshwolfe/yazl.svg?branch=master" /></a>
<a class="reference external" href="https://coveralls.io/github/thejoshwolfe/yazl?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/thejoshwolfe/yazl/badge.svg?branch=master" /></a></p>
<p>yet another zip library for node. For unzipping, see
<a class="reference external" href="https://github.com/thejoshwolfe/yauzl">yauzl</a>.</p>
<p>Design principles:</p>
<ul class="simple">
<li><p>Don’t block the JavaScript thread.
Use and provide async APIs.</p></li>
<li><p>Keep memory usage under control.
Don’t attempt to buffer entire files in RAM at once.</p></li>
<li><p>Prefer to open input files one at a time than all at once.
This is slightly suboptimal for time performance,
but avoids OS-imposed limits on the number of simultaneously open file handles.</p></li>
</ul>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">yazl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;yazl&quot;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">zipfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">yazl</span><span class="p">.</span><span class="nx">ZipFile</span><span class="p">();</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;file1.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;file1.txt&quot;</span><span class="p">);</span>
<span class="c1">// (add only files, not directories)</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;path/to/file.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;path/in/zipfile.txt&quot;</span><span class="p">);</span>
<span class="c1">// pipe() can be called any time after the constructor</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">outputStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s2">&quot;output.zip&quot;</span><span class="p">)).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// alternate apis for adding files:</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">addReadStream</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stdin.txt&quot;</span><span class="p">);</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">addBuffer</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;hello.txt&quot;</span><span class="p">);</span>
<span class="c1">// call end() after all the files have been added</span>
<span class="nx">zipfile</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">#</a></h2>
<section id="class-zipfile">
<h3>Class: ZipFile<a class="headerlink" href="#class-zipfile" title="Permalink to this headline">#</a></h3>
<section id="new-zipfile">
<h4>new ZipFile()<a class="headerlink" href="#new-zipfile" title="Permalink to this headline">#</a></h4>
<p>No parameters.
Nothing can go wrong.</p>
</section>
<section id="addfile-realpath-metadatapath-options">
<h4>addFile(realPath, metadataPath, [options])<a class="headerlink" href="#addfile-realpath-metadatapath-options" title="Permalink to this headline">#</a></h4>
<p>Adds a file from the file system at <code class="docutils literal notranslate"><span class="pre">realPath</span></code> into the zipfile as <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code>.
Typically <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> would be calculated as <code class="docutils literal notranslate"><span class="pre">path.relative(root,</span> <span class="pre">realPath)</span></code>.
Unzip programs would extract the file from the zipfile as <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code>.
<code class="docutils literal notranslate"><span class="pre">realPath</span></code> is not stored in the zipfile.</p>
<p>A valid <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> must not be blank.
If a <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> contains <code class="docutils literal notranslate"><span class="pre">&quot;\\&quot;</span></code> characters, they will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code> characters.
After this substitution, a valid <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> must not start with <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">/[A-Za-z]:\//</span></code>,
and must not contain <code class="docutils literal notranslate"><span class="pre">&quot;..&quot;</span></code> path segments.
File paths must not end with <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code>, but see <code class="docutils literal notranslate"><span class="pre">addEmptyDirectory()</span></code>.
After UTF-8 encoding, <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> must be at most <code class="docutils literal notranslate"><span class="pre">0xffff</span></code> bytes in length.</p>
<p><code class="docutils literal notranslate"><span class="pre">options</span></code> may be omitted or null and has the following structure and default values:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">mtime</span><span class="o">:</span><span class="w"> </span><span class="nx">stats</span><span class="p">.</span><span class="nx">mtime</span><span class="p">,</span>
<span class="w">  </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="nx">stats</span><span class="p">.</span><span class="nx">mode</span><span class="p">,</span>
<span class="w">  </span><span class="nx">compress</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">forceZip64Format</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fileComment</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// or a UTF-8 Buffer</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">mtime</span></code> and/or <code class="docutils literal notranslate"><span class="pre">mode</span></code> to override the values
that would normally be obtained by the <code class="docutils literal notranslate"><span class="pre">fs.Stats</span></code> for the <code class="docutils literal notranslate"><span class="pre">realPath</span></code>.
The mode is the unix permission bits and file type.
The mtime and mode are stored in the zip file in the fields “last mod file time”,
“last mod file date”, and “external file attributes”.
yazl does not store group and user ids in the zip file.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">compress</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, the file data will be deflated (compression method 8).
If <code class="docutils literal notranslate"><span class="pre">compress</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>, the file data will be stored (compression method 0).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">forceZip64Format</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, yazl will use ZIP64 format in this entry’s Data Descriptor
and Central Directory Record regardless of if it’s required or not (this may be useful for testing.).
Otherwise, yazl will use ZIP64 format where necessary.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fileComment</span></code> is a <code class="docutils literal notranslate"><span class="pre">string</span></code>, it will be encoded with UTF-8.
If <code class="docutils literal notranslate"><span class="pre">fileComment</span></code> is a <code class="docutils literal notranslate"><span class="pre">Buffer</span></code>, it should be a UTF-8 encoded string.
In UTF-8, <code class="docutils literal notranslate"><span class="pre">fileComment</span></code> must be at most <code class="docutils literal notranslate"><span class="pre">0xffff</span></code> bytes in length.
This becomes the “file comment” field in this entry’s central directory file header.</p>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">fs.stat()</span></code> is called immediately in the <code class="docutils literal notranslate"><span class="pre">addFile</span></code> function,
and <code class="docutils literal notranslate"><span class="pre">fs.createReadStream()</span></code> is used later when the file data is actually required.
Throughout adding and encoding <code class="docutils literal notranslate"><span class="pre">n</span></code> files with <code class="docutils literal notranslate"><span class="pre">addFile()</span></code>,
the number of simultaneous open files is <code class="docutils literal notranslate"><span class="pre">O(1)</span></code>, probably just 1 at a time.</p>
</section>
<section id="addreadstream-readstream-metadatapath-options">
<h4>addReadStream(readStream, metadataPath, [options])<a class="headerlink" href="#addreadstream-readstream-metadatapath-options" title="Permalink to this headline">#</a></h4>
<p>Adds a file to the zip file whose content is read from <code class="docutils literal notranslate"><span class="pre">readStream</span></code>.
See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for info about the <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> parameter.
<code class="docutils literal notranslate"><span class="pre">options</span></code> may be omitted or null and has the following structure and default values:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">mtime</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="mo">0o100664</span><span class="p">,</span>
<span class="w">  </span><span class="nx">compress</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">forceZip64Format</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fileComment</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// or a UTF-8 Buffer</span>
<span class="w">  </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">12345</span><span class="p">,</span><span class="w"> </span><span class="c1">// example value</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for the meaning of <code class="docutils literal notranslate"><span class="pre">mtime</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">compress</span></code>, <code class="docutils literal notranslate"><span class="pre">forceZip64Format</span></code>, and <code class="docutils literal notranslate"><span class="pre">fileComment</span></code>.
If <code class="docutils literal notranslate"><span class="pre">size</span></code> is given, it will be checked against the actual number of bytes in the <code class="docutils literal notranslate"><span class="pre">readStream</span></code>,
and an error will be emitted if there is a mismatch.</p>
<p>Note that yazl will <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> data from <code class="docutils literal notranslate"><span class="pre">readStream</span></code>, so be careful using <code class="docutils literal notranslate"><span class="pre">.on('data')</span></code>.
In certain versions of node, <code class="docutils literal notranslate"><span class="pre">.on('data')</span></code> makes <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> behave incorrectly.</p>
</section>
<section id="addbuffer-buffer-metadatapath-options">
<h4>addBuffer(buffer, metadataPath, [options])<a class="headerlink" href="#addbuffer-buffer-metadatapath-options" title="Permalink to this headline">#</a></h4>
<p>Adds a file to the zip file whose content is <code class="docutils literal notranslate"><span class="pre">buffer</span></code>.
See below for info on the limitations on the size of <code class="docutils literal notranslate"><span class="pre">buffer</span></code>.
See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for info about the <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> parameter.
<code class="docutils literal notranslate"><span class="pre">options</span></code> may be omitted or null and has the following structure and default values:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">mtime</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="mo">0o100664</span><span class="p">,</span>
<span class="w">  </span><span class="nx">compress</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">forceZip64Format</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fileComment</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// or a UTF-8 Buffer</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for the meaning of <code class="docutils literal notranslate"><span class="pre">mtime</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">compress</span></code>, <code class="docutils literal notranslate"><span class="pre">forceZip64Format</span></code>, and <code class="docutils literal notranslate"><span class="pre">fileComment</span></code>.</p>
<p>This method has the unique property that General Purpose Bit <code class="docutils literal notranslate"><span class="pre">3</span></code> will not be used in the Local File Header.
This doesn’t matter for unzip implementations that conform to the Zip File Spec.
However, 7-Zip 9.20 has a known bug where General Purpose Bit <code class="docutils literal notranslate"><span class="pre">3</span></code> is declared an unsupported compression method
(note that it really has nothing to do with the compression method.).
See <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/11">issue #11</a>.
If you would like to create zip files that 7-Zip 9.20 can understand,
you must use <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> or <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code> for all entries in the zip file
(and <code class="docutils literal notranslate"><span class="pre">addEmptyDirectory()</span></code> is fine too).</p>
<p>Note that even when yazl provides the file sizes in the Local File Header,
yazl never uses ZIP64 format for Local File Headers due to the size limit on <code class="docutils literal notranslate"><span class="pre">buffer</span></code> (see below).</p>
<section id="size-limitation-on-buffer">
<h5>Size limitation on buffer<a class="headerlink" href="#size-limitation-on-buffer" title="Permalink to this headline">#</a></h5>
<p>In order to require the ZIP64 format for a local file header,
the provided <code class="docutils literal notranslate"><span class="pre">buffer</span></code> parameter would need to exceed <code class="docutils literal notranslate"><span class="pre">0xfffffffe</span></code> in length.
Alternatively, the <code class="docutils literal notranslate"><span class="pre">buffer</span></code> parameter might not exceed <code class="docutils literal notranslate"><span class="pre">0xfffffffe</span></code> in length,
but zlib compression fails to compress the buffer and actually inflates the data to more than <code class="docutils literal notranslate"><span class="pre">0xfffffffe</span></code> in length.
Both of these scenarios are not allowed by yazl, and those are enforced by a size limit on the <code class="docutils literal notranslate"><span class="pre">buffer</span></code> parameter.</p>
<p>According to <a class="reference external" href="http://www.zlib.net/zlib_tech.html">this zlib documentation</a>,
the worst case compression results in “an expansion of at most 13.5%, plus eleven bytes”.
Furthermore, some configurations of Node.js impose a size limit of <code class="docutils literal notranslate"><span class="pre">0x3fffffff</span></code> on every <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> object.
Running this size through the worst case compression of zlib still produces a size less than <code class="docutils literal notranslate"><span class="pre">0xfffffffe</span></code> bytes,</p>
<p>Therefore, yazl enforces that the provided <code class="docutils literal notranslate"><span class="pre">buffer</span></code> parameter must be at most <code class="docutils literal notranslate"><span class="pre">0x3fffffff</span></code> bytes long.</p>
</section>
</section>
<section id="addemptydirectory-metadatapath-options">
<h4>addEmptyDirectory(metadataPath, [options])<a class="headerlink" href="#addemptydirectory-metadatapath-options" title="Permalink to this headline">#</a></h4>
<p>Adds an entry to the zip file that indicates a directory should be created,
even if no other items in the zip file are contained in the directory.
This method is only required if the zip file is intended to contain an empty directory.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for info about the <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> parameter.
If <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> does not end with a <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code>, a <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code> will be appended.</p>
<p><code class="docutils literal notranslate"><span class="pre">options</span></code> may be omitted or null and has the following structure and default values:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">mtime</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="mo">040775</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> for the meaning of <code class="docutils literal notranslate"><span class="pre">mtime</span></code> and <code class="docutils literal notranslate"><span class="pre">mode</span></code>.</p>
</section>
<section id="end-options-finalsizecallback">
<h4>end([options], [finalSizeCallback])<a class="headerlink" href="#end-options-finalsizecallback" title="Permalink to this headline">#</a></h4>
<p>Indicates that no more files will be added via <code class="docutils literal notranslate"><span class="pre">addFile()</span></code>, <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code>, or <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code>,
and causes the eventual close of <code class="docutils literal notranslate"><span class="pre">outputStream</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">options</span></code> may be omitted or null and has the following structure and default values:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">forceZip64Format</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">comment</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// or a CP437 Buffer</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">forceZip64Format</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, yazl will include the ZIP64 End of Central Directory Locator
and ZIP64 End of Central Directory Record regardless of whether or not they are required
(this may be useful for testing.).
Otherwise, yazl will include these structures if necessary.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">comment</span></code> is a <code class="docutils literal notranslate"><span class="pre">string</span></code>, it will be encoded with CP437.
If <code class="docutils literal notranslate"><span class="pre">comment</span></code> is a <code class="docutils literal notranslate"><span class="pre">Buffer</span></code>, it should be a CP437 encoded string.
<code class="docutils literal notranslate"><span class="pre">comment</span></code> must be at most <code class="docutils literal notranslate"><span class="pre">0xffff</span></code> bytes in length and must not include the byte sequence <code class="docutils literal notranslate"><span class="pre">[0x50,0x4b,0x05,0x06]</span></code>.
This becomes the “.ZIP file comment” field in the end of central directory record.
Note that in practice, most zipfile readers interpret this field in UTF-8 instead of CP437.
If your string uses only codepoints in the range <code class="docutils literal notranslate"><span class="pre">0x20...0x7e</span></code>
(printable ASCII, no whitespace except for sinlge space <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code>),
then UTF-8 and CP437 (and ASCII) encodings are all identical.
This restriction is recommended for maxium compatibility.
To use UTF-8 encoding at your own risk, pass a <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> into this function; it will not be validated.</p>
<p>If specified and non-null, <code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> is given the parameters <code class="docutils literal notranslate"><span class="pre">(finalSize)</span></code>
sometime during or after the call to <code class="docutils literal notranslate"><span class="pre">end()</span></code>.
<code class="docutils literal notranslate"><span class="pre">finalSize</span></code> is of type <code class="docutils literal notranslate"><span class="pre">Number</span></code> and can either be <code class="docutils literal notranslate"><span class="pre">-1</span></code>
or the guaranteed eventual size in bytes of the output data that can be read from <code class="docutils literal notranslate"><span class="pre">outputStream</span></code>.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> is usually called well before <code class="docutils literal notranslate"><span class="pre">outputStream</span></code> has piped all its data;
this callback does not mean that the stream is done.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">finalSize</span></code> is <code class="docutils literal notranslate"><span class="pre">-1</span></code>, it means means the final size is too hard to guess before processing the input file data.
This will happen if and only if the <code class="docutils literal notranslate"><span class="pre">compress</span></code> option is <code class="docutils literal notranslate"><span class="pre">true</span></code> on any call to <code class="docutils literal notranslate"><span class="pre">addFile()</span></code>, <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code>, or <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code>,
or if <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code> is called and the optional <code class="docutils literal notranslate"><span class="pre">size</span></code> option is not given.
In other words, clients should know whether they’re going to get a <code class="docutils literal notranslate"><span class="pre">-1</span></code> or a real value
by looking at how they are using this library.</p>
<p>The call to <code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> might be delayed if yazl is still waiting for <code class="docutils literal notranslate"><span class="pre">fs.Stats</span></code> for an <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> entry.
If <code class="docutils literal notranslate"><span class="pre">addFile()</span></code> was never called, <code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> will be called during the call to <code class="docutils literal notranslate"><span class="pre">end()</span></code>.
It is not required to start piping data from <code class="docutils literal notranslate"><span class="pre">outputStream</span></code> before <code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> is called.
<code class="docutils literal notranslate"><span class="pre">finalSizeCallback</span></code> will be called only once, and only if this is the first call to <code class="docutils literal notranslate"><span class="pre">end()</span></code>.</p>
</section>
<section id="outputstream">
<h4>outputStream<a class="headerlink" href="#outputstream" title="Permalink to this headline">#</a></h4>
<p>A readable stream that will produce the contents of the zip file.
It is typical to pipe this stream to a writable stream created from <code class="docutils literal notranslate"><span class="pre">fs.createWriteStream()</span></code>.</p>
<p>Internally, large amounts of file data are piped to <code class="docutils literal notranslate"><span class="pre">outputStream</span></code> using <code class="docutils literal notranslate"><span class="pre">pipe()</span></code>,
which means throttling happens appropriately when this stream is piped to a slow destination.</p>
<p>Data becomes available in this stream soon after calling one of <code class="docutils literal notranslate"><span class="pre">addFile()</span></code>, <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code>, or <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code>.
Clients can call <code class="docutils literal notranslate"><span class="pre">pipe()</span></code> on this stream at any time,
such as immediately after getting a new <code class="docutils literal notranslate"><span class="pre">ZipFile</span></code> instance, or long after calling <code class="docutils literal notranslate"><span class="pre">end()</span></code>.</p>
<p>This stream will remain open while you add entries until you <code class="docutils literal notranslate"><span class="pre">end()</span></code> the zip file.</p>
<p>As a reminder, be careful using both <code class="docutils literal notranslate"><span class="pre">.on('data')</span></code> and <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> with this stream.
In certain versions of node, you cannot use both <code class="docutils literal notranslate"><span class="pre">.on('data')</span></code> and <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> successfully.</p>
</section>
</section>
<section id="datetodosdatetime-jsdate">
<h3>dateToDosDateTime(jsDate)<a class="headerlink" href="#datetodosdatetime-jsdate" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">jsDate</span></code> is a <code class="docutils literal notranslate"><span class="pre">Date</span></code> instance.
Returns <code class="docutils literal notranslate"><span class="pre">{date:</span> <span class="pre">date,</span> <span class="pre">time:</span> <span class="pre">time}</span></code>, where <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code> are unsigned 16-bit integers.</p>
</section>
</section>
<section id="regarding-zip64-support">
<h2>Regarding ZIP64 Support<a class="headerlink" href="#regarding-zip64-support" title="Permalink to this headline">#</a></h2>
<p>yazl automatically uses ZIP64 format to support files and archives over <code class="docutils literal notranslate"><span class="pre">2^32</span> <span class="pre">-</span> <span class="pre">2</span></code> bytes (~4GB) in size
and to support archives with more than <code class="docutils literal notranslate"><span class="pre">2^16</span> <span class="pre">-</span> <span class="pre">2</span></code> (65534) files.
(See the <code class="docutils literal notranslate"><span class="pre">forceZip64Format</span></code> option in the API above for more control over this behavior.)
ZIP64 format is necessary to exceed the limits inherent in the original zip file format.</p>
<p>ZIP64 format is supported by most popular zipfile readers, but not by all of them.
Notably, the Mac Archive Utility does not understand ZIP64 format (as of writing this),
and will behave very strangely when presented with such an archive.</p>
</section>
<section id="output-structure">
<h2>Output Structure<a class="headerlink" href="#output-structure" title="Permalink to this headline">#</a></h2>
<p>The Zip File Spec leaves a lot of flexibility up to the zip file creator.
This section explains and justifies yazl’s interpretation and decisions regarding this flexibility.</p>
<p>This section is probably not useful to yazl clients,
but may be interesting to unzip implementors and zip file enthusiasts.</p>
<section id="disk-numbers">
<h3>Disk Numbers<a class="headerlink" href="#disk-numbers" title="Permalink to this headline">#</a></h3>
<p>All values related to disk numbers are <code class="docutils literal notranslate"><span class="pre">0</span></code>,
because yazl has no multi-disk archive support.
(The exception being the Total Number of Disks field in
the ZIP64 End of Central Directory Locator, which is always <code class="docutils literal notranslate"><span class="pre">1</span></code>.)</p>
</section>
<section id="version-made-by">
<h3>Version Made By<a class="headerlink" href="#version-made-by" title="Permalink to this headline">#</a></h3>
<p>Always <code class="docutils literal notranslate"><span class="pre">0x033f</span> <span class="pre">==</span> <span class="pre">(3</span> <span class="pre">&lt;&lt;</span> <span class="pre">8)</span> <span class="pre">|</span> <span class="pre">63</span></code>, which means UNIX (3)
and made from the spec version 6.3 (63).</p>
<p>Note that the “UNIX” has implications in the External File Attributes.</p>
</section>
<section id="version-needed-to-extract">
<h3>Version Needed to Extract<a class="headerlink" href="#version-needed-to-extract" title="Permalink to this headline">#</a></h3>
<p>Usually <code class="docutils literal notranslate"><span class="pre">20</span></code>, meaning 2.0. This allows filenames and file comments to be UTF-8 encoded.</p>
<p>When ZIP64 format is used, some of the Version Needed to Extract values will be <code class="docutils literal notranslate"><span class="pre">45</span></code>, meaning 4.5.
When this happens, there may be a mix of <code class="docutils literal notranslate"><span class="pre">20</span></code> and <code class="docutils literal notranslate"><span class="pre">45</span></code> values throughout the zipfile.</p>
</section>
<section id="general-purpose-bit-flag">
<h3>General Purpose Bit Flag<a class="headerlink" href="#general-purpose-bit-flag" title="Permalink to this headline">#</a></h3>
<p>Bit <code class="docutils literal notranslate"><span class="pre">11</span></code> is always set.
Filenames (and file comments) are always encoded in UTF-8, even if the result is indistinguishable from ascii.</p>
<p>Bit <code class="docutils literal notranslate"><span class="pre">3</span></code> is usually set in the Local File Header.
To support both a streaming input and streaming output api,
it is impossible to know the crc32 before processing the file data.
When bit <code class="docutils literal notranslate"><span class="pre">3</span></code> is set, data Descriptors are given after each file data with this information, as per the spec.
But remember a complete metadata listing is still always available in the central directory record,
so if unzip implementations are relying on that, like they should,
none of this paragraph will matter anyway.
Even so, some popular unzip implementations do not follow the spec.
The Mac Archive Utility requires Data Descriptors to include the optional signature,
so yazl includes the optional data descriptor signature.
When bit <code class="docutils literal notranslate"><span class="pre">3</span></code> is not used, the Mac Archive Utility requires there to be no data descriptor, so yazl skips it in that case.
Additionally, 7-Zip 9.20 does not seem to support bit <code class="docutils literal notranslate"><span class="pre">3</span></code> at all
(see <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/11">issue #11</a>).</p>
<p>All other bits are unset.</p>
</section>
<section id="internal-file-attributes">
<h3>Internal File Attributes<a class="headerlink" href="#internal-file-attributes" title="Permalink to this headline">#</a></h3>
<p>Always <code class="docutils literal notranslate"><span class="pre">0</span></code>.
The “apparently an ASCII or text file” bit is always unset meaning “apparently binary”.
This kind of determination is outside the scope of yazl,
and is probably not significant in any modern unzip implementation.</p>
</section>
<section id="external-file-attributes">
<h3>External File Attributes<a class="headerlink" href="#external-file-attributes" title="Permalink to this headline">#</a></h3>
<p>Always <code class="docutils literal notranslate"><span class="pre">stats.mode</span> <span class="pre">&lt;&lt;</span> <span class="pre">16</span></code>.
This is apparently the convention for “version made by” = <code class="docutils literal notranslate"><span class="pre">0x03xx</span></code> (UNIX).</p>
<p>Note that for directory entries (see <code class="docutils literal notranslate"><span class="pre">addEmptyDirectory()</span></code>),
it is conventional to use the lower 8 bits for the MS-DOS directory attribute byte.
However, the spec says this is only required if the Version Made By is DOS,
so this library does not do that.</p>
</section>
<section id="directory-entries">
<h3>Directory Entries<a class="headerlink" href="#directory-entries" title="Permalink to this headline">#</a></h3>
<p>When adding a <code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> such as <code class="docutils literal notranslate"><span class="pre">&quot;parent/file.txt&quot;</span></code>, yazl does not add a directory entry for <code class="docutils literal notranslate"><span class="pre">&quot;parent/&quot;</span></code>,
because file entries imply the need for their parent directories.
Unzip clients seem to respect this style of pathing,
and the zip file spec does not specify what is standard in this regard.</p>
<p>In order to create empty directories, use <code class="docutils literal notranslate"><span class="pre">addEmptyDirectory()</span></code>.</p>
</section>
<section id="size-of-local-file-and-central-directory-entry-metadata">
<h3>Size of Local File and Central Directory Entry Metadata<a class="headerlink" href="#size-of-local-file-and-central-directory-entry-metadata" title="Permalink to this headline">#</a></h3>
<p>The spec recommends that “The combined length of any directory record and [the file name,
extra field, and comment fields] should not generally exceed 65,535 bytes”.
yazl makes no attempt to respect this recommendation.
Instead, each of the fields is limited to 65,535 bytes due to the length of each being encoded as an unsigned 16 bit integer.</p>
</section>
</section>
<section id="change-history">
<h2>Change History<a class="headerlink" href="#change-history" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>2.5.1</p>
<ul>
<li><p>Fix support for old versions of Node and add official support for Node versions 0.10, 4, 6, 8, 10. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/49">pull #49</a></p></li>
</ul>
</li>
<li><p>2.5.0</p>
<ul>
<li><p>Add support for <code class="docutils literal notranslate"><span class="pre">comment</span></code> and <code class="docutils literal notranslate"><span class="pre">fileComment</span></code>. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/44">pull #44</a></p></li>
<li><p>Avoid <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Buffer()</span></code>. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/43">pull #43</a></p></li>
</ul>
</li>
<li><p>2.4.3</p>
<ul>
<li><p>Clarify readme. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/33">pull #33</a></p></li>
</ul>
</li>
<li><p>2.4.2</p>
<ul>
<li><p>Remove octal literals to make yazl compatible with strict mode. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/28">pull #28</a></p></li>
</ul>
</li>
<li><p>2.4.1</p>
<ul>
<li><p>Fix Mac Archive Utility compatibility issue. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/24">issue #24</a></p></li>
</ul>
</li>
<li><p>2.4.0</p>
<ul>
<li><p>Add ZIP64 support. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/6">issue #6</a></p></li>
</ul>
</li>
<li><p>2.3.1</p>
<ul>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">.npmignore</span></code> from npm package. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/22">pull #22</a></p></li>
</ul>
</li>
<li><p>2.3.0</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">metadataPath</span></code> can have <code class="docutils literal notranslate"><span class="pre">\</span></code> characters now; they will be replaced with <code class="docutils literal notranslate"><span class="pre">/</span></code>. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/18">issue #18</a></p></li>
</ul>
</li>
<li><p>2.2.2</p>
<ul>
<li><p>Fix 7-Zip compatibility issue. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/17">pull request #17</a></p></li>
</ul>
</li>
<li><p>2.2.1</p>
<ul>
<li><p>Fix Mac Archive Utility compatibility issue. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/14">issue #14</a></p></li>
</ul>
</li>
<li><p>2.2.0</p>
<ul>
<li><p>Avoid using general purpose bit 3 for <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code> calls. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/13">issue #13</a></p></li>
</ul>
</li>
<li><p>2.1.3</p>
<ul>
<li><p>Fix bug when only addBuffer() and end() are called. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/12">issue #12</a></p></li>
</ul>
</li>
<li><p>2.1.2</p>
<ul>
<li><p>Fixed typo in parameter validation. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/pull/10">pull request #10</a></p></li>
</ul>
</li>
<li><p>2.1.1</p>
<ul>
<li><p>Fixed stack overflow when using addBuffer() in certain ways. <a class="reference external" href="https://github.com/thejoshwolfe/yazl/issues/9">issue #9</a></p></li>
</ul>
</li>
<li><p>2.1.0</p>
<ul>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">addEmptyDirectory()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code> is now optional for <code class="docutils literal notranslate"><span class="pre">addReadStream()</span></code> and <code class="docutils literal notranslate"><span class="pre">addBuffer()</span></code>.</p></li>
</ul>
</li>
<li><p>2.0.0</p>
<ul>
<li><p>Initial release.</p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/yazl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>