
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>lru-cache &#8212; INF 133 Fall 2023</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../../_static/logo_stacked.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">INF 133 Fall 2023</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../../index.html">
                    User Interaction Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a0.html">
   Assignment 0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a1.html">
   Assignment 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a2.html">
   Assignment 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a3.html">
   Assignment 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a4.html">
   Assignment 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../assignments/a5.html">
   Assignment 5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk1.html">
   Week 1 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk2.html">
   Week 2 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk3.html">
   Week 3 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk4.html">
   Week 4 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk5.html">
   Week 5 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk6.html">
   Week 6 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk7.html">
   Week 7 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk8.html">
   Week 8 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk9.html">
   Week 9 Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../notes/wk10.html">
   Week 10 Notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../resources.html">
   Resources
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../../_sources/reveal/node_modules/path-scurry/node_modules/lru-cache/README.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#class-lrucache-k-v-fc-unknown-options">
   <code class="docutils literal notranslate">
    <span class="pre">
     class
    </span>
    <span class="pre">
     LRUCache&lt;K,
    </span>
    <span class="pre">
     V,
    </span>
    <span class="pre">
     FC
    </span>
    <span class="pre">
     =
    </span>
    <span class="pre">
     unknown&gt;(options)
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#options">
   Options
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       max
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maxsize-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       maxSize
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maxentrysize">
     <code class="docutils literal notranslate">
      <span class="pre">
       maxEntrySize
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sizecalculation">
     <code class="docutils literal notranslate">
      <span class="pre">
       sizeCalculation
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetchmethod-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       fetchMethod
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodeleteonfetchrejection">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDeleteOnFetchRejection
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstaleonfetchrejection">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStaleOnFetchRejection
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstaleonfetchabort">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStaleOnFetchAbort
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ignorefetchabort">
     <code class="docutils literal notranslate">
      <span class="pre">
       ignoreFetchAbort
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dispose-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       dispose
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disposeafter-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       disposeAfter
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodisposeonset">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDisposeOnSet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttl">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttl
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#noupdatettl">
     <code class="docutils literal notranslate">
      <span class="pre">
       noUpdateTTL
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttlresolution">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttlResolution
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttlautopurge">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttlAutopurge
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstale">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStale
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodeleteonstaleget">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDeleteOnStaleGet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updateageonget">
     <code class="docutils literal notranslate">
      <span class="pre">
       updateAgeOnGet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updateageonhas">
     <code class="docutils literal notranslate">
      <span class="pre">
       updateAgeOnHas
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-lrucache-k-v-fc-unknown-options">
     <code class="docutils literal notranslate">
      <span class="pre">
       new
      </span>
      <span class="pre">
       LRUCache&lt;K,
      </span>
      <span class="pre">
       V,
      </span>
      <span class="pre">
       FC
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       unknown&gt;(options)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-max-cache-maxsize-cache-allowstale">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.max
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.maxSize
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.allowStale
      </span>
     </code>
     ,
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-size">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.size
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-calculatedsize">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.calculatedSize
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-key-value-size-sizecalculation-ttl-nodisposeonset-start-status">
     <code class="docutils literal notranslate">
      <span class="pre">
       set(key,
      </span>
      <span class="pre">
       value,
      </span>
      <span class="pre">
       [{
      </span>
      <span class="pre">
       size,
      </span>
      <span class="pre">
       sizeCalculation,
      </span>
      <span class="pre">
       ttl,
      </span>
      <span class="pre">
       noDisposeOnSet,
      </span>
      <span class="pre">
       start,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-key-updateageonget-allowstale-status-value">
     <code class="docutils literal notranslate">
      <span class="pre">
       get(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       updateAgeOnGet,
      </span>
      <span class="pre">
       allowStale,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       value
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#async-fetch-key-options-promise">
     <code class="docutils literal notranslate">
      <span class="pre">
       async
      </span>
      <span class="pre">
       fetch(key,
      </span>
      <span class="pre">
       options
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       Promise
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-context">
       Setting
       <code class="docutils literal notranslate">
        <span class="pre">
         context
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#note-fetch-calls-are-inflight-unique">
       Note:
       <code class="docutils literal notranslate">
        <span class="pre">
         fetch()
        </span>
       </code>
       calls are inflight-unique
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#peek-key-allowstale-value">
     <code class="docutils literal notranslate">
      <span class="pre">
       peek(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       allowStale
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       value
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#has-key-updateageonhas-status-boolean">
     <code class="docutils literal notranslate">
      <span class="pre">
       has(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       updateAgeOnHas,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       Boolean
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#delete-key">
     <code class="docutils literal notranslate">
      <span class="pre">
       delete(key)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clear">
     <code class="docutils literal notranslate">
      <span class="pre">
       clear()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keys">
     <code class="docutils literal notranslate">
      <span class="pre">
       keys()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rkeys">
     <code class="docutils literal notranslate">
      <span class="pre">
       rkeys()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#values">
     <code class="docutils literal notranslate">
      <span class="pre">
       values()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rvalues">
     <code class="docutils literal notranslate">
      <span class="pre">
       rvalues()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entries">
     <code class="docutils literal notranslate">
      <span class="pre">
       entries()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rentries">
     <code class="docutils literal notranslate">
      <span class="pre">
       rentries()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-fn-getoptions">
     <code class="docutils literal notranslate">
      <span class="pre">
       find(fn,
      </span>
      <span class="pre">
       [getOptions])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dump">
     <code class="docutils literal notranslate">
      <span class="pre">
       dump()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-entries">
     <code class="docutils literal notranslate">
      <span class="pre">
       load(entries)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purgestale">
     <code class="docutils literal notranslate">
      <span class="pre">
       purgeStale()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getremainingttl-key">
     <code class="docutils literal notranslate">
      <span class="pre">
       getRemainingTTL(key)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#foreach-fn-thisp">
     <code class="docutils literal notranslate">
      <span class="pre">
       forEach(fn,
      </span>
      <span class="pre">
       [thisp])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rforeach-fn-thisp">
     <code class="docutils literal notranslate">
      <span class="pre">
       rforEach(fn,
      </span>
      <span class="pre">
       [thisp])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pop">
     <code class="docutils literal notranslate">
      <span class="pre">
       pop()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#status-tracking">
   Status Tracking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#storage-bounds-safety">
   Storage Bounds Safety
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#storing-undefined-values">
   Storing Undefined Values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performance">
   Performance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#breaking-changes-in-version-7">
   Breaking Changes in Version 7
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#breaking-changes-in-version-8">
   Breaking Changes in Version 8
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changes-in-version-9">
   Changes in Version 9
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>lru-cache</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#class-lrucache-k-v-fc-unknown-options">
   <code class="docutils literal notranslate">
    <span class="pre">
     class
    </span>
    <span class="pre">
     LRUCache&lt;K,
    </span>
    <span class="pre">
     V,
    </span>
    <span class="pre">
     FC
    </span>
    <span class="pre">
     =
    </span>
    <span class="pre">
     unknown&gt;(options)
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#options">
   Options
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       max
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maxsize-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       maxSize
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maxentrysize">
     <code class="docutils literal notranslate">
      <span class="pre">
       maxEntrySize
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sizecalculation">
     <code class="docutils literal notranslate">
      <span class="pre">
       sizeCalculation
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetchmethod-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       fetchMethod
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodeleteonfetchrejection">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDeleteOnFetchRejection
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstaleonfetchrejection">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStaleOnFetchRejection
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstaleonfetchabort">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStaleOnFetchAbort
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ignorefetchabort">
     <code class="docutils literal notranslate">
      <span class="pre">
       ignoreFetchAbort
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dispose-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       dispose
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disposeafter-read-only">
     <code class="docutils literal notranslate">
      <span class="pre">
       disposeAfter
      </span>
     </code>
     (read only)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodisposeonset">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDisposeOnSet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttl">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttl
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#noupdatettl">
     <code class="docutils literal notranslate">
      <span class="pre">
       noUpdateTTL
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttlresolution">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttlResolution
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ttlautopurge">
     <code class="docutils literal notranslate">
      <span class="pre">
       ttlAutopurge
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#allowstale">
     <code class="docutils literal notranslate">
      <span class="pre">
       allowStale
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodeleteonstaleget">
     <code class="docutils literal notranslate">
      <span class="pre">
       noDeleteOnStaleGet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updateageonget">
     <code class="docutils literal notranslate">
      <span class="pre">
       updateAgeOnGet
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updateageonhas">
     <code class="docutils literal notranslate">
      <span class="pre">
       updateAgeOnHas
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-lrucache-k-v-fc-unknown-options">
     <code class="docutils literal notranslate">
      <span class="pre">
       new
      </span>
      <span class="pre">
       LRUCache&lt;K,
      </span>
      <span class="pre">
       V,
      </span>
      <span class="pre">
       FC
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       unknown&gt;(options)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-max-cache-maxsize-cache-allowstale">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.max
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.maxSize
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.allowStale
      </span>
     </code>
     ,
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-size">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.size
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cache-calculatedsize">
     <code class="docutils literal notranslate">
      <span class="pre">
       cache.calculatedSize
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-key-value-size-sizecalculation-ttl-nodisposeonset-start-status">
     <code class="docutils literal notranslate">
      <span class="pre">
       set(key,
      </span>
      <span class="pre">
       value,
      </span>
      <span class="pre">
       [{
      </span>
      <span class="pre">
       size,
      </span>
      <span class="pre">
       sizeCalculation,
      </span>
      <span class="pre">
       ttl,
      </span>
      <span class="pre">
       noDisposeOnSet,
      </span>
      <span class="pre">
       start,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-key-updateageonget-allowstale-status-value">
     <code class="docutils literal notranslate">
      <span class="pre">
       get(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       updateAgeOnGet,
      </span>
      <span class="pre">
       allowStale,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       value
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#async-fetch-key-options-promise">
     <code class="docutils literal notranslate">
      <span class="pre">
       async
      </span>
      <span class="pre">
       fetch(key,
      </span>
      <span class="pre">
       options
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       Promise
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-context">
       Setting
       <code class="docutils literal notranslate">
        <span class="pre">
         context
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#note-fetch-calls-are-inflight-unique">
       Note:
       <code class="docutils literal notranslate">
        <span class="pre">
         fetch()
        </span>
       </code>
       calls are inflight-unique
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#peek-key-allowstale-value">
     <code class="docutils literal notranslate">
      <span class="pre">
       peek(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       allowStale
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       value
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#has-key-updateageonhas-status-boolean">
     <code class="docutils literal notranslate">
      <span class="pre">
       has(key,
      </span>
      <span class="pre">
       {
      </span>
      <span class="pre">
       updateAgeOnHas,
      </span>
      <span class="pre">
       status
      </span>
      <span class="pre">
       }
      </span>
      <span class="pre">
       =
      </span>
      <span class="pre">
       {})
      </span>
      <span class="pre">
       =&gt;
      </span>
      <span class="pre">
       Boolean
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#delete-key">
     <code class="docutils literal notranslate">
      <span class="pre">
       delete(key)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clear">
     <code class="docutils literal notranslate">
      <span class="pre">
       clear()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keys">
     <code class="docutils literal notranslate">
      <span class="pre">
       keys()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rkeys">
     <code class="docutils literal notranslate">
      <span class="pre">
       rkeys()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#values">
     <code class="docutils literal notranslate">
      <span class="pre">
       values()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rvalues">
     <code class="docutils literal notranslate">
      <span class="pre">
       rvalues()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entries">
     <code class="docutils literal notranslate">
      <span class="pre">
       entries()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rentries">
     <code class="docutils literal notranslate">
      <span class="pre">
       rentries()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-fn-getoptions">
     <code class="docutils literal notranslate">
      <span class="pre">
       find(fn,
      </span>
      <span class="pre">
       [getOptions])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dump">
     <code class="docutils literal notranslate">
      <span class="pre">
       dump()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-entries">
     <code class="docutils literal notranslate">
      <span class="pre">
       load(entries)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purgestale">
     <code class="docutils literal notranslate">
      <span class="pre">
       purgeStale()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getremainingttl-key">
     <code class="docutils literal notranslate">
      <span class="pre">
       getRemainingTTL(key)
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#foreach-fn-thisp">
     <code class="docutils literal notranslate">
      <span class="pre">
       forEach(fn,
      </span>
      <span class="pre">
       [thisp])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rforeach-fn-thisp">
     <code class="docutils literal notranslate">
      <span class="pre">
       rforEach(fn,
      </span>
      <span class="pre">
       [thisp])
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pop">
     <code class="docutils literal notranslate">
      <span class="pre">
       pop()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#status-tracking">
   Status Tracking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#storage-bounds-safety">
   Storage Bounds Safety
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#storing-undefined-values">
   Storing Undefined Values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performance">
   Performance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#breaking-changes-in-version-7">
   Breaking Changes in Version 7
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#breaking-changes-in-version-8">
   Breaking Changes in Version 8
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changes-in-version-9">
   Changes in Version 9
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lru-cache">
<h1>lru-cache<a class="headerlink" href="#lru-cache" title="Permalink to this headline">#</a></h1>
<p>A cache object that deletes the least-recently-used items.</p>
<p>Specify a max number of the most recently used items that you
want to keep, and this cache will keep that many of the most
recently accessed items.</p>
<p>This is not primarily a TTL cache, and does not make strong TTL
guarantees. There is no preemptive pruning of expired items by
default, but you <em>may</em> set a TTL on the cache or on a single
<code class="docutils literal notranslate"><span class="pre">set</span></code>. If you do so, it will treat expired items as missing, and
delete them when fetched. If you are more interested in TTL
caching than LRU caching, check out
<a class="reference external" href="http://npm.im/&#64;isaacs/ttlcache">&#64;isaacs/ttlcache</a>.</p>
<p>As of version 7, this is one of the most performant LRU
implementations available in JavaScript, and supports a wide
diversity of use cases. However, note that using some of the
features will necessarily impact performance, by causing the
cache to have to do more work. See the “Performance” section
below.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>lru-cache<span class="w"> </span>--save
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// hybrid module, either works</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LRUCache</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lru-cache&#39;</span>
<span class="c1">// or:</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LRUCache</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lru-cache&#39;</span><span class="p">)</span>
<span class="c1">// or in minified form for web browsers:</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LRUCache</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;http://unpkg.com/lru-cache@9/dist/mjs/index.min.mjs&#39;</span>

<span class="c1">// At least one of &#39;max&#39;, &#39;ttl&#39;, or &#39;maxSize&#39; is required, to prevent</span>
<span class="c1">// unsafe unbounded storage.</span>
<span class="c1">//</span>
<span class="c1">// In most cases, it&#39;s best to specify a max for performance, so all</span>
<span class="c1">// the required memory allocation is done up-front.</span>
<span class="c1">//</span>
<span class="c1">// All the other options are optional, see the sections below for</span>
<span class="c1">// documentation on what each one does.  Most of them can be</span>
<span class="c1">// overridden for specific items in get()/set()</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// for use with tracking overall storage size</span>
<span class="w">  </span><span class="nx">maxSize</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sizeCalculation</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// for use when you need to clean up something when objects</span>
<span class="w">  </span><span class="c1">// are evicted from the cache</span>
<span class="w">  </span><span class="nx">dispose</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">freeFromMemoryOrWhatever</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// how long to live in ms</span>
<span class="w">  </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// return stale items before removing from cache?</span>
<span class="w">  </span><span class="nx">allowStale</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>

<span class="w">  </span><span class="nx">updateAgeOnGet</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">updateAgeOnHas</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// async method to use for cache.fetch(), for</span>
<span class="w">  </span><span class="c1">// stale-while-revalidate type of behavior</span>
<span class="w">  </span><span class="nx">fetchMethod</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">key</span><span class="p">,</span>
<span class="w">    </span><span class="nx">staleValue</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="nx">signal</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{},</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LRUCache</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

<span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// &quot;value&quot;</span>

<span class="c1">// non-string keys ARE fully supported</span>
<span class="c1">// but note that it must be THE SAME object, not</span>
<span class="c1">// just a JSON-equivalent object.</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">someObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">someObject</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;a value&#39;</span><span class="p">)</span>
<span class="c1">// Object keys are not toString()-ed</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;[object Object]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;a different value&#39;</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">someObject</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;a value&#39;</span><span class="p">)</span>
<span class="c1">// A similar object with same keys/values won&#39;t work,</span>
<span class="c1">// because it&#39;s a different object identity</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="w"> </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span>

<span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span><span class="w"> </span><span class="c1">// empty the cache</span>
</pre></div>
</div>
<p>If you put more stuff in the cache, then less recently used items
will fall out. That’s what an LRU cache is.</p>
</section>
<section id="class-lrucache-k-v-fc-unknown-options">
<h2><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">LRUCache&lt;K,</span> <span class="pre">V,</span> <span class="pre">FC</span> <span class="pre">=</span> <span class="pre">unknown&gt;(options)</span></code><a class="headerlink" href="#class-lrucache-k-v-fc-unknown-options" title="Permalink to this headline">#</a></h2>
<p>Create a new <code class="docutils literal notranslate"><span class="pre">LRUCache</span></code> object.</p>
<p>When using TypeScript, set the <code class="docutils literal notranslate"><span class="pre">K</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code> types to the <code class="docutils literal notranslate"><span class="pre">key</span></code> and
<code class="docutils literal notranslate"><span class="pre">value</span></code> types, respectively.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FC</span></code> (“fetch context”) generic type defaults to <code class="docutils literal notranslate"><span class="pre">unknown</span></code>.
If set to a value other than <code class="docutils literal notranslate"><span class="pre">void</span></code> or <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, then any
calls to <code class="docutils literal notranslate"><span class="pre">cache.fetch()</span></code> <em>must</em> provide a <code class="docutils literal notranslate"><span class="pre">context</span></code> option
matching the <code class="docutils literal notranslate"><span class="pre">FC</span></code> type. If <code class="docutils literal notranslate"><span class="pre">FC</span></code> is set to <code class="docutils literal notranslate"><span class="pre">void</span></code> or <code class="docutils literal notranslate"><span class="pre">undefined</span></code>,
then <code class="docutils literal notranslate"><span class="pre">cache.fetch()</span></code> <em>must not</em> provide a <code class="docutils literal notranslate"><span class="pre">context</span></code> option. See
the documentation on <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">fetch()</span></code> below.</p>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">#</a></h2>
<p>All options are available on the LRUCache instance, making it
safe to pass an LRUCache instance as the options argument to make
another empty cache of the same type.</p>
<p>Some options are marked read-only because changing them after
instantiation is not safe. Changing any of the other options
will of course only have an effect on subsequent method calls.</p>
<section id="max-read-only">
<h3><code class="docutils literal notranslate"><span class="pre">max</span></code> (read only)<a class="headerlink" href="#max-read-only" title="Permalink to this headline">#</a></h3>
<p>The maximum number of items that remain in the cache (assuming no
TTL pruning or explicit deletions). Note that fewer items may be
stored if size calculation is used, and <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is exceeded.
This must be a positive finite intger.</p>
<p>At least one of <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>, or <code class="docutils literal notranslate"><span class="pre">TTL</span></code> is required. This
must be a positive integer if set.</p>
<p><strong>It is strongly recommended to set a <code class="docutils literal notranslate"><span class="pre">max</span></code> to prevent unbounded
growth of the cache.</strong> See “Storage Bounds Safety” below.</p>
</section>
<section id="maxsize-read-only">
<h3><code class="docutils literal notranslate"><span class="pre">maxSize</span></code> (read only)<a class="headerlink" href="#maxsize-read-only" title="Permalink to this headline">#</a></h3>
<p>Set to a positive integer to track the sizes of items added to
the cache, and automatically evict items in order to stay below
this size. Note that this may result in fewer than <code class="docutils literal notranslate"><span class="pre">max</span></code> items
being stored.</p>
<p>Attempting to add an item to the cache whose calculated size is
greater that this amount will be a no-op. The item will not be
cached, and no other items will be evicted.</p>
<p>Optional, must be a positive integer if provided.</p>
<p>Sets <code class="docutils literal notranslate"><span class="pre">maxEntrySize</span></code> to the same value, unless a different value
is provided for <code class="docutils literal notranslate"><span class="pre">maxEntrySize</span></code>.</p>
<p>At least one of <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>, or <code class="docutils literal notranslate"><span class="pre">TTL</span></code> is required. This
must be a positive integer if set.</p>
<p>Even if size tracking is enabled, <strong>it is strongly recommended to
set a <code class="docutils literal notranslate"><span class="pre">max</span></code> to prevent unbounded growth of the cache.</strong> See
“Storage Bounds Safety” below.</p>
</section>
<section id="maxentrysize">
<h3><code class="docutils literal notranslate"><span class="pre">maxEntrySize</span></code><a class="headerlink" href="#maxentrysize" title="Permalink to this headline">#</a></h3>
<p>Set to a positive integer to track the sizes of items added to
the cache, and prevent caching any item over a given size.
Attempting to add an item whose calculated size is greater than
this amount will be a no-op. The item will not be cached, and no
other items will be evicted.</p>
<p>Optional, must be a positive integer if provided. Defaults to
the value of <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> if provided.</p>
</section>
<section id="sizecalculation">
<h3><code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code><a class="headerlink" href="#sizecalculation" title="Permalink to this headline">#</a></h3>
<p>Function used to calculate the size of stored items. If you’re
storing strings or buffers, then you probably want to do
something like <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=&gt;</span> <span class="pre">n.length</span></code>. The item is passed as the first
argument, and the key is passed as the second argument.</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.set()</span></code>.</p>
<p>Requires <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> to be set.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">size</span></code> (or return value of <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code>) for a given
entry is greater than <code class="docutils literal notranslate"><span class="pre">maxEntrySize</span></code>, then the item will not be
added to the cache.</p>
</section>
<section id="fetchmethod-read-only">
<h3><code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> (read only)<a class="headerlink" href="#fetchmethod-read-only" title="Permalink to this headline">#</a></h3>
<p>Function that is used to make background asynchronous fetches.
Called with <code class="docutils literal notranslate"><span class="pre">fetchMethod(key,</span> <span class="pre">staleValue,</span> <span class="pre">{</span> <span class="pre">signal,</span> <span class="pre">options,</span> <span class="pre">context</span> <span class="pre">})</span></code>. May return a Promise.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> is not provided, then <code class="docutils literal notranslate"><span class="pre">cache.fetch(key)</span></code> is
equivalent to <code class="docutils literal notranslate"><span class="pre">Promise.resolve(cache.get(key))</span></code>.</p>
<p>If at any time, <code class="docutils literal notranslate"><span class="pre">signal.aborted</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, or if the
<code class="docutils literal notranslate"><span class="pre">signal.onabort</span></code> method is called, or if it emits an <code class="docutils literal notranslate"><span class="pre">'abort'</span></code>
event which you can listen to with <code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>, then that
means that the fetch should be abandoned. This may be passed
along to async functions aware of AbortController/AbortSignal
behavior.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> should <strong>only</strong> return <code class="docutils literal notranslate"><span class="pre">undefined</span></code> or a Promise
resolving to <code class="docutils literal notranslate"><span class="pre">undefined</span></code> if the AbortController signaled an
<code class="docutils literal notranslate"><span class="pre">abort</span></code> event. In all other cases, it should return or resolve
to a value suitable for adding to the cache.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> object is a union of the options that may be
provided to <code class="docutils literal notranslate"><span class="pre">set()</span></code> and <code class="docutils literal notranslate"><span class="pre">get()</span></code>. If they are modified, then that
will result in modifying the settings to <code class="docutils literal notranslate"><span class="pre">cache.set()</span></code> when the
value is resolved, and in the case of <code class="docutils literal notranslate"><span class="pre">noDeleteOnFetchRejection</span></code>
and <code class="docutils literal notranslate"><span class="pre">allowStaleOnFetchRejection</span></code>, the handling of <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>
failures.</p>
<p>For example, a DNS cache may update the TTL based on the value
returned from a remote DNS server by changing <code class="docutils literal notranslate"><span class="pre">options.ttl</span></code> in
the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>.</p>
</section>
<section id="nodeleteonfetchrejection">
<h3><code class="docutils literal notranslate"><span class="pre">noDeleteOnFetchRejection</span></code><a class="headerlink" href="#nodeleteonfetchrejection" title="Permalink to this headline">#</a></h3>
<p>If a <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> throws an error or returns a rejected promise,
then by default, any existing stale value will be removed from
the cache.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">noDeleteOnFetchRejection</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, then this
behavior is suppressed, and the stale value remains in the cache
in the case of a rejected <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>.</p>
<p>This is important in cases where a <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> is <em>only</em> called
as a background update while the stale value is returned, when
<code class="docutils literal notranslate"><span class="pre">allowStale</span></code> is used.</p>
<p>This is implicitly in effect when <code class="docutils literal notranslate"><span class="pre">allowStaleOnFetchRejection</span></code> is
set.</p>
<p>This may be set in calls to <code class="docutils literal notranslate"><span class="pre">fetch()</span></code>, or defaulted on the
constructor, or overridden by modifying the options object in the
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>.</p>
</section>
<section id="allowstaleonfetchrejection">
<h3><code class="docutils literal notranslate"><span class="pre">allowStaleOnFetchRejection</span></code><a class="headerlink" href="#allowstaleonfetchrejection" title="Permalink to this headline">#</a></h3>
<p>Set to true to return a stale value from the cache when a
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> throws an error or returns a rejected Promise.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> fails, and there is no stale value available,
the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> will resolve to <code class="docutils literal notranslate"><span class="pre">undefined</span></code>. Ie, all <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>
errors are suppressed.</p>
<p>Implies <code class="docutils literal notranslate"><span class="pre">noDeleteOnFetchRejection</span></code>.</p>
<p>This may be set in calls to <code class="docutils literal notranslate"><span class="pre">fetch()</span></code>, or defaulted on the
constructor, or overridden by modifying the options object in the
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>.</p>
</section>
<section id="allowstaleonfetchabort">
<h3><code class="docutils literal notranslate"><span class="pre">allowStaleOnFetchAbort</span></code><a class="headerlink" href="#allowstaleonfetchabort" title="Permalink to this headline">#</a></h3>
<p>Set to true to return a stale value from the cache when the
<code class="docutils literal notranslate"><span class="pre">AbortSignal</span></code> passed to the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> dispatches an <code class="docutils literal notranslate"><span class="pre">'abort'</span></code>
event, whether user-triggered, or due to internal cache behavior.</p>
<p>Unless <code class="docutils literal notranslate"><span class="pre">ignoreFetchAbort</span></code> is also set, the underlying
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> will still be considered canceled, and any value
it returns will be ignored and not cached.</p>
<p>Caveat: since fetches are aborted when a new value is explicitly
set in the cache, this can lead to fetch returning a stale value,
since that was the fallback value <em>at the moment the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> was
initiated</em>, even though the new updated value is now present in
the cache.</p>
<p>For example:</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LRUCache</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">({</span>
<span class="w">  </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fetchMethod</span><span class="o">:</span><span class="w"> </span><span class="kt">async</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">oldValue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">signal</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">signal</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">})</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">some</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;data&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="c1">// 100ms go by...</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">)</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;thing&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="c1">// { some: &#39;data&#39; }</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">))</span><span class="w"> </span><span class="c1">// { other: &#39;thing&#39; }</span>
</pre></div>
</div>
</section>
<section id="ignorefetchabort">
<h3><code class="docutils literal notranslate"><span class="pre">ignoreFetchAbort</span></code><a class="headerlink" href="#ignorefetchabort" title="Permalink to this headline">#</a></h3>
<p>Set to true to ignore the <code class="docutils literal notranslate"><span class="pre">abort</span></code> event emitted by the
<code class="docutils literal notranslate"><span class="pre">AbortSignal</span></code> object passed to <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>, and still cache the
resulting resolution value, as long as it is not <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
<p>When used on its own, this means aborted <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> calls are not
immediately resolved or rejected when they are aborted, and
instead take the full time to await.</p>
<p>When used with <code class="docutils literal notranslate"><span class="pre">allowStaleOnFetchAbort</span></code>, aborted <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> calls
will resolve immediately to their stale cached value or
<code class="docutils literal notranslate"><span class="pre">undefined</span></code>, and will continue to process and eventually update
the cache when they resolve, as long as the resulting value is
not <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, thus supporting a “return stale on timeout while
refreshing” mechanism by passing <code class="docutils literal notranslate"><span class="pre">AbortSignal.timeout(n)</span></code> as the
signal.</p>
<p>For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LRUCache</span><span class="p">({</span>
<span class="w">  </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ignoreFetchAbort</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">allowStaleOnFetchAbort</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fetchMethod</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">oldValue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">signal</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// note: do NOT pass the signal to fetch()!</span>
<span class="w">    </span><span class="c1">// let&#39;s say this fetch can take a long time.</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://slow-backend-server/</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">})</span>

<span class="c1">// this will return the stale value after 100ms, while still</span>
<span class="c1">// updating in the background for next time.</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="nx">AbortSignal</span><span class="p">.</span><span class="nx">timeout</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
</pre></div>
</div>
<p><strong>Note</strong>: regardless of this setting, an <code class="docutils literal notranslate"><span class="pre">abort</span></code> event <em>is still
emitted on the <code class="docutils literal notranslate"><span class="pre">AbortSignal</span></code> object</em>, so may result in invalid
results when passed to other underlying APIs that use
AbortSignals.</p>
<p>This may be overridden on the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> call or in the
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> itself.</p>
</section>
<section id="dispose-read-only">
<h3><code class="docutils literal notranslate"><span class="pre">dispose</span></code> (read only)<a class="headerlink" href="#dispose-read-only" title="Permalink to this headline">#</a></h3>
<p>Function that is called on items when they are dropped from the
cache, as <code class="docutils literal notranslate"><span class="pre">this.dispose(value,</span> <span class="pre">key,</span> <span class="pre">reason)</span></code>.</p>
<p>This can be handy if you want to close file descriptors or do
other cleanup tasks when items are no longer stored in the cache.</p>
<p><strong>NOTE</strong>: It is called <em>before</em> the item has been fully removed
from the cache, so if you want to put it right back in, you need
to wait until the next tick. If you try to add it back in during
the <code class="docutils literal notranslate"><span class="pre">dispose()</span></code> function call, it will break things in subtle and
weird ways.</p>
<p>Unlike several other options, this may <em>not</em> be overridden by
passing an option to <code class="docutils literal notranslate"><span class="pre">set()</span></code>, for performance reasons.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">reason</span></code> will be one of the following strings, corresponding
to the reason for the item’s deletion:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">evict</span></code> Item was evicted to make space for a new addition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span></code> Item was overwritten by a new value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete</span></code> Item was removed by explicit <code class="docutils literal notranslate"><span class="pre">cache.delete(key)</span></code> or by
calling <code class="docutils literal notranslate"><span class="pre">cache.clear()</span></code>, which deletes everything.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">dispose()</span></code> method is <em>not</em> called for canceled calls to
<code class="docutils literal notranslate"><span class="pre">fetchMethod()</span></code>. If you wish to handle evictions, overwrites,
and deletes of in-flight asynchronous fetches, you must use the
<code class="docutils literal notranslate"><span class="pre">AbortSignal</span></code> provided.</p>
<p>Optional, must be a function.</p>
</section>
<section id="disposeafter-read-only">
<h3><code class="docutils literal notranslate"><span class="pre">disposeAfter</span></code> (read only)<a class="headerlink" href="#disposeafter-read-only" title="Permalink to this headline">#</a></h3>
<p>The same as <code class="docutils literal notranslate"><span class="pre">dispose</span></code>, but called <em>after</em> the entry is completely
removed and the cache is once again in a clean state.</p>
<p>It is safe to add an item right back into the cache at this
point. However, note that it is <em>very</em> easy to inadvertently
create infinite recursion in this way.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">disposeAfter()</span></code> method is <em>not</em> called for canceled calls to
<code class="docutils literal notranslate"><span class="pre">fetchMethod()</span></code>. If you wish to handle evictions, overwrites,
and deletes of in-flight asynchronous fetches, you must use the
<code class="docutils literal notranslate"><span class="pre">AbortSignal</span></code> provided.</p>
</section>
<section id="nodisposeonset">
<h3><code class="docutils literal notranslate"><span class="pre">noDisposeOnSet</span></code><a class="headerlink" href="#nodisposeonset" title="Permalink to this headline">#</a></h3>
<p>Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to suppress calling the <code class="docutils literal notranslate"><span class="pre">dispose()</span></code> function if the
entry key is still accessible within the cache.</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.set()</span></code>.</p>
<p>Boolean, default <code class="docutils literal notranslate"><span class="pre">false</span></code>. Only relevant if <code class="docutils literal notranslate"><span class="pre">dispose</span></code> or
<code class="docutils literal notranslate"><span class="pre">disposeAfter</span></code> options are set.</p>
</section>
<section id="ttl">
<h3><code class="docutils literal notranslate"><span class="pre">ttl</span></code><a class="headerlink" href="#ttl" title="Permalink to this headline">#</a></h3>
<p>Max time to live for items before they are considered stale.
Note that stale items are NOT preemptively removed by default,
and MAY live in the cache, contributing to its LRU max, long
after they have expired.</p>
<p>Also, as this cache is optimized for LRU/MRU operations, some of
the staleness/TTL checks will reduce performance.</p>
<p>This is not primarily a TTL cache, and does not make strong TTL
guarantees. There is no pre-emptive pruning of expired items,
but you <em>may</em> set a TTL on the cache, and it will treat expired
items as missing when they are fetched, and delete them.</p>
<p>Optional, but must be a positive integer in ms if specified.</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.set()</span></code>.</p>
<p>At least one of <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>, or <code class="docutils literal notranslate"><span class="pre">TTL</span></code> is required. This
must be a positive integer if set.</p>
<p>Even if ttl tracking is enabled, <strong>it is strongly recommended to
set a <code class="docutils literal notranslate"><span class="pre">max</span></code> to prevent unbounded growth of the cache.</strong> See
“Storage Bounds Safety” below.</p>
<p>If ttl tracking is enabled, and <code class="docutils literal notranslate"><span class="pre">max</span></code> and <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> are not set,
and <code class="docutils literal notranslate"><span class="pre">ttlAutopurge</span></code> is not set, then a warning will be emitted
cautioning about the potential for unbounded memory consumption.
(The TypeScript definitions will also discourage this.)</p>
</section>
<section id="noupdatettl">
<h3><code class="docutils literal notranslate"><span class="pre">noUpdateTTL</span></code><a class="headerlink" href="#noupdatettl" title="Permalink to this headline">#</a></h3>
<p>Boolean flag to tell the cache to not update the TTL when setting
a new value for an existing key (ie, when updating a value rather
than inserting a new value). Note that the TTL value is <em>always</em>
set (if provided) when adding a new entry into the cache.</p>
<p>This may be passed as an option to <code class="docutils literal notranslate"><span class="pre">cache.set()</span></code>.</p>
<p>Boolean, default false.</p>
</section>
<section id="ttlresolution">
<h3><code class="docutils literal notranslate"><span class="pre">ttlResolution</span></code><a class="headerlink" href="#ttlresolution" title="Permalink to this headline">#</a></h3>
<p>Minimum amount of time in ms in which to check for staleness.
Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>, which means that the current time is checked at
most once per millisecond.</p>
<p>Set to <code class="docutils literal notranslate"><span class="pre">0</span></code> to check the current time every time staleness is
tested.</p>
<p>Note that setting this to a higher value <em>will</em> improve
performance somewhat while using ttl tracking, albeit at the
expense of keeping stale items around a bit longer than intended.</p>
</section>
<section id="ttlautopurge">
<h3><code class="docutils literal notranslate"><span class="pre">ttlAutopurge</span></code><a class="headerlink" href="#ttlautopurge" title="Permalink to this headline">#</a></h3>
<p>Preemptively remove stale items from the cache.</p>
<p>Note that this may <em>significantly</em> degrade performance,
especially if the cache is storing a large number of items. It
is almost always best to just leave the stale items in the cache,
and let them fall out as new items are added.</p>
<p>Note that this means that <code class="docutils literal notranslate"><span class="pre">allowStale</span></code> is a bit pointless, as
stale items will be deleted almost as soon as they expire.</p>
<p>Use with caution!</p>
<p>Boolean, default <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</section>
<section id="allowstale">
<h3><code class="docutils literal notranslate"><span class="pre">allowStale</span></code><a class="headerlink" href="#allowstale" title="Permalink to this headline">#</a></h3>
<p>By default, if you set <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, it’ll only delete stale items from
the cache when you <code class="docutils literal notranslate"><span class="pre">get(key)</span></code>. That is, it’s not preemptively
pruning items.</p>
<p>If you set <code class="docutils literal notranslate"><span class="pre">allowStale:true</span></code>, it’ll return the stale value as
well as deleting it. If you don’t set this, then it’ll return
<code class="docutils literal notranslate"><span class="pre">undefined</span></code> when you try to get a stale entry.</p>
<p>Note that when a stale entry is fetched, <em>even if it is returned
due to <code class="docutils literal notranslate"><span class="pre">allowStale</span></code> being set</em>, it is removed from the cache
immediately. You can immediately put it back in the cache if you
wish, thus resetting the TTL.</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.get()</span></code>. The <code class="docutils literal notranslate"><span class="pre">cache.has()</span></code> method will always return
<code class="docutils literal notranslate"><span class="pre">false</span></code> for stale items.</p>
<p>Boolean, default false, only relevant if <code class="docutils literal notranslate"><span class="pre">ttl</span></code> is set.</p>
</section>
<section id="nodeleteonstaleget">
<h3><code class="docutils literal notranslate"><span class="pre">noDeleteOnStaleGet</span></code><a class="headerlink" href="#nodeleteonstaleget" title="Permalink to this headline">#</a></h3>
<p>When using time-expiring entries with <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, by default stale
items will be removed from the cache when the key is accessed
with <code class="docutils literal notranslate"><span class="pre">cache.get()</span></code>.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">noDeleteOnStaleGet</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> will cause stale items to
remain in the cache, until they are explicitly deleted with
<code class="docutils literal notranslate"><span class="pre">cache.delete(key)</span></code>, or retrieved with <code class="docutils literal notranslate"><span class="pre">noDeleteOnStaleGet</span></code> set
to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.get()</span></code>.</p>
<p>Boolean, default false, only relevant if <code class="docutils literal notranslate"><span class="pre">ttl</span></code> is set.</p>
</section>
<section id="updateageonget">
<h3><code class="docutils literal notranslate"><span class="pre">updateAgeOnGet</span></code><a class="headerlink" href="#updateageonget" title="Permalink to this headline">#</a></h3>
<p>When using time-expiring entries with <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, setting this to
<code class="docutils literal notranslate"><span class="pre">true</span></code> will make each item’s age reset to 0 whenever it is
retrieved from cache with <code class="docutils literal notranslate"><span class="pre">get()</span></code>, causing it to not expire. (It
can still fall out of cache based on recency of use, of course.)</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.get()</span></code>.</p>
<p>Boolean, default false, only relevant if <code class="docutils literal notranslate"><span class="pre">ttl</span></code> is set.</p>
</section>
<section id="updateageonhas">
<h3><code class="docutils literal notranslate"><span class="pre">updateAgeOnHas</span></code><a class="headerlink" href="#updateageonhas" title="Permalink to this headline">#</a></h3>
<p>When using time-expiring entries with <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, setting this to
<code class="docutils literal notranslate"><span class="pre">true</span></code> will make each item’s age reset to 0 whenever its presence
in the cache is checked with <code class="docutils literal notranslate"><span class="pre">has()</span></code>, causing it to not expire.
(It can still fall out of cache based on recency of use, of
course.)</p>
<p>This may be overridden by passing an options object to
<code class="docutils literal notranslate"><span class="pre">cache.has()</span></code>.</p>
<p>Boolean, default false, only relevant if <code class="docutils literal notranslate"><span class="pre">ttl</span></code> is set.</p>
</section>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">#</a></h2>
<section id="new-lrucache-k-v-fc-unknown-options">
<h3><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">LRUCache&lt;K,</span> <span class="pre">V,</span> <span class="pre">FC</span> <span class="pre">=</span> <span class="pre">unknown&gt;(options)</span></code><a class="headerlink" href="#new-lrucache-k-v-fc-unknown-options" title="Permalink to this headline">#</a></h3>
<p>Create a new LRUCache. All options are documented above, and are
on the cache as public members.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">K</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code> types define the key and value types,
respectively. The optional <code class="docutils literal notranslate"><span class="pre">FC</span></code> type defines the type of the
<code class="docutils literal notranslate"><span class="pre">context</span></code> object passed to <code class="docutils literal notranslate"><span class="pre">cache.fetch()</span></code>.</p>
<p>Keys and values <strong>must not</strong> be <code class="docutils literal notranslate"><span class="pre">null</span></code> or <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</section>
<section id="cache-max-cache-maxsize-cache-allowstale">
<h3><code class="docutils literal notranslate"><span class="pre">cache.max</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.maxSize</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.allowStale</span></code>,<a class="headerlink" href="#cache-max-cache-maxsize-cache-allowstale" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cache.noDisposeOnSet</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.sizeCalculation</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.dispose</span></code>,
<code class="docutils literal notranslate"><span class="pre">cache.maxSize</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.ttl</span></code>, <code class="docutils literal notranslate"><span class="pre">cache.updateAgeOnGet</span></code>,
<code class="docutils literal notranslate"><span class="pre">cache.updateAgeOnHas</span></code></p>
<p>All option names are exposed as public members on the cache
object.</p>
<p>These are intended for read access only. Changing them during
program operation can cause undefined behavior.</p>
</section>
<section id="cache-size">
<h3><code class="docutils literal notranslate"><span class="pre">cache.size</span></code><a class="headerlink" href="#cache-size" title="Permalink to this headline">#</a></h3>
<p>The total number of items held in the cache at the current
moment.</p>
</section>
<section id="cache-calculatedsize">
<h3><code class="docutils literal notranslate"><span class="pre">cache.calculatedSize</span></code><a class="headerlink" href="#cache-calculatedsize" title="Permalink to this headline">#</a></h3>
<p>The total size of items in cache when using size tracking.</p>
</section>
<section id="set-key-value-size-sizecalculation-ttl-nodisposeonset-start-status">
<h3><code class="docutils literal notranslate"><span class="pre">set(key,</span> <span class="pre">value,</span> <span class="pre">[{</span> <span class="pre">size,</span> <span class="pre">sizeCalculation,</span> <span class="pre">ttl,</span> <span class="pre">noDisposeOnSet,</span> <span class="pre">start,</span> <span class="pre">status</span> <span class="pre">}])</span></code><a class="headerlink" href="#set-key-value-size-sizecalculation-ttl-nodisposeonset-start-status" title="Permalink to this headline">#</a></h3>
<p>Add a value to the cache.</p>
<p>Optional options object may contain <code class="docutils literal notranslate"><span class="pre">ttl</span></code> and <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code>
as described above, which default to the settings on the cache
object.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">start</span></code> is provided, then that will set the effective start
time for the TTL calculation. Note that this must be a previous
value of <code class="docutils literal notranslate"><span class="pre">performance.now()</span></code> if supported, or a previous value of
<code class="docutils literal notranslate"><span class="pre">Date.now()</span></code> if not.</p>
<p>Options object may also include <code class="docutils literal notranslate"><span class="pre">size</span></code>, which will prevent
calling the <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code> function and just use the specified
number if it is a positive integer, and <code class="docutils literal notranslate"><span class="pre">noDisposeOnSet</span></code> which
will prevent calling a <code class="docutils literal notranslate"><span class="pre">dispose</span></code> function in the case of
overwrites.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">size</span></code> (or return value of <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code>) for a given
entry is greater than <code class="docutils literal notranslate"><span class="pre">maxEntrySize</span></code>, then the item will not be
added to the cache.</p>
<p>Will update the recency of the entry.</p>
<p>Returns the cache object.</p>
<p>For the usage of the <code class="docutils literal notranslate"><span class="pre">status</span></code> option, see <strong>Status Tracking</strong>
below.</p>
<p>If the value is <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, then this is an alias for
<code class="docutils literal notranslate"><span class="pre">cache.delete(key)</span></code>. <code class="docutils literal notranslate"><span class="pre">undefined</span></code> is never stored in the cache.
See <strong>Storing Undefined Values</strong> below.</p>
</section>
<section id="get-key-updateageonget-allowstale-status-value">
<h3><code class="docutils literal notranslate"><span class="pre">get(key,</span> <span class="pre">{</span> <span class="pre">updateAgeOnGet,</span> <span class="pre">allowStale,</span> <span class="pre">status</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">{})</span> <span class="pre">=&gt;</span> <span class="pre">value</span></code><a class="headerlink" href="#get-key-updateageonget-allowstale-status-value" title="Permalink to this headline">#</a></h3>
<p>Return a value from the cache.</p>
<p>Will update the recency of the cache entry found.</p>
<p>If the key is not found, <code class="docutils literal notranslate"><span class="pre">get()</span></code> will return <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
<p>For the usage of the <code class="docutils literal notranslate"><span class="pre">status</span></code> option, see <strong>Status Tracking</strong>
below.</p>
</section>
<section id="async-fetch-key-options-promise">
<h3><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">fetch(key,</span> <span class="pre">options</span> <span class="pre">=</span> <span class="pre">{})</span> <span class="pre">=&gt;</span> <span class="pre">Promise</span></code><a class="headerlink" href="#async-fetch-key-options-promise" title="Permalink to this headline">#</a></h3>
<p>The following options are supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">updateAgeOnGet</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allowStale</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noDisposeOnSet</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forceRefresh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code> - See <strong>Status Tracking</strong> below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signal</span></code> - AbortSignal can be used to cancel the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code>.
Note that the <code class="docutils literal notranslate"><span class="pre">signal</span></code> option provided to the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> is
a different object, because it must also respond to internal
cache state changes, but aborting this signal will abort the
one passed to <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> as well.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">context</span></code> - sets the <code class="docutils literal notranslate"><span class="pre">context</span></code> option passed to the underlying
<code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>.</p></li>
</ul>
<p>If the value is in the cache and not stale, then the returned
Promise resolves to the value.</p>
<p>If not in the cache, or beyond its TTL staleness, then
<code class="docutils literal notranslate"><span class="pre">fetchMethod(key,</span> <span class="pre">staleValue,</span> <span class="pre">{</span> <span class="pre">options,</span> <span class="pre">signal,</span> <span class="pre">context</span> <span class="pre">})</span></code> is
called, and the value returned will be added to the cache once
resolved.</p>
<p>If called with <code class="docutils literal notranslate"><span class="pre">allowStale</span></code>, and an asynchronous fetch is
currently in progress to reload a stale value, then the former
stale value will be returned.</p>
<p>If called with <code class="docutils literal notranslate"><span class="pre">forceRefresh</span></code>, then the cached item will be
re-fetched, even if it is not stale. However, if <code class="docutils literal notranslate"><span class="pre">allowStale</span></code> is
set, then the old value will still be returned. This is useful
in cases where you want to force a reload of a cached value. If
a background fetch is already in progress, then <code class="docutils literal notranslate"><span class="pre">forceRefresh</span></code>
has no effect.</p>
<p>Multiple fetches for the same <code class="docutils literal notranslate"><span class="pre">key</span></code> will only call <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>
a single time, and all will be resolved when the value is
resolved, even if different options are used.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> is not specified, then this is effectively an
alias for <code class="docutils literal notranslate"><span class="pre">Promise.resolve(cache.get(key))</span></code>.</p>
<p>When the fetch method resolves to a value, if the fetch has not
been aborted due to deletion, eviction, or being overwritten,
then it is added to the cache using the options provided.</p>
<p>If the key is evicted or deleted before the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>
resolves, then the AbortSignal passed to the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code> will
receive an <code class="docutils literal notranslate"><span class="pre">abort</span></code> event, and the promise returned by <code class="docutils literal notranslate"><span class="pre">fetch()</span></code>
will reject with the reason for the abort.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">signal</span></code> is passed to the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> call, then aborting the
signal will abort the fetch and cause the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> promise to
reject with the reason provided.</p>
<section id="setting-context">
<h4>Setting <code class="docutils literal notranslate"><span class="pre">context</span></code><a class="headerlink" href="#setting-context" title="Permalink to this headline">#</a></h4>
<p>If an <code class="docutils literal notranslate"><span class="pre">FC</span></code> type is set to a type other than <code class="docutils literal notranslate"><span class="pre">unknown</span></code>, <code class="docutils literal notranslate"><span class="pre">void</span></code>, or
<code class="docutils literal notranslate"><span class="pre">undefined</span></code> in the LRUCache constructor, then all
calls to <code class="docutils literal notranslate"><span class="pre">cache.fetch()</span></code> <em>must</em> provide a <code class="docutils literal notranslate"><span class="pre">context</span></code> option. If
set to <code class="docutils literal notranslate"><span class="pre">undefined</span></code> or <code class="docutils literal notranslate"><span class="pre">void</span></code>, then calls to fetch <em>must not</em>
provide a <code class="docutils literal notranslate"><span class="pre">context</span></code> option.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">context</span></code> param allows you to provide arbitrary data that
might be relevant in the course of fetching the data. It is only
relevant for the course of a single <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> operation, and
discarded afterwards.</p>
</section>
<section id="note-fetch-calls-are-inflight-unique">
<h4>Note: <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> calls are inflight-unique<a class="headerlink" href="#note-fetch-calls-are-inflight-unique" title="Permalink to this headline">#</a></h4>
<p>If you call <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> multiple times with the same key value,
then every call after the first will resolve on the same
promise<sup>1</sup>,
<em>even if they have different settings that would otherwise change
the behvavior of the fetch</em>, such as <code class="docutils literal notranslate"><span class="pre">noDeleteOnFetchRejection</span></code>
or <code class="docutils literal notranslate"><span class="pre">ignoreFetchAbort</span></code>.</p>
<p>In most cases, this is not a problem (in fact, only fetching
something once is what you probably want, if you’re caching in
the first place). If you are changing the fetch() options
dramatically between runs, there’s a good chance that you might
be trying to fit divergent semantics into a single object, and
would be better off with multiple cache instances.</p>
<p><strong>1</strong>: Ie, they’re not the “same Promise”, but they resolve at
the same time, because they’re both waiting on the same
underlying fetchMethod response.</p>
</section>
</section>
<section id="peek-key-allowstale-value">
<h3><code class="docutils literal notranslate"><span class="pre">peek(key,</span> <span class="pre">{</span> <span class="pre">allowStale</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">{})</span> <span class="pre">=&gt;</span> <span class="pre">value</span></code><a class="headerlink" href="#peek-key-allowstale-value" title="Permalink to this headline">#</a></h3>
<p>Like <code class="docutils literal notranslate"><span class="pre">get()</span></code> but doesn’t update recency or delete stale items.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">undefined</span></code> if the item is stale, unless <code class="docutils literal notranslate"><span class="pre">allowStale</span></code> is
set either on the cache or in the options object.</p>
</section>
<section id="has-key-updateageonhas-status-boolean">
<h3><code class="docutils literal notranslate"><span class="pre">has(key,</span> <span class="pre">{</span> <span class="pre">updateAgeOnHas,</span> <span class="pre">status</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">{})</span> <span class="pre">=&gt;</span> <span class="pre">Boolean</span></code><a class="headerlink" href="#has-key-updateageonhas-status-boolean" title="Permalink to this headline">#</a></h3>
<p>Check if a key is in the cache, without updating the recency of
use. Age is updated if <code class="docutils literal notranslate"><span class="pre">updateAgeOnHas</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> in
either the options or the constructor.</p>
<p>Will return <code class="docutils literal notranslate"><span class="pre">false</span></code> if the item is stale, even though it is
technically in the cache. The difference can be determined (if
it matters) by using a <code class="docutils literal notranslate"><span class="pre">status</span></code> argument, and inspecting the
<code class="docutils literal notranslate"><span class="pre">has</span></code> field.</p>
<p>For the usage of the <code class="docutils literal notranslate"><span class="pre">status</span></code> option, see <strong>Status Tracking</strong>
below.</p>
</section>
<section id="delete-key">
<h3><code class="docutils literal notranslate"><span class="pre">delete(key)</span></code><a class="headerlink" href="#delete-key" title="Permalink to this headline">#</a></h3>
<p>Deletes a key out of the cache.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the key was deleted, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
</section>
<section id="clear">
<h3><code class="docutils literal notranslate"><span class="pre">clear()</span></code><a class="headerlink" href="#clear" title="Permalink to this headline">#</a></h3>
<p>Clear the cache entirely, throwing away all values.</p>
</section>
<section id="keys">
<h3><code class="docutils literal notranslate"><span class="pre">keys()</span></code><a class="headerlink" href="#keys" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding the keys in the cache, in order from
most recently used to least recently used.</p>
</section>
<section id="rkeys">
<h3><code class="docutils literal notranslate"><span class="pre">rkeys()</span></code><a class="headerlink" href="#rkeys" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding the keys in the cache, in order from
least recently used to most recently used.</p>
</section>
<section id="values">
<h3><code class="docutils literal notranslate"><span class="pre">values()</span></code><a class="headerlink" href="#values" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding the values in the cache, in order
from most recently used to least recently used.</p>
</section>
<section id="rvalues">
<h3><code class="docutils literal notranslate"><span class="pre">rvalues()</span></code><a class="headerlink" href="#rvalues" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding the values in the cache, in order
from least recently used to most recently used.</p>
</section>
<section id="entries">
<h3><code class="docutils literal notranslate"><span class="pre">entries()</span></code><a class="headerlink" href="#entries" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding <code class="docutils literal notranslate"><span class="pre">[key,</span> <span class="pre">value]</span></code> pairs, in order from
most recently used to least recently used.</p>
</section>
<section id="rentries">
<h3><code class="docutils literal notranslate"><span class="pre">rentries()</span></code><a class="headerlink" href="#rentries" title="Permalink to this headline">#</a></h3>
<p>Return a generator yielding <code class="docutils literal notranslate"><span class="pre">[key,</span> <span class="pre">value]</span></code> pairs, in order from
least recently used to most recently used.</p>
</section>
<section id="find-fn-getoptions">
<h3><code class="docutils literal notranslate"><span class="pre">find(fn,</span> <span class="pre">[getOptions])</span></code><a class="headerlink" href="#find-fn-getoptions" title="Permalink to this headline">#</a></h3>
<p>Find a value for which the supplied <code class="docutils literal notranslate"><span class="pre">fn</span></code> method returns a truthy
value, similar to <code class="docutils literal notranslate"><span class="pre">Array.find()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">fn</span></code> is called as <code class="docutils literal notranslate"><span class="pre">fn(value,</span> <span class="pre">key,</span> <span class="pre">cache)</span></code>.</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">getOptions</span></code> are applied to the resulting <code class="docutils literal notranslate"><span class="pre">get()</span></code> of
the item found.</p>
</section>
<section id="dump">
<h3><code class="docutils literal notranslate"><span class="pre">dump()</span></code><a class="headerlink" href="#dump" title="Permalink to this headline">#</a></h3>
<p>Return an array of <code class="docutils literal notranslate"><span class="pre">[key,</span> <span class="pre">entry]</span></code> objects which can be passed to
<code class="docutils literal notranslate"><span class="pre">cache.load()</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> fields are calculated relative to a portable
<code class="docutils literal notranslate"><span class="pre">Date.now()</span></code> timestamp, even if <code class="docutils literal notranslate"><span class="pre">performance.now()</span></code> is available.</p>
<p>Stale entries are always included in the <code class="docutils literal notranslate"><span class="pre">dump</span></code>, even if
<code class="docutils literal notranslate"><span class="pre">allowStale</span></code> is false.</p>
<p>Note: this returns an actual array, not a generator, so it can be
more easily passed around.</p>
</section>
<section id="load-entries">
<h3><code class="docutils literal notranslate"><span class="pre">load(entries)</span></code><a class="headerlink" href="#load-entries" title="Permalink to this headline">#</a></h3>
<p>Reset the cache and load in the items in <code class="docutils literal notranslate"><span class="pre">entries</span></code> in the order
listed. Note that the shape of the resulting cache may be
different if the same options are not used in both caches.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> fields are assumed to be calculated relative to a
portable <code class="docutils literal notranslate"><span class="pre">Date.now()</span></code> timestamp, even if <code class="docutils literal notranslate"><span class="pre">performance.now()</span></code> is
available.</p>
</section>
<section id="purgestale">
<h3><code class="docutils literal notranslate"><span class="pre">purgeStale()</span></code><a class="headerlink" href="#purgestale" title="Permalink to this headline">#</a></h3>
<p>Delete any stale entries. Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if anything was
removed, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
</section>
<section id="getremainingttl-key">
<h3><code class="docutils literal notranslate"><span class="pre">getRemainingTTL(key)</span></code><a class="headerlink" href="#getremainingttl-key" title="Permalink to this headline">#</a></h3>
<p>Return the number of ms left in the item’s TTL. If item is not
in cache, returns <code class="docutils literal notranslate"><span class="pre">0</span></code>. Returns <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> if item is in cache
without a defined TTL.</p>
</section>
<section id="foreach-fn-thisp">
<h3><code class="docutils literal notranslate"><span class="pre">forEach(fn,</span> <span class="pre">[thisp])</span></code><a class="headerlink" href="#foreach-fn-thisp" title="Permalink to this headline">#</a></h3>
<p>Call the <code class="docutils literal notranslate"><span class="pre">fn</span></code> function with each set of <code class="docutils literal notranslate"><span class="pre">fn(value,</span> <span class="pre">key,</span> <span class="pre">cache)</span></code>
in the LRU cache, from most recent to least recently used.</p>
<p>Does not affect recency of use.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">thisp</span></code> is provided, function will be called in the
<code class="docutils literal notranslate"><span class="pre">this</span></code>-context of the provided object.</p>
</section>
<section id="rforeach-fn-thisp">
<h3><code class="docutils literal notranslate"><span class="pre">rforEach(fn,</span> <span class="pre">[thisp])</span></code><a class="headerlink" href="#rforeach-fn-thisp" title="Permalink to this headline">#</a></h3>
<p>Same as <code class="docutils literal notranslate"><span class="pre">cache.forEach(fn,</span> <span class="pre">thisp)</span></code>, but in order from least
recently used to most recently used.</p>
</section>
<section id="pop">
<h3><code class="docutils literal notranslate"><span class="pre">pop()</span></code><a class="headerlink" href="#pop" title="Permalink to this headline">#</a></h3>
<p>Evict the least recently used item, returning its value.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">undefined</span></code> if cache is empty.</p>
</section>
</section>
<section id="status-tracking">
<h2>Status Tracking<a class="headerlink" href="#status-tracking" title="Permalink to this headline">#</a></h2>
<p>Occasionally, it may be useful to track the internal behavior of
the cache, particularly for logging, debugging, or for behavior
within the <code class="docutils literal notranslate"><span class="pre">fetchMethod</span></code>. To do this, you can pass a <code class="docutils literal notranslate"><span class="pre">status</span></code>
object to the <code class="docutils literal notranslate"><span class="pre">get()</span></code>, <code class="docutils literal notranslate"><span class="pre">set()</span></code>, <code class="docutils literal notranslate"><span class="pre">has()</span></code>, and <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> methods.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">status</span></code> option should be a plain JavaScript object.</p>
<p>The following fields will be set appropriately:</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span><span class="w"> </span><span class="nx">Status</span><span class="o">&lt;</span><span class="nx">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The status of a set() operation.</span>
<span class="cm">   *</span>
<span class="cm">   * - add: the item was not found in the cache, and was added</span>
<span class="cm">   * - update: the item was in the cache, with the same value provided</span>
<span class="cm">   * - replace: the item was in the cache, and replaced</span>
<span class="cm">   * - miss: the item was not added to the cache for some reason</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">set</span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;add&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;update&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;replace&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * the ttl stored for the item, or undefined if ttls are not used.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">ttl?</span><span class="o">:</span><span class="w"> </span><span class="kt">LRUMilliseconds</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * the start time for the item, or undefined if ttls are not used.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">start?</span><span class="o">:</span><span class="w"> </span><span class="kt">LRUMilliseconds</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The timestamp used for TTL calculation</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">now?</span><span class="o">:</span><span class="w"> </span><span class="kt">LRUMilliseconds</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * the remaining ttl for the item, or undefined if ttls are not used.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">remainingTTL?</span><span class="o">:</span><span class="w"> </span><span class="kt">LRUMilliseconds</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The calculated size for the item, if sizes are used.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">size?</span><span class="o">:</span><span class="w"> </span><span class="kt">LRUSize</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * A flag indicating that the item was not stored, due to exceeding the</span>
<span class="cm">   * {@link maxEntrySize}</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">maxEntrySizeExceeded?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The old value, specified in the case of `set:&#39;update&#39;` or</span>
<span class="cm">   * `set:&#39;replace&#39;`</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">oldValue?</span><span class="o">:</span><span class="w"> </span><span class="kt">V</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The results of a {@link has} operation</span>
<span class="cm">   *</span>
<span class="cm">   * - hit: the item was found in the cache</span>
<span class="cm">   * - stale: the item was found in the cache, but is stale</span>
<span class="cm">   * - miss: the item was not found in the cache</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">has</span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;hit&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;stale&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The status of a {@link fetch} operation.</span>
<span class="cm">   * Note that this can change as the underlying fetch() moves through</span>
<span class="cm">   * various states.</span>
<span class="cm">   *</span>
<span class="cm">   * - inflight: there is another fetch() for this key which is in process</span>
<span class="cm">   * - get: there is no fetchMethod, so {@link get} was called.</span>
<span class="cm">   * - miss: the item is not in cache, and will be fetched.</span>
<span class="cm">   * - hit: the item is in the cache, and was resolved immediately.</span>
<span class="cm">   * - stale: the item is in the cache, but stale.</span>
<span class="cm">   * - refresh: the item is in the cache, and not stale, but</span>
<span class="cm">   *   {@link forceRefresh} was specified.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetch</span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;get&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;inflight&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;hit&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;stale&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;refresh&#39;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The {@link fetchMethod} was called</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchDispatched?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The cached value was updated after a successful call to fetchMethod</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchUpdated?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The reason for a fetch() rejection.  Either the error raised by the</span>
<span class="cm">   * {@link fetchMethod}, or the reason for an AbortSignal.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchError?</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The fetch received an abort signal</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchAborted?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The abort signal received was ignored, and the fetch was allowed to</span>
<span class="cm">   * continue.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchAbortIgnored?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The fetchMethod promise resolved successfully</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchResolved?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The results of the fetchMethod promise were stored in the cache</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchUpdated?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The fetchMethod promise was rejected</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">fetchRejected?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The status of a {@link get} operation.</span>
<span class="cm">   *</span>
<span class="cm">   * - fetching: The item is currently being fetched.  If a previous value is</span>
<span class="cm">   *   present and allowed, that will be returned.</span>
<span class="cm">   * - stale: The item is in the cache, and is stale.</span>
<span class="cm">   * - hit: the item is in the cache</span>
<span class="cm">   * - miss: the item is not in the cache</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">get</span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;stale&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;hit&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * A fetch or get operation returned a stale value.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">returnedStale?</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="storage-bounds-safety">
<h2>Storage Bounds Safety<a class="headerlink" href="#storage-bounds-safety" title="Permalink to this headline">#</a></h2>
<p>This implementation aims to be as flexible as possible, within
the limits of safe memory consumption and optimal performance.</p>
<p>At initial object creation, storage is allocated for <code class="docutils literal notranslate"><span class="pre">max</span></code> items.
If <code class="docutils literal notranslate"><span class="pre">max</span></code> is set to zero, then some performance is lost, and item
count is unbounded. Either <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> or <code class="docutils literal notranslate"><span class="pre">ttl</span></code> <em>must</em> be set if
<code class="docutils literal notranslate"><span class="pre">max</span></code> is not specified.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is set, then this creates a safe limit on the
maximum storage consumed, but without the performance benefits of
pre-allocation. When <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is set, every item <em>must</em> provide
a size, either via the <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code> method provided to the
constructor, or via a <code class="docutils literal notranslate"><span class="pre">size</span></code> or <code class="docutils literal notranslate"><span class="pre">sizeCalculation</span></code> option provided
to <code class="docutils literal notranslate"><span class="pre">cache.set()</span></code>. The size of every item <em>must</em> be a positive
integer.</p>
<p>If neither <code class="docutils literal notranslate"><span class="pre">max</span></code> nor <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> are set, then <code class="docutils literal notranslate"><span class="pre">ttl</span></code> tracking must
be enabled. Note that, even when tracking item <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, items are
<em>not</em> preemptively deleted when they become stale, unless
<code class="docutils literal notranslate"><span class="pre">ttlAutopurge</span></code> is enabled. Instead, they are only purged the
next time the key is requested. Thus, if <code class="docutils literal notranslate"><span class="pre">ttlAutopurge</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>,
and <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> are all not set, then the cache will potentially
grow unbounded.</p>
<p>In this case, a warning is printed to standard error. Future
versions may require the use of <code class="docutils literal notranslate"><span class="pre">ttlAutopurge</span></code> if <code class="docutils literal notranslate"><span class="pre">max</span></code> and
<code class="docutils literal notranslate"><span class="pre">maxSize</span></code> are not specified.</p>
<p>If you truly wish to use a cache that is bound <em>only</em> by TTL
expiration, consider using a <code class="docutils literal notranslate"><span class="pre">Map</span></code> object, and calling
<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> to delete entries when they expire. It will perform
much better than an LRU cache.</p>
<p>Here is an implementation you may use, under the same
<span class="xref myst">license</span> as this package:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// a storage-unbounded ttl cache that is not an lru-cache</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">timers</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="nx">k</span><span class="p">,</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span><span class="w"> </span><span class="nx">ttl</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span>
<span class="w">  </span><span class="nx">has</span><span class="o">:</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span>
<span class="w">  </span><span class="ow">delete</span><span class="o">:</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">clear</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">timers</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If that isn’t to your liking, check out
<a class="reference external" href="http://npm.im/&#64;isaacs/ttlcache">&#64;isaacs/ttlcache</a>.</p>
</section>
<section id="storing-undefined-values">
<h2>Storing Undefined Values<a class="headerlink" href="#storing-undefined-values" title="Permalink to this headline">#</a></h2>
<p>This cache never stores undefined values, as <code class="docutils literal notranslate"><span class="pre">undefined</span></code> is used
internally in a few places to indicate that a key is not in the
cache.</p>
<p>You may call <code class="docutils literal notranslate"><span class="pre">cache.set(key,</span> <span class="pre">undefined)</span></code>, but this is just an
an alias for <code class="docutils literal notranslate"><span class="pre">cache.delete(key)</span></code>. Note that this has the effect
that <code class="docutils literal notranslate"><span class="pre">cache.has(key)</span></code> will return <em>false</em> after setting it to
undefined.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">myKey</span><span class="p">,</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span>
<span class="nx">cache</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">myKey</span><span class="p">)</span><span class="w"> </span><span class="c1">// false!</span>
</pre></div>
</div>
<p>If you need to track <code class="docutils literal notranslate"><span class="pre">undefined</span></code> values, and still note that the
key is in the cache, an easy workaround is to use a sigil object
of your own.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LRUCache</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lru-cache&#39;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">undefinedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Symbol</span><span class="p">(</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LRUCache</span><span class="p">(...)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">mySet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">undefinedValue</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">myGet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">undefinedValue</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">v</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">#</a></h2>
<p>As of January 2022, version 7 of this library is one of the most
performant LRU cache implementations in JavaScript.</p>
<p>Benchmarks can be extremely difficult to get right. In
particular, the performance of set/get/delete operations on
objects will vary <em>wildly</em> depending on the type of key used. V8
is highly optimized for objects with keys that are short strings,
especially integer numeric strings. Thus any benchmark which
tests <em>solely</em> using numbers as keys will tend to find that an
object-based approach performs the best.</p>
<p>Note that coercing <em>anything</em> to strings to use as object keys is
unsafe, unless you can be 100% certain that no other type of
value will be used. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">myCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">myCache</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">myCache</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>

<span class="nx">set</span><span class="p">({},</span><span class="w"> </span><span class="s1">&#39;please hang onto this for me&#39;</span><span class="p">)</span>
<span class="nx">set</span><span class="p">(</span><span class="s1">&#39;[object Object]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;oopsie&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Also beware of “Just So” stories regarding performance. Garbage
collection of large (especially: deep) object graphs can be
incredibly costly, with several “tipping points” where it
increases exponentially. As a result, putting that off until
later can make it much worse, and less predictable. If a library
performs well, but only in a scenario where the object graph is
kept shallow, then that won’t help you if you are using large
objects as keys.</p>
<p>In general, when attempting to use a library to improve
performance (such as a cache like this one), it’s best to choose
an option that will perform well in the sorts of scenarios where
you’ll actually use it.</p>
<p>This library is optimized for repeated gets and minimizing
eviction time, since that is the expected need of a LRU. Set
operations are somewhat slower on average than a few other
options, in part because of that optimization. It is assumed
that you’ll be caching some costly operation, ideally as rarely
as possible, so optimizing set over get would be unwise.</p>
<p>If performance matters to you:</p>
<ol>
<li><p>If it’s at all possible to use small integer values as keys,
and you can guarantee that no other types of values will be
used as keys, then do that, and use a cache such as
<a class="reference external" href="https://npmjs.com/package/lru-fast">lru-fast</a>, or
<a class="reference external" href="https://yomguithereal.github.io/mnemonist/lru-cache">mnemonist’s
LRUCache</a>
which uses an Object as its data store.</p></li>
<li><p>Failing that, if at all possible, use short non-numeric
strings (ie, less than 256 characters) as your keys, and use
<a class="reference external" href="https://yomguithereal.github.io/mnemonist/lru-cache">mnemonist’s
LRUCache</a>.</p></li>
<li><p>If the types of your keys will be anything else, especially
long strings, strings that look like floats, objects, or some
mix of types, or if you aren’t sure, then this library will
work well for you.</p>
<p>If you do not need the features that this library provides
(like asynchronous fetching, a variety of TTL staleness
options, and so on), then <a class="reference external" href="https://yomguithereal.github.io/mnemonist/lru-map">mnemonist’s
LRUMap</a> is
a very good option, and just slightly faster than this module
(since it does considerably less).</p>
</li>
<li><p>Do not use a <code class="docutils literal notranslate"><span class="pre">dispose</span></code> function, size tracking, or especially
ttl behavior, unless absolutely needed. These features are
convenient, and necessary in some use cases, and every attempt
has been made to make the performance impact minimal, but it
isn’t nothing.</p></li>
</ol>
</section>
<section id="breaking-changes-in-version-7">
<h2>Breaking Changes in Version 7<a class="headerlink" href="#breaking-changes-in-version-7" title="Permalink to this headline">#</a></h2>
<p>This library changed to a different algorithm and internal data
structure in version 7, yielding significantly better
performance, albeit with some subtle changes as a result.</p>
<p>If you were relying on the internals of LRUCache in version 6 or
before, it probably will not work in version 7 and above.</p>
</section>
<section id="breaking-changes-in-version-8">
<h2>Breaking Changes in Version 8<a class="headerlink" href="#breaking-changes-in-version-8" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">fetchContext</span></code> option was renamed to <code class="docutils literal notranslate"><span class="pre">context</span></code>, and may no
longer be set on the cache instance itself.</p></li>
<li><p>Rewritten in TypeScript, so pretty much all the types moved
around a lot.</p></li>
<li><p>The AbortController/AbortSignal polyfill was removed. For this
reason, <strong>Node version 16.14.0 or higher is now required</strong>.</p></li>
<li><p>Internal properties were moved to actual private class
properties.</p></li>
<li><p>Keys and values must not be <code class="docutils literal notranslate"><span class="pre">null</span></code> or <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p></li>
<li><p>Minified export available at <code class="docutils literal notranslate"><span class="pre">'lru-cache/min'</span></code>, for both CJS
and MJS builds.</p></li>
</ul>
</section>
<section id="changes-in-version-9">
<h2>Changes in Version 9<a class="headerlink" href="#changes-in-version-9" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Named export only, no default export.</p></li>
<li><p>AbortController polyfill returned, albeit with a warning when
used.</p></li>
</ul>
<p>For more info, see the <span class="xref myst">change log</span>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reveal/node_modules/path-scurry/node_modules/lru-cache"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mark S. Baldwin<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>